{"version":3,"sources":["/source/jsonapi.module.js","/source/resource/resource-cache/resource-cache.factory.js","angular-jsonapi.min.js","/source/model/model-relationship/model-relationship-has-one.factory.js","/source/model/model-relationship/model-relationship-has-many.factory.js","/source/model/model-linker/model-linker.js","/source/model/model-form/model-form.factory.js","/source/model/abstract-model/abstract-model.js","/source/errors/validation-error/validation-error.factory.js","/source/errors/synchronization-error/synchronization-error.factory.js","/source/errors/errors-manager/errors-manager.factory.js","/source/utils/lazy-property.js","/source/utils/kebab-case.js","/source/utils/all-settled.js","/source/synchronizers/synchronizer-simple.factory.js","/source/synchronizers/synchronizer-prototype.js","/source/synchronizations/synchronization-rest.factory.js","/source/synchronizations/synchronization-prototype.js","/source/synchronizations/synchronization-local.factory.js","/source/schema/schema.factory.js","/source/schema/schema-link.factory.js","/source/resource/resource.factory.js","/source/model/model-factory.factory.js","/source/collection/collection.factory.js","/source/jsonapi.provider.js","/source/jsonapi.config.js"],"names":["angular","module","constant","pluralize","validate","AngularJsonAPIResourceCacheWrapper","uuid4","$log","AngularJsonAPIResourceCacheFactory","factory","AngularJsonAPIResourceCache","_this","this","data","removed","size","indexIds","undefined","addOrUpdate","validatedData","config","id","error","modelFactory","update","saved","initialization","fromJson","json","collection","synchronized","stable","pristine","isObject","updatedAt","forEach","objectData","toJson","object","push","clear","get","type","schema","index","params","debug","map","bind","setIndexIds","array","element","isString","remove","revertRemove","clearRemoved","prototype","create","$inject","AngularJsonAPIModelRelationshipHasOne","$jsonapi","ModelRelationshipHasOneFactory","parent","key","ModelRelationshipHasOne","relationships","target","unlink","initialize","polymorphic","model","getResource","form","link","reflection","set","targets","length","apply","constructor","add","AngularJsonAPIModelRelationshipHasMany","ModelRelationshipHasManyFactory","ModelRelationshipHasMany","__push","__pop","indexOf","splice","Object","Array","AngularJsonAPIModelLinkerService","toLinkData","oneWay","__addHasMany","__processAddHasMany","__addHasOne","__processAddHasOne","__removeHasMany","__processRemove","reflectionSchema","reflectionKey","__swapResults","__wrapResults","oldReflectionSchema","oldReflection","result","__removeHasOne","reset","linkData","isArray","value","newValue","item","i","service","AngularJsonAPIModelFormWrapper","AngularJsonAPIModelValidationError","validateJS","$q","AngularJsonAPIModelFormFactory","AngularJsonAPIModelForm","attributes","copy","save","auto","slice","validator","errors","validation","resolve","deferred","reject","errorsMap","attribute","attributesWrapper","constraintsWrapper","defer","async","then","promise","AngularJsonAPIAbstractModelWrapper","AngularJsonAPIModelSynchronizationError","AngularJsonAPIModelErrorsManager","$rootScope","$injector","AngularJsonAPIAbstractModel","loading","saving","Date","now","loadingCount","savingCount","synchronization","promises","__setData","synchronize","notify","response","$emit","action","cache","finish","concat","__decrementSavingCounter","__incrementSavingCounter","refresh","synchronizeIncluded","__incrementLoadingCounter","__decrementLoadingCounter","resolveIncluded","includedResponse","operation","success","results","included","proccesResults","allSettled","unlinkAll","removeLink","linksObj","removeReflectionLink","resolveReflection","hasErrors","answer","setAttributes","validators","setRelationships","relationshipData","links","linkOne","unlinkOne","AngularJsonAPIModelValidationErrorWrapper","ValidationErrorFactory","message","ValidationError","Error","captureStackTrace","context","name","AngularJsonAPIModelSynchronizationErrorWrapper","SynchronizationErrorFactory","code","SynchronizationError","AngularJsonAPIModelErrorsManagerWrapper","ErrorsManagerFactory","description","ErrorConstructor","defaultFilter","ErrorsManager","obj","propertyName","callback","done","defineProperty","call","enumerable","configurable","str","replace","toLowerCase","$provide","decorator","$delegate","resolvedCallback","rejectedCallback","wrap","isFunction","reason","wrapped","hasOwnProperty","all","AngularJsonAPISynchronizerSimpleWrapper","AngularJsonAPISynchronizerPrototype","AngularJsonAPISynchronizerSimpleFactory","synchronizations","AngularJsonAPISynchronizerSimple","state","synchronizer","step","resolved","afterHooks","hook","finishHooks","rejected","noop","beginHooks","beforeHooks","synchronizationHooks","AngularJsonAPISynchronizerPrototypeWrapper","AngularJsonAPISynchronizationRestWrapper","AngularJsonAPISynchronizationPrototype","toKebabCase","$http","AngularJsonAPISynchronizationRestFactory","url","AngularJsonAPISynchronizationRest","method","headers","resolveHttp","rejectHttp","status","statusText","rejectServerOffline","console","log","rejectNoConnection","Accept","Content-Type","arguments","AngularJsonAPISynchronizationPrototypeWrapper","allHooks","options","hookName","begin","beforeSynchro","afterSynchro","before","after","AngularJsonAPISynchronizationLocalWrapper","$window","AngularJsonAPISynchronizationLocalFactory","prefix","AngularJsonAPISynchronizationLocal","init","localStorage","getItem","removeItem","updateStorage","setItem","__updateStorage","AngularJsonAPISchemaWrapper","AngularJsonAPISchemaLink","AngularJsonAPISchemaFactory","AngularJsonAPISchema","include","linkSchema","linkName","linkSchemaObj","extend","join","AngularJsonAPILinkSchrapperLink","AngularJsonAPISchemaLinkFactory","plural","singular","AngularJsonAPIResourceWrapper","AngularJsonAPIModel","AngularJsonAPICollection","AngularJsonAPIResourceFactory","AngularJsonAPIResource","initialized","fetch","relationshipSchema","relationshipName","generate","clearCache","createModelFactory","schemaObj","Model","functions","metaFunction","metaFunctionName","AngularJsonAPICollectionWrapper","AngularJsonAPICollectionFactory","event","$on","jsonapiProvider","jsonapiFactory","allResources","memory","listResources","names","addResource","objects","$get","provider","$logProvider","debugEnabled","run","Promise"],"mappings":"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","file":"angular-jsonapi.min.js","sourcesContent":["(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi', ['uuid4'])\n  /* global pluralize: false, validate: false */\n  .constant('pluralize', pluralize)\n  .constant('validateJS', validate);\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPIResourceCache', AngularJsonAPIResourceCacheWrapper);\n\n  function AngularJsonAPIResourceCacheWrapper(\n    uuid4,\n    $log\n  ) {\n\n    AngularJsonAPIResourceCache.prototype.get = get;\n    AngularJsonAPIResourceCache.prototype.index = index;\n    AngularJsonAPIResourceCache.prototype.setIndexIds = setIndexIds;\n    AngularJsonAPIResourceCache.prototype.addOrUpdate = addOrUpdate;\n\n    AngularJsonAPIResourceCache.prototype.fromJson = fromJson;\n    AngularJsonAPIResourceCache.prototype.toJson = toJson;\n    AngularJsonAPIResourceCache.prototype.clear = clear;\n\n    AngularJsonAPIResourceCache.prototype.remove = remove;\n    AngularJsonAPIResourceCache.prototype.revertRemove = revertRemove;\n    AngularJsonAPIResourceCache.prototype.clearRemoved = clearRemoved;\n\n    return {\n      create: AngularJsonAPIResourceCacheFactory\n    };\n\n    function AngularJsonAPIResourceCacheFactory(factory) {\n      return new AngularJsonAPIResourceCache(factory);\n    }\n\n    /**\n     * Constructor\n     */\n    function AngularJsonAPIResourceCache(factory) {\n      var _this = this;\n\n      _this.factory = factory;\n      _this.data = {};\n      _this.removed = {};\n      _this.size = 0;\n\n      _this.indexIds = undefined;\n    }\n\n    /**\n     * Add new model or update existing with data\n     * @param {object} validatedData Data that are used to update or create an object, has to be valid\n     * @return {AngularJsonAPIModel} Created model\n     */\n    function addOrUpdate(validatedData, config) {\n      var _this = this;\n      var id = validatedData.id;\n\n      if (id === undefined) {\n        $log.error('Can\\'t add data without id!', validatedData);\n        return;\n      }\n\n      if (_this.data[id] === undefined) {\n        _this.data[id] = _this.factory.modelFactory(validatedData, config);\n        _this.size += 1;\n      } else {\n        _this.data[id].update(validatedData, config.saved, config.initialization);\n      }\n\n      return _this.data[id];\n    }\n\n\n    /**\n     * Recreate object structure from json data\n     * @param  {json} json Json data\n     * @return {undefined}\n     */\n    function fromJson(json) {\n      var _this = this;\n      var collection = angular.fromJson(json);\n\n      var config = {\n        saved: true,\n        synchronized: false,\n        stable: false,\n        pristine: false,\n        initialization: true\n      };\n\n      if (angular.isObject(collection) && collection.data !== undefined) {\n        _this.updatedAt = collection.updatedAt;\n        _this.indexIds = collection.indexIds;\n\n        angular.forEach(collection.data, function(objectData) {\n          var data = objectData.data;\n          _this.addOrUpdate(data, config, objectData.updatedAt);\n        });\n      }\n    }\n\n    /**\n     * Encodes memory into json format\n     * @return {json} Json encoded memory\n     */\n    function toJson() {\n      var _this = this;\n      var json = {\n        data: [],\n        updatedAt: _this.updatedAt,\n        indexIds: _this.indexIds\n      };\n\n      angular.forEach(_this.data, function(object) {\n        if (object.error === false) {\n          json.data.push(object.toJson());\n        }\n      });\n\n      return angular.toJson(json);\n    }\n\n    /**\n     * Clear memory\n     * @return {undefined}\n     */\n    function clear() {\n      var _this = this;\n\n      _this.indexIds = undefined;\n      _this.data = {};\n      _this.removed = {};\n    }\n\n    /**\n     * Low level get used internally, does not run any synchronization\n     * @param  {uuid} id\n     * @return {AngularJsonAPIModel} Model associated with id\n     */\n    function get(id) {\n      var _this = this;\n\n      var data = {\n        id: id,\n        type: _this.factory.schema.type\n      };\n\n      var config = {\n        saved: true,\n        synchronized: false,\n        stable: false,\n        pristine: true\n      };\n\n      if (_this.data[id] === undefined) {\n        _this.data[id] = _this.factory.modelFactory(data, config);\n      }\n\n      return _this.data[id];\n    }\n\n    /**\n     * Low level get used internally, does not run any synchronization, used for index requests\n     * @param  {objec} params\n     * @return {AngularJsonAPIModel} Model associated with id\n     */\n    function index(params) {\n      var _this = this;\n\n      $log.debug('Unused params', params);\n\n      if (_this.indexIds === undefined) {\n        return _this.indexIds;\n      }\n\n      return _this.indexIds.map(_this.get.bind(_this));\n    }\n\n    /**\n     * Cache ids of objects returned by index request\n     * @param {ids array or AngularJsonAPIModel array} array Objects or ids to be cached\n     */\n    function setIndexIds(array) {\n      var _this = this;\n\n      _this.indexIds = [];\n\n      angular.forEach(array, function(element) {\n        if (angular.isString(element) && uuid4.validate(element)) {\n          _this.indexIds.push(element);\n        } else if (angular.isObject(element) && uuid4.validate(element.data.id)) {\n          _this.indexIds.push(element.data.id);\n        }\n      });\n    }\n\n    /**\n     * Remove object with given id from cache\n     * @param  {uuid} id\n     * @return {AngularJsonAPIModel / undefined}    Removed object, undefined if\n     * object does not exist\n     */\n    function remove(id) {\n      var _this = this;\n\n      if (_this.data[id] !== undefined) {\n        _this.removed[id] = _this.data[id];\n        delete _this.data[id];\n        _this.size -= 1;\n      }\n\n      return _this.removed[id];\n    }\n\n    /**\n     * Revert removal of an object with given id from cache\n     * @param  {uuid} id\n     * @return {AngularJsonAPIModel / undefined}    Removed object, undefined if\n     * object does not exist\n     */\n    function revertRemove(id) {\n      var _this = this;\n\n      if (_this.removed[id] !== undefined) {\n        _this.data[id] = _this.removed[id];\n        delete _this.removed[id];\n        _this.size += 1;\n      }\n\n      return _this.data[id];\n    }\n\n    /**\n     * Clear removed object from memory\n     * @param  {uuid} id\n     * @return {undefined}\n     */\n    function clearRemoved(id) {\n      var _this = this;\n\n      delete _this.removed[id];\n    }\n  }\n})();\n","!function(){\"use strict\";angular.module(\"angular-jsonapi\",[\"uuid4\"]).constant(\"pluralize\",pluralize).constant(\"validateJS\",validate)}(),function(){\"use strict\";function n(n,t){function e(n){return new r(n)}function r(n){var t=this;t.factory=n,t.data={},t.removed={},t.size=0,t.indexIds=void 0}function a(n,e){var r=this,a=n.id;return void 0===a?void t.error(\"Can't add data without id!\",n):(void 0===r.data[a]?(r.data[a]=r.factory.modelFactory(n,e),r.size+=1):r.data[a].update(n,e.saved,e.initialization),r.data[a])}function o(n){var t=this,e=angular.fromJson(n),r={saved:!0,\"synchronized\":!1,stable:!1,pristine:!1,initialization:!0};angular.isObject(e)&&void 0!==e.data&&(t.updatedAt=e.updatedAt,t.indexIds=e.indexIds,angular.forEach(e.data,function(n){var e=n.data;t.addOrUpdate(e,r,n.updatedAt)}))}function i(){var n=this,t={data:[],updatedAt:n.updatedAt,indexIds:n.indexIds};return angular.forEach(n.data,function(n){n.error===!1&&t.data.push(n.toJson())}),angular.toJson(t)}function s(){var n=this;n.indexIds=void 0,n.data={},n.removed={}}function c(n){var t=this,e={id:n,type:t.factory.schema.type},r={saved:!0,\"synchronized\":!1,stable:!1,pristine:!0};return void 0===t.data[n]&&(t.data[n]=t.factory.modelFactory(e,r)),t.data[n]}function u(n){var e=this;return t.debug(\"Unused params\",n),void 0===e.indexIds?e.indexIds:e.indexIds.map(e.get.bind(e))}function l(t){var e=this;e.indexIds=[],angular.forEach(t,function(t){angular.isString(t)&&n.validate(t)?e.indexIds.push(t):angular.isObject(t)&&n.validate(t.data.id)&&e.indexIds.push(t.data.id)})}function d(n){var t=this;return void 0!==t.data[n]&&(t.removed[n]=t.data[n],delete t.data[n],t.size-=1),t.removed[n]}function h(n){var t=this;return void 0!==t.removed[n]&&(t.data[n]=t.removed[n],delete t.removed[n],t.size+=1),t.data[n]}function p(n){var t=this;delete t.removed[n]}return r.prototype.get=c,r.prototype.index=u,r.prototype.setIndexIds=l,r.prototype.addOrUpdate=a,r.prototype.fromJson=o,r.prototype.toJson=i,r.prototype.clear=s,r.prototype.remove=d,r.prototype.revertRemove=h,r.prototype.clearRemoved=p,{create:e}}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPIResourceCache\",n),n.$inject=[\"uuid4\",\"$log\"]}(),function(){\"use strict\";function n(n,t){function e(e,r,a){function o(n,t){var e=this;e.parent=n,e.key=t,e.schema=n.schema.relationships[t],e.undefined=!0,e[\"null\"]=!1}function i(n){var t=this;return t.parent.unlink(t.key,n)}function s(e){var r=this;if(r.schema.polymorphic===!0){if(void 0===e)return void t.error(\"Run initialize with type for polymorphic asscoiation\")}else e=r.schema.model;var a=n.getResource(e).initialize();return a.form.link(r.schema.reflection,r),a}function c(n){var t=this;return t.length=0,t.undefined=!1,t.push.apply(t,n),t[\"null\"]=0===t.length,t}return o.prototype=a,o.prototype.constructor=o,o.prototype.add=c,o.prototype.set=c,o.prototype.remove=i,o.prototype.initialize=s,new o(e,r)}return{create:e}}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPIModelRelationshipHasOne\",n),n.$inject=[\"$jsonapi\",\"$log\"]}(),function(){\"use strict\";function n(n,t){function e(n,t){return new r(n,t)}function r(n,t){var e=this;e.parent=n,e.key=t,e.schema=n.schema.relationships[t],e.undefined=!0,e[\"null\"]=!1}function a(n){var t=this;return t.parent.link(t.key,n)}function o(n){var t=this;return t.parent.unlink(t.key,n)}function i(e){var r=this;if(r.schema.polymorphic===!0){if(void 0===e)return void t.error(\"Run initialize with type for polymorphic asscoiation\")}else e=r.schema.model;var a=n.getResource(e).initialize();return a.form.link(r.schema.reflection,r),a}function s(n){var t=this;return t.length=0,t.undefined=!1,t.push.apply(t,n),t[\"null\"]=0===t.length,t}function c(n){var t=this;return t.undefined=!1,t.undefined=null,t.push(n)}function u(n){var t=this,e=t.indexOf(n);return e>-1?null:(t.splice(e,1),t[\"null\"]=0===t.length,n)}function l(){t.error(\"User add or __push instead\")}function d(){t.error(\"User remove or __pop instead\")}return r.prototype=Object.create(Array.prototype),r.prototype.constructor=r,r.prototype.add=a,r.prototype.remove=o,r.prototype.set=s,r.prototype.initialize=i,r.prototype.push=l,r.prototype.splice=d,r.prototype.__push=c,r.prototype.__pop=u,{create:e}}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPIModelRelationshipHasMany\",n),n.$inject=[\"$jsonapi\",\"$log\"]}(),function(){\"use strict\";function n(n){function t(n){return null===n?null:{type:n.data.type,id:n.data.id}}function e(t,e,r,i){var u;return void 0===t?(n.error(\"Can't add link to non existing object\",t,e,r),n.error(\"Object:\",t.data.type,t),n.error(\"Target:\",r.data.type,r),n.error(\"Key:\",e),[]):(u=t.schema.relationships[e],void 0===r?(n.error(\"Can't link non existing object\",t,e,r,u),n.error(\"Object:\",t.data.type,t),n.error(\"Target:\",r.data.type,r),n.error(\"Key:\",e),n.error(\"Schema:\",u),[]):void 0===u?(n.error(\"Can't add link not present in schema:\",t,e,r,u),n.error(\"Object:\",t.data.type,t),n.error(\"Target:\",r.data.type,r),n.error(\"Key:\",e),n.error(\"Schema:\",u),[]):null!==r&&u.polymorphic===!1&&u.model!==r.data.type?(n.error(\"This relation is not polymorphic, expected: \"+u.model+\" instead of \"+r.data.type),n.error(\"Object:\",t.data.type,t),n.error(\"Target:\",r.data.type,r),n.error(\"Key:\",e),n.error(\"Schema:\",u),[]):\"hasMany\"===u.type?i===!0?(c(t,e,r,!1),[]):a(t,e,r):\"hasOne\"===u.type?i===!0?(s(t,e,r,!1),[]):o(t,e,r):void 0)}function r(t,e,r,a){var o;return void 0===t?(n.error(\"Can't remove link from non existing object\",t,e,r),n.error(\"Object:\",t.data.type,t),n.error(\"Target:\",r.data.type,r),n.error(\"Key:\",e),[]):(o=t.schema.relationships[e],void 0===o?(n.error(\"Can't remove link not present in schema:\",t,e,r,o),n.error(\"Object:\",t.data.type,t),n.error(\"Target:\",r.data.type,r),n.error(\"Key:\",e),n.error(\"Schema:\",o),[]):a===!0?(l(t,e,r,!1),[]):i(t,e,r))}function a(n,t,e){var r,a=n.schema.relationships[t].reflection;return a===!1?(c(n,t,e),[]):(r=e.schema.relationships[a],\"hasOne\"===r.type?h(d(n,t,e),d(e,a,n),o(e,a,n)):\"hasMany\"===r.type?(c(n,t,e),c(e,a,n),[d(e,a,n)]):void 0)}function o(n,t,e){var r,a,o=n.schema.relationships[t].reflection,i=n.relationships[t],d=[];return s(n,t,e),void 0!==i&&null!==i&&(a=i.schema.relationships[o],\"hasOne\"===a.type?u(i,o,n):\"hasMany\"===a.type&&l(i,o,n),d.push(i,o,n)),void 0!==e&&null!==e&&o!==!1&&(r=e.schema.relationships[o],\"hasOne\"===r.type?s(e,o,n):\"hasMany\"===r.type&&c(e,o,n),d.push(e,o,n)),d}function i(n,t,e){var r,a=n.schema.relationships[t],o=a.reflection;return\"hasMany\"===a.type?l(n,t,e):\"hasOne\"===a.type&&u(n,t,e),o===!1?[]:(r=e.schema.relationships[o],\"hasOne\"===r.type?u(e,o,n):\"hasMany\"===r.type&&l(e,o,n),[d(e,o,n)])}function s(e,r,a,o){return n.debug(\"addHasOne\",e,r,a),e.relationships[r]=a,e.data.relationships[r].data=t(a),o!==!1&&e.reset(!0),!0}function c(e,r,a,o){var i=t(a);return n.debug(\"addHasMany\",e,r,a),angular.isArray(e.relationships[r])&&e.relationships[r].indexOf(a)>-1?!1:(e.relationships[r]=e.relationships[r]||[],e.data.relationships[r].data=e.data.relationships[r].data||[],e.relationships[r].push(a),e.data.relationships[r].data.push(i),o!==!1&&e.reset(!0),!0)}function u(t,e,r,a){return n.debug(\"removeHasOne\",t,e,r),void 0!==r&&t.relationships[e]!==r?!1:(t.relationships[e]=null,t.data.relationships[e].data=void 0,a!==!1&&t.reset(!0),!0)}function l(t,e,r,a){if(n.debug(\"removeHasMany\",t,e,r),void 0!==t.relationships[e]){if(void 0===r)return t.relationships[e]=[],t.data.relationships[e].data=[],a!==!1&&t.reset(!0),!0;var o=t.relationships[e].indexOf(r);return-1===o?!1:(t.relationships[e].splice(o,1),t.data.relationships[e].data.splice(o,1),a!==!1&&t.reset(!0),!0)}}function d(n,t,e){return{object:n,key:t,target:e}}function h(n,t,e){var r=-1;return angular.forEach(e,function(t,e){t.object===n.object&&t.key===n.key&&t.target===n.target&&(r=e)}),r>-1?e[r]=t:e.push(t),e}var p=this;return p.toLinkData=t,p.link=e,p.unlink=r,this}angular.module(\"angular-jsonapi\").service(\"AngularJsonAPIModelLinkerService\",n),n.$inject=[\"$log\"]}(),function(){\"use strict\";function n(n,t,e,r){function a(n){return new o(n)}function o(n){var t=this;t.data={id:n.data.id,type:n.data.type,attributes:{},relationships:{}},t.relationships={},t.parent=n,t.schema=n.schema,t.reset()}function i(){var n=this,t=angular.copy(n.data),e={};return angular.forEach(t.relationships,function(n,t){void 0!==n.data&&(e[t]=n)}),t.relationships=e,{data:t}}function s(){var n=this;return n.parent.save()}function c(n){var t=this;angular.forEach(t.schema.relationships,function(n,e){t.data.relationships[e]=angular.copy(t.parent.data.relationships[e])||{},t.relationships[e]=angular.isArray(t.relationships[e])?t.parent.relationships[e].slice():t.parent.relationships[e]}),(n!==!0||t.parent[\"synchronized\"]!==!0)&&(angular.forEach(t.schema.attributes,function(n,e){t.data.attributes[e]=angular.copy(t.parent.data.attributes[e])}),t.parent.errors.validation.clear())}function u(t){function a(){void 0===t?c.parent.errors.validation.clear():c.parent.errors.validation.clear(t),u.resolve()}function o(e){c.parent.error=!0,void 0===t?c.parent.errors.validation.clear():c.parent.errors.validation.clear(t),angular.forEach(e,function(t,e){angular.forEach(t,function(t){c.parent.errors.validation.add(e,n.create(t,e))})}),u.reject(c.parent.errors.validation)}var i,s,c=this,u=r.defer();return void 0===t?(i=c.data.attributes,s=c.schema.attributes):(i={},s={},i[t]=c.data.attributes[t],s[t]=c.schema.attributes[t]),e.async(i,s).then(a,o),u.promise}function l(n,e){var a=this;return r.resolve(t.link(a,n,e,!0))}function d(n,e){var a=this;return r.resolve(t.unlink(a,n,e,!0))}return o.prototype.save=s,o.prototype.reset=c,o.prototype.validate=u,o.prototype.link=l,o.prototype.unlink=d,o.prototype.toJson=i,{create:a}}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPIModelForm\",n),n.$inject=[\"AngularJsonAPIModelValidationError\",\"AngularJsonAPIModelLinkerService\",\"validateJS\",\"$q\"]}(),function(){\"use strict\";function n(n,o,i,s,c,u,l,d,h,p){function f(t,e,r){var a=this;t.relationships=t.relationships||{},a.saved=void 0===e.saved?!0:e.saved,a.stable=void 0===e.stable?!0:e.stable,a[\"synchronized\"]=void 0===e[\"synchronized\"]?!0:e[\"synchronized\"],a.pristine=void 0===e.pristine?!0:e.pristine,a.removed=!1,a.loading=!1,a.saving=!1,a.updatedAt=a[\"synchronized\"]===!0?Date.now():r,a.loadingCount=0,a.savingCount=0,a.data={relationships:{},attributes:{}},a.relationships={},angular.forEach(a.schema.relationships,function(n,t){a.relationships[t]=void 0}),a.errors={validation:i.create(\"Validation\",\"Errors of attributes validation\",o),synchronization:i.create(\"Synchronization\",\"Errors of synchronizations\",n)},a.promises={},P(a,t),a.form=c.create(a)}function y(){function n(){i.synchronize(c).then(t,e,o)}function t(n){l.$emit(\"angularJsonAPI:\"+i.data.type+\":object:\"+c.action,\"resolved\",i,n),i.update(i.form.data),i.saved===!1&&(i.factory.cache.indexIds=i.factory.cache.indexIds||[],i.factory.cache.indexIds.push(i.data.id)),i[\"synchronized\"]=!0,i.saved=!0,i.stable=!0,n.finish(),i.errors.synchronization.concat(n.errors),s.resolve(i)}function e(n){l.$emit(\"angularJsonAPI:\"+i.data.type+\":object:save\",\"rejected\",i,n),n.finish(),i.errors.synchronization.concat(n.errors),s.reject(n)}function o(n){l.$emit(\"angularJsonAPI:\"+i.data.type+\":object:save\",\"notify\",i,n),s.notify(n)}var i=this,s=p.defer(),c={action:i.saved===!1?\"add\":\"update\",object:i};return i.form.validate().then(n,s.reject)[\"finally\"](a.bind(i,void 0)),r(i),s.promise}function g(){var n=this;void 0!==n.form&&n.form.reset()}function v(){function r(n){function r(n){return t(n),n.synchronize({action:\"include\",object:n})[\"finally\"](e.bind(n,void 0))}function a(t){angular.forEach(t,function(n,t){n.success===!0&&(l.$emit(\"angularJsonAPI:\"+o.included[t].data.type+\":object:include\",\"resolved\",o.included[t],n),n.value.finish())}),s.resolve(n)}var o=i.proccesResults(n.data);l.$emit(\"angularJsonAPI:\"+c.data.type+\":object:refresh\",\"resolved\",c,n),p.allSettled(o.included.map(r)).then(a,s.reject),c[\"synchronized\"]=!0,c.stable=!0,n.finish(),c.errors.synchronization.concat(n.errors)}function a(n){l.$emit(\"angularJsonAPI:\"+c.data.type+\":object:refresh\",\"rejected\",c,n),n.finish(),c.errors.synchronization.concat(n.errors),s.reject(n)}function o(n){l.$emit(\"angularJsonAPI:\"+c.data.type+\":object:refresh\",\"notify\",c,n),s.notify(n)}var i=d.get(\"$jsonapi\"),s=p.defer(),c=this,u={action:\"refresh\",object:c,params:c.schema.params.get};if(c.saved===!1){var h=n.create(\"Can't refresh new object\",null,0,\"refresh\");c.errors.synchronization.add(\"refresh\",h),s.reject(h)}else t(c),c.synchronize(u).then(r,a,o)[\"finally\"](e.bind(c,void 0));return s.promise}function m(){var n=this,t=angular.copy(n.data),e={};return angular.forEach(t.relationships,function(n,t){void 0!==n.data&&(e[t]=n)}),t.relationships=e,{data:t,updatedAt:n.updatedAt}}function j(){function n(n){l.$emit(\"angularJsonAPI:\"+o.data.type+\":object:remove\",\"resolved\",o,n),o.removed=!0,o.unlinkAll(),o.factory.cache.clearRemoved(o.data.id),n.finish(),o.errors.synchronization.concat(n.errors),i.resolve(n)}function t(n){l.$emit(\"angularJsonAPI:\"+o.data.type+\":object:remove\",\"rejected\",o,n),o.factory.cache.revertRemove(o.data.id),n.finish(),o.errors.synchronization.concat(n.errors),i.reject(n)}function e(n){l.$emit(\"angularJsonAPI:\"+o.data.type+\":object:remove\",\"notify\",o,n),i.notify(n)}var o=this,i=p.defer(),s={action:\"remove\",object:o};return o.factory.cache.remove(o.data.id),o.saved===!1?i.resolve():(r(o),o.synchronize(s).then(n,t,e)[\"finally\"](a.bind(o,void 0))),i.promise}function b(n){function r(n,t){var e=o.schema.relationships[t],r=e.reflection;angular.isArray(n)?angular.forEach(n,a.bind(void 0,r)):angular.isObject(n)&&a(r,n),\"hasOne\"===e.type?o.relationships[t]=null:\"hasMany\"===e.type&&(o.relationships[t]=[])}function a(n,r){function a(n){l.$emit(\"angularJsonAPI:\"+o.data.type+\":object:unlinkReflection\",\"resolve\",o,n),n.finish(),o.errors.synchronization.concat(n.errors),i.resolve(o)}function c(n){l.$emit(\"angularJsonAPI:\"+o.data.type+\":object:unlinkReflection\",\"rejected\",o,n),n.finish(),o.errors.synchronization.concat(n.errors),i.reject(n)}function u(n){l.$emit(\"angularJsonAPI:\"+o.data.type+\":object:unlinkReflection\",\"notify\",o,n),n.finish(),i.notify(n)}var d=r.schema.relationships[n],h={action:\"unlinkReflection\",object:r,target:o,key:n};t(r),s.unlink(r,n,o,d),r.synchronize(h).then(a,c,u)[\"finally\"](e.bind(r,void 0))}var o=this,i=p.defer();return t(o),void 0===n?angular.forEach(o.relationships,r):r(o.relationships[n],n),e(o),i.promise}function A(o,i){function c(n){function r(n){return t(i),i.synchronize({action:\"linkReflection\",object:n.object,target:n.target,key:n.key})[\"finally\"](e.bind(i,void 0))}function a(n){angular.forEach(n,function(t){t.success===!0&&(l.$emit(\"angularJsonAPI:\"+c[o].data.type+\":object:linkReflection\",\"resolved\",c[o],t),n.value.finish())}),f.resolve(y)}l.$emit(\"angularJsonAPI:\"+y.data.type+\":object:link\",\"resolved\",y,n);var c=s.link(y,o,i);y.stable=!0,n.finish(),y.errors.synchronization.concat(n.errors),p.allSettled(c.map(r)).then(a,f.reject)}function u(n){l.$emit(\"angularJsonAPI:\"+y.data.type+\":object:link\",\"rejected\",y,n),f.reject(n.errors),n.finish(),y.errors.synchronization.concat(n.errors),f.reject(n)}function d(n){l.$emit(\"angularJsonAPI:\"+y.data.type+\":object:link\",\"notify\",y,n),f.notify(n)}var h,f=p.defer(),y=this,g={action:\"link\",object:y,target:i,key:o};return void 0===i?(h=n.create(\"Can't link undefined\",null,0,\"link\"),y.errors.synchronization.add(\"link\",h),f.reject(h)):y.saved===!1?(h=n.create(\"Can't link new object\",null,0,\"link\"),y.errors.synchronization.add(\"link\",h),f.reject(h)):(r(y),y.synchronize(g).then(c,u,d)[\"finally\"](a.bind(y,void 0))),f.promise}function k(o,i){function c(n){function r(n){return t(i),i.synchronize({action:\"unlinkReflection\",object:n.object,target:n.target,key:n.key})[\"finally\"](e.bind(i,void 0))}function a(n){angular.forEach(n,function(t){t.success===!0&&(l.$emit(\"angularJsonAPI:\"+c[o].data.type+\":object:unlinkReflection\",\"resolved\",c[o],t),n.value.finish())}),f.resolve(y)}l.$emit(\"angularJsonAPI:\"+y.data.type+\":object:unlink\",\"resolved\",y,n);var c=s.link(y,o,i);y.stable=!0,n.finish(),y.errors.synchronization.concat(n.errors),p.allSettled(c.map(r)).then(a,f.reject)}function u(n){l.$emit(\"angularJsonAPI:\"+y.data.type+\":object:unlink\",\"rejected\",y,n),f.reject(n.errors),n.finish(),y.errors.synchronization.concat(n.errors),f.reject(n)}function d(n){l.$emit(\"angularJsonAPI:\"+y.data.type+\":object:unlink\",\"notify\",y,n),f.notify(n)}var h,f=p.defer(),y=this,g={action:\"unlink\",object:y,target:i,key:o};return void 0===i?(h=n.create(\"Can't unlink undefined\",null,0,\"link\"),y.errors.synchronization.add(\"link\",h),f.reject(h)):y.saved===!1?(h=n.create(\"Can't unlink new object\",null,0,\"link\"),y.errors.synchronization.add(\"link\",h),f.reject(h)):(r(y),y.synchronize(g).then(c,u,d)[\"finally\"](a.bind(y,void 0))),f.promise}function z(n,r,a){var o=this;t(o),P(o,n),o.reset(r),o[\"synchronized\"]=a===!0?!1:!0,o.stable=a===!0?!1:!0,o.updatedAt=Date.now(),e(o)}function I(){var n=this,t=!1;return angular.forEach(n.errors,function(n){t=n.hasErrors()||t}),t}function P(n,t){function e(e,r){n.data.attributes[r]=t.attributes[r]}function r(e,r){var i=t.relationships[r];return void 0===i?void(n.data.relationships[r]={data:void 0}):(n.data.relationships[r]=n.data.relationships[r]||{},n.data.relationships[r].links=i.links,void(\"hasOne\"===e.type?a(n,r,i.data):\"hasMany\"===e.type&&angular.isArray(i.data)&&(0===i.data.length?(n.data.relationships[r].data=[],n.unlinkAll(r)):(angular.forEach(n.relationships[r],o.bind(void 0,n,r,i.data)),angular.forEach(i.data,a.bind(void 0,n,r))))))}function a(n,t,e){var r;if(null===e)return void s.link(n,t,null);if(void 0!==e){if(r=i.getResource(e.type),void 0===r)return void h.error(\"Factory not found\",e.type,e);var a=r.cache.get(e.id);s.link(n,t,a)}}function o(n,t,e,r){e.indexOf(r.data.id)>-1||s.unlink(n,t,r)}var i=d.get(\"$jsonapi\"),c=n.schema;return n.data.id=t.id,n.data.type=t.type,n.factory.schema.type!==t.type?(h.error(\"Different type then factory\",n.factory.schema.type,t),!1):u.validate(n.data.id)?(t.attributes=t.attributes||{},t.relationships=t.relationships||{},angular.forEach(c.attributes,e),angular.forEach(c.relationships,r),!0):(h.error(\"Invalid id\"),!1)}return f.prototype.refresh=v,f.prototype.remove=j,f.prototype.reset=g,f.prototype.save=y,f.prototype.update=z,f.prototype.link=A,f.prototype.unlink=k,f.prototype.unlinkAll=b,f.prototype.toJson=m,f.prototype.hasErrors=I,f}function t(n){n=void 0===n?this:n,n.loadingCount+=1,n.loading=!0}function e(n){n=void 0===n?this:n,n.loadingCount-=1,n.loading=n.loadingCount>0}function r(n){n=void 0===n?this:n,n.savingCount+=1,n.saving=!0}function a(n){n=void 0===n?this:n,n.savingCount-=1,n.saving=n.savingCount>0}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPIAbstractModel\",n),n.$inject=[\"AngularJsonAPIModelSynchronizationError\",\"AngularJsonAPIModelValidationError\",\"AngularJsonAPIModelErrorsManager\",\"AngularJsonAPIModelLinkerService\",\"AngularJsonAPIModelForm\",\"uuid4\",\"$rootScope\",\"$injector\",\"$log\",\"$q\"]}(),function(){\"use strict\";function n(){function n(n,e){return new t(n,e)}function t(n,t){var e=this;Error.captureStackTrace(e,e.constructor),e.message=n,e.context={attribute:t}}return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t.prototype.name=\"ValidationError\",{create:n}}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPIModelValidationError\",n)}(),function(){\"use strict\";function n(){function n(n,e,r,a){return new t(n,e,r,a)}function t(n,t,e,r){var a=this;Error.captureStackTrace(a,a.constructor),a.message=n,a.context={synchronization:t,code:e,action:r}}return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t.prototype.name=\"SynchronizationError\",{create:n}}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPIModelSynchronizationError\",n)}(),function(){\"use strict\";function n(){function n(n,e,r,a){return new t(n,e,r,a)}function t(n,t,e,r){var a=this;a.name=n,a.description=t,a.ErrorConstructor=e,a.errors={},a.defaultFilter=r||function(){return!0}}function e(n){var t=this;void 0===n?angular.forEach(t.errors,function(n,e){t.errors[e]=[]}):t.errors[n]=[]}function r(n,t){var e=this;e.errors[n]=e.errors[n]||[],e.errors[n].push(t)}function a(n){var t=this;angular.forEach(n,function(n){t.errors[n.key]=[]}),angular.forEach(n,function(n){t.errors[n.key].push(n.object)})}function o(n){var t=this;if(void 0===n){var e=!1;return angular.forEach(t.errors,function(n){e=e||n.length>0}),e}return void 0!==t.errors[n]&&t.errors[n].length>0}return t.prototype.constructor=t,t.prototype.concat=a,t.prototype.clear=e,t.prototype.add=r,t.prototype.hasErrors=o,{create:n}}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPIModelErrorsManager\",n)}(),function(){\"use strict\";angular.module(\"angular-jsonapi\").constant(\"lazyProperty\",function(n,t,e){var r,a;Object.defineProperty(n,t,{get:function(){return a||(a=!0,r=e.call(n)),r},enumerable:!0,configurable:!0})})}(),function(){\"use strict\";angular.module(\"angular-jsonapi\").constant(\"toKebabCase\",function(n){return n.replace(/([a-z])([A-Z])/g,\"$1-$2\").toLowerCase()})}(),function(){\"use strict\";angular.module(\"angular-jsonapi\").config([\"$provide\",function(n){n.decorator(\"$q\",[\"$delegate\",function(n){var t=n;return t.allSettled=t.allSettled||function(n,e,r){function a(n){return t.resolve(n).then(function(n){return angular.isFunction(e)&&e(n),{success:!0,value:n}},function(n){return angular.isFunction(r)&&r(n),{success:!1,reason:n}})}var o=angular.isArray(n)?[]:{};return angular.forEach(n,function(n,t){o.hasOwnProperty(t)||(o[t]=a(n))}),t.all(o)},t}])}])}(),function(){\"use strict\";function n(n,t,e){function r(n){return new a(n)}function a(t){var e=this;e.state={},n.call(e,t),angular.forEach(t,function(n){n.synchronizer=e})}function o(r){function a(n){d.notify({step:\"synchronization\",data:n})}function o(n){d.notify({step:\"synchronization\",errors:n})}function i(n){u.state[h]=u.state[h]||{},u.state[h].success=!0,angular.forEach(n,function(n){n.success===!1&&(u.state[h].success=!1)}),angular.forEach(u.synchronizations,function(t){angular.forEach(t.afterHooks[h],function(t){d.notify({step:\"after\",errors:t.call(u,r,n)})})});var t,e=[];angular.forEach(n,function(n){n.success===!0?t=n.value:e.push({key:h,object:n.reason})}),e.length>0?d.reject({data:t,finish:s,errors:e}):d.resolve({data:t,finish:s,errors:e})}function s(){angular.forEach(u.synchronizations,function(n){angular.forEach(n.finishHooks[h],function(n){d.notify({step:\"finish\",errors:n.call(u,r)})})})}function c(n){e.error(\"All settled rejected! Something went wrong\"),d.reject({finish:angular.noop,errors:n})}var u=this,l=[],d=t.defer(),h=r.action;return n.prototype.synchronize.call(u,r),angular.forEach(u.synchronizations,function(n){angular.forEach(n.beginHooks[h],function(n){d.notify({step:\"begin\",data:n.call(u,r)})})}),angular.forEach(u.synchronizations,function(n){angular.forEach(n.beforeHooks[h],function(n){d.notify({step:\"before\",data:n.call(u,r)})})}),angular.forEach(u.synchronizations,function(n){angular.forEach(n.synchronizationHooks[h],function(n){l.push(n.call(u,r))})}),t.allSettled(l,a,o).then(i,c),d.promise}return a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.synchronize=o,{create:r}}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPISynchronizerSimple\",n),n.$inject=[\"AngularJsonAPISynchronizerPrototype\",\"$q\",\"$log\"]}(),function(){\"use strict\";function n(n){function t(n){var t=this;t.synchronizations=n}function e(t){var e=this;n.debug(\"Synchro Collection\",e.factory.schema.type,t),void 0===t.action&&n.error(\"Can't synchronize undefined action\",t)}return t.prototype.synchronize=e,t}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPISynchronizerPrototype\",n),n.$inject=[\"$log\"]}(),function(){\"use strict\";function n(n,t,e,r,a,o){function i(n,t){return new s(n,t)}function s(r,i){function s(n){return o({method:\"GET\",headers:v,url:i,params:n.params||{}}).then(f,y.bind(null,\"all\"))}function c(n){return o({method:\"GET\",headers:v,url:i+\"/\"+n.object.data.id,params:n.params||{}}).then(f,y.bind(null,\"get\"))}function u(n){return o({method:\"DELETE\",headers:v,url:i+\"/\"+n.object.data.id}).then(f,y.bind(null,\"remove\"))}function l(t){var e=a.defer(),r=t.object.schema.relationships[t.key];return t.object.removed===!0?e.reject(n.create(\"Object has been removed\",g,0,\"unlink\")):void 0!==t.target&&void 0===t.target.data.id?e.reject(n.create(\"Can't unlink object without id through rest call\",g,0,\"unlink\")):\"hasOne\"===r.type?o({method:\"DELETE\",headers:v,url:i+\"/\"+t.object.data.id+\"/relationships/\"+t.key}).then(f,y.bind(null,\"get\")).then(e.resolve,e.reject):\"hasMany\"===r.type&&(void 0===t.target?o({method:\"PUT\",headers:v,data:{data:[]},url:i+\"/\"+t.object.data.id+\"/relationships/\"+t.key}).then(f,y.bind(null,\"unlink\")).then(e.resolve,e.reject):o({method:\"DELETE\",headers:v,url:i+\"/\"+t.object.data.id+\"/relationships/\"+t.key+\"/\"+t.target.data.id}).then(f,y.bind(null,\"unlink\")).then(e.resolve,e.reject)),e.promise}function d(n){var t=a.defer(),r=n.object.schema.relationships[n.key];return n.object.removed===!0?t.reject({errors:[{status:0,statusText:\"Object has been removed\"}]}):void 0===n.target||void 0===n.target.data.id?t.reject({errors:[{status:0,statusText:\"Can't link object without id through rest call\"}]}):\"hasOne\"===r.type?o({method:\"PUT\",headers:v,data:{data:e.toLinkData(n.target)},url:i+\"/\"+n.object.data.id+\"/relationships/\"+n.key}).then(f,y.bind(null,\"link\")).then(t.resolve,t.reject):\"hasMany\"===r.type&&o({method:\"POST\",headers:v,data:{data:[e.toLinkData(n.target)]},url:i+\"/\"+n.object.data.id+\"/relationships/\"+n.key}).then(f,y.bind(null,\"link\")).then(t.resolve,t.reject),t.promise}function h(n){return o({method:\"PUT\",headers:v,url:i+\"/\"+n.object.data.id,data:n.object.form.toJson()}).then(f,y.bind(null,\"update\"))}function p(n){return o({method:\"POST\",headers:v,url:i+\"/\",data:n.object.form.toJson()}).then(f,y.bind(null,\"add\"))}function f(n){return a.resolve(n.data)}function y(t,e){function r(e){console.log(\"offline\"),console.log(e),s.reject(n.create(\"Server is offline\",g,e.status,t))}function i(){console.log(\"no internet\"),s.reject(n.create(\"No internet connection\",g,e.status,t))}var s=a.defer();return 0===e.status?o({method:\"GET\",url:\"https://status.cloud.google.com/incidents.schema.json\"}).then(r,i):s.reject(n.create(e.statusText,g,e.status,t)),s.promise}var g=this,v={Accept:\"application/vnd.api+json\",\"Content-Type\":\"application/vnd.api+json\"};t.apply(g,arguments),g.synchronization(\"remove\",u),g.synchronization(\"unlink\",l),g.synchronization(\"link\",d),g.synchronization(\"update\",h),g.synchronization(\"add\",p),g.synchronization(\"all\",s),g.synchronization(\"get\",c),g.synchronization(\"refresh\",c)}return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,{create:i}}angular.module(\"angular-jsonapi-rest\",[\"angular-jsonapi\"]).factory(\"AngularJsonAPISynchronizationRest\",n),n.$inject=[\"AngularJsonAPIModelSynchronizationError\",\"AngularJsonAPISynchronizationPrototype\",\"AngularJsonAPIModelLinkerService\",\"toKebabCase\",\"$q\",\"$http\"]}(),function(){\"use strict\";function n(){function n(n){var t=this,e=[\"add\",\"init\",\"get\",\"all\",\"clearCache\",\"remove\",\"unlink\",\"unlinkReflection\",\"link\",\"linkReflection\",\"update\",\"refresh\",\"include\"];t.name=n,t.state={},t.beginHooks={},t.beforeHooks={},t.synchronizationHooks={},t.afterHooks={},t.finishHooks={},t.options={},angular.forEach(e,function(n){t.beginHooks[n]=[],t.beforeHooks[n]=[],t.synchronizationHooks[n]=[],t.afterHooks[n]=[],t.finishHooks[n]=[],t.state[n]={loading:!1,success:!0}})}function t(n,t){var e=this;e.beginHooks[n].push(t)}function e(n,t){var e=this;e.finishHooks[n].push(t)}function r(n,t){var e=this;e.beforeHooks[n].push(t)}function a(n,t){var e=this;e.afterHooks[n].push(t)}function o(n,t){var e=this;e.synchronizationHooks[n].push(t)}return n.prototype.before=r,n.prototype.after=a,n.prototype.begin=t,n.prototype.finish=e,n.prototype.synchronization=o,n}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPISynchronizationPrototype\",n)}(),function(){\"use strict\";function n(n,t,e){function r(n,t){return new a(n,t)}function a(r,a){function o(){var n=c.synchronizer.factory.schema.type;return e.resolve(t.localStorage.getItem(a+\".\"+n))}function i(){var n=c.synchronizer.factory.schema.type;t.localStorage.removeItem(a+\".\"+n)}function s(){var n=c.synchronizer.factory.schema.type,e=c.synchronizer.factory.cache;t.localStorage.setItem(a+\".\"+n,e.toJson())}var c=this;a=a||\"AngularJsonAPI\",c.__updateStorage=s,n.apply(c,arguments),c.synchronization(\"init\",o),c.begin(\"clearCache\",i),c.begin(\"remove\",s),c.begin(\"refresh\",s),c.begin(\"unlink\",s),c.begin(\"unlinkReflection\",s),c.begin(\"link\",s),c.begin(\"linkReflection\",s),c.begin(\"update\",s),c.begin(\"add\",s),c.begin(\"get\",s),c.begin(\"all\",s),c.begin(\"include\",s),c.finish(\"init\",s),c.finish(\"clearCache\",s),c.finish(\"remove\",s),c.finish(\"refresh\",s),c.finish(\"unlink\",s),c.finish(\"unlinkReflection\",s),c.finish(\"link\",s),c.finish(\"linkReflection\",s),c.finish(\"update\",s),c.finish(\"add\",s),c.finish(\"get\",s),c.finish(\"all\",s),c.finish(\"include\",s)}return a.prototype=Object.create(n.prototype),a.prototype.constructor=a,{create:r}}angular.module(\"angular-jsonapi-local\",[\"angular-jsonapi\"]).factory(\"AngularJsonAPISynchronizationLocal\",n),n.$inject=[\"AngularJsonAPISynchronizationPrototype\",\"$window\",\"$q\"]}(),function(){\"use strict\";function n(n,t,e){function r(n){return new a(n)}function a(n){var t=this,r=n.include||{};n.include=r,r.get=n.include.get||[],r.all=n.include.all||[],t.params={get:{},all:{}},angular.forEach(n.relationships,function(t,a){var o=e.create(t,a,n.type);n.relationships[a]=o,o.included===!0&&(r.get.push(a),\"hasOne\"===o.type&&r.all.push(a))}),angular.extend(t,n),r.get.length>0&&(t.params.get.include=r.get.join(\",\")),r.all.length>0&&(t.params.all.include=r.all.join(\",\"))}return{create:r}}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPISchema\",n),n.$inject=[\"$log\",\"pluralize\",\"AngularJsonAPISchemaLink\"]}(),function(){\"use strict\";function n(n,t){function e(n,t,e){return new r(n,t,e)}function r(e,r,a){var o=this;angular.isString(e)?(o.model=t.plural(r),o.type=e,o.polymorphic=!1,o.reflection=a):(void 0===e.type&&n.error(\"Schema of link without a type: \",e,r),\"hasMany\"!==e.type&&\"hasOne\"!==e.type&&n.error(\"Schema of link with wrong type: \",e.type,\"available: hasOne, hasMany\"),o.model=e.model||t.plural(r),o.type=e.type,o.polymorphic=e.polymorphic||!1,o.reflection=void 0===e.reflection?\"hasMany\"===o.type?t.singular(a):a:e.reflection,o.included=e.included||!1)}return{create:e}}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPISchemaLink\",n),n.$inject=[\"$log\",\"pluralize\"]}(),function(){\"use strict\";function n(n,t,e,r,a,o,i,s){function c(n,t){return new u(n,t)}function u(r,a){function i(n){o.$emit(\"angularJsonAPI:\"+u.type+\":factory:init\",\"resolved\",n),u.cache.fromJson(n.data),u.initialized=!0,n.finish()}function s(n){o.$emit(\"angularJsonAPI:\"+u.type+\":factory:init\",\"rejected\",n),n.finish(),u.initialized=!0}function c(n){o.$emit(\"angularJsonAPI:\"+u.type+\":factory:init\",\"notify\",n)}var u=this,l={action:\"init\"};u.schema=t.create(r),u.cache=e.create(u),u.synchronizer=a,u.synchronizer.factory=u,u.modelFactory=n.modelFactory(u.schema,u),u.initialized=!1,u.type=u.schema.type,a.factory=u,u.synchronizer.synchronize(l).then(i,s,c)}function l(n){var t=this;if(!a.validate(n))return s.reject({errors:[{status:0,statusText:\"Invalid id not uuid4\"}]});var e=t.cache.get(n);return e.refresh(),e}function d(n){var t=this;n=n||{};var e=r.create(t,angular.extend(n,t.schema.params.all));return e.fetch(),e}function h(n){var t=this,e=t.cache.remove(n);return e.remove()}function p(){var n=this,t={};angular.forEach(n.schema.relationships,function(n,e){\"hasOne\"===n.type?t[e]={data:null}:\"hasMany\"===n.type&&(t[e]={data:[]})});var e={type:n.type,id:a.generate(),attributes:{},relationships:t},r={saved:!1,\"synchronized\":!1,stable:!1,pristine:!1,initialization:!1},i=n.cache.addOrUpdate(e,r);return o.$emit(\"angularJsonAPI:\"+n.type+\":factory:initialize\",\"resolved\",i),\ni}function f(){function n(n){o.$emit(\"angularJsonAPI:\"+r.type+\":factory:clearCache\",\"resolved\",n),n.finish(),a.resolve(n)}function t(n){o.$emit(\"angularJsonAPI:\"+r.type+\":factory:clearCache\",\"resolved\",n),n.finish(),a.reject(n)}function e(n){o.$emit(\"angularJsonAPI:\"+r.type+\":factory:clearCache\",\"notify\",n),a.notify(n)}var r=this,a=s.defer(),i={action:\"clearCache\"};return r.cache.clear(),r.synchronizer.synchronize(i).then(n,t,e),a}return u.prototype.get=l,u.prototype.all=d,u.prototype.remove=h,u.prototype.initialize=p,u.prototype.clearCache=f,{create:c}}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPIResource\",n),n.$inject=[\"AngularJsonAPIModel\",\"AngularJsonAPISchema\",\"AngularJsonAPIResourceCache\",\"AngularJsonAPICollection\",\"uuid4\",\"$rootScope\",\"$log\",\"$q\"]}(),function(){\"use strict\";function n(n,t,e){function r(t,r){function a(n,t,e){return new o(n,t,e)}var o=function(t,r,a){var o=this;t.type!==o.schema.type&&e.error(\"Data type other then declared in schema: \",t.type,\" instead of \",o.schema.type),n.call(o,t,r,a),o.form.parent=o};return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.schema=t,o.prototype.factory=r,o.prototype.synchronize=r.synchronizer.synchronize.bind(r.synchronizer),angular.forEach(t.functions,function(n,t){o.prototype[t]=function(){return n.apply(this,arguments)}}),a}return{modelFactory:r}}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPIModel\",n),n.$inject=[\"AngularJsonAPIAbstractModel\",\"AngularJsonAPISchema\",\"$log\"]}(),function(){\"use strict\";function n(n,r,a,o,i){function s(n,t){return new c(n,t)}function c(t,e){function o(n,t,e){var r;\"resolved\"===t&&void 0!==c.data&&(r=c.data.indexOf(e),r>-1&&(c.data.splice(r,1),c.factory.cache.setIndexIds(c.data)))}function i(){c.data=void 0,c.pristine=!0}function s(n,t,e){\"resolved\"===t&&(c.data=c.data||[],c.data.push(e))}var c=this;c.factory=t,c.type=t.schema.type,c.params=e,c.errors={synchronization:r.create(\"Synchronization\",\"Errors of synchronizations\",n)},c.data=c.factory.cache.index(c.params),c.loading=!1,c.loadingCount=0,c[\"synchronized\"]=!1,c.pristine=void 0===c.data,a.$on(\"angularJsonAPI:\"+c.type+\":object:remove\",o),a.$on(\"angularJsonAPI:\"+c.type+\":factory:clearCache\",i),a.$on(\"angularJsonAPI:\"+c.type+\":object:add\",s)}function u(){var n=this,t=!1;return angular.forEach(n.errors,function(n){t=n.hasErrors()||t}),t}function l(n){var t=this;return t.factory.get(n)}function d(){function n(n){function r(n){return t(n),n.synchronize({action:\"include\",object:n})[\"finally\"](e.bind(n,void 0))}function o(t){angular.forEach(t,function(n,t){n.success===!0&&(a.$emit(\"angularJsonAPI:\"+s.included[t].data.type+\":object:include\",\"resolved\",s.included[t],n),n.value.finish())}),u.resolve(n)}var s=l.proccesResults(n.data);a.$emit(\"angularJsonAPI:\"+c.type+\":collection:fetch\",\"resolved\",c,n),i.allSettled(s.included.map(r)).then(o,u.reject),angular.forEach(c.data,e),c.data=s.data,c.updatedAt=Date.now(),c[\"synchronized\"]=!0,c.factory.cache.setIndexIds(c.data),n.finish(),c.errors.synchronization.concat(n.errors),u.resolve(c)}function r(n){a.$emit(\"angularJsonAPI:\"+c.type+\":collection:fetch\",\"rejected\",c,n),console.log(n),angular.forEach(c.data,e),n.finish(),c.errors.synchronization.concat(n.errors),u.reject(n)}function s(n){a.$emit(\"angularJsonAPI:\"+c.type+\":collection:fetch\",\"notify\",c,n),u.notify(n)}var c=this,u=i.defer(),l=o.get(\"$jsonapi\"),d={action:\"all\",params:c.params};return t(c),angular.forEach(c.data,t),c.factory.synchronizer.synchronize(d).then(n,r,s)[\"finally\"](e.bind(c,void 0)),u.promise}return c.prototype.fetch=d,c.prototype.refresh=d,c.prototype.get=l,c.prototype.hasErrors=u,{create:s}}function t(n){n=void 0===n?this:n,n.loadingCount+=1,n.loading=!0}function e(n){n=void 0===n?this:n,n.loadingCount-=1,n.loading=n.loadingCount>0}angular.module(\"angular-jsonapi\").factory(\"AngularJsonAPICollection\",n),n.$inject=[\"AngularJsonAPIModelSynchronizationError\",\"AngularJsonAPIModelErrorsManager\",\"$rootScope\",\"$injector\",\"$q\"]}(),function(){\"use strict\";function n(){function n(n,r){function a(){return t}function o(){return e}function i(n,a){var o=r.create(n,a);t[n.type]=o,e.push(n.type)}function s(n){return t[n]}function c(e){return void 0===t[e]&&n.error(\"Can\t add not existing object type: \"+e+\". Use initialize.\"),t[e].saved.form}function u(e,r){return void 0===t[e]&&n.error(\"Can\t get not existing object type: \"+e+\". Use initialize.\"),t[e].get(r)}function l(e,r){return void 0===t[e]&&n.error(\"Can\t remove not existing object type: \"+e+\". Use initialize.\"),t[e].remove(r)}function d(e){return void 0===t[e]&&n.error(\"Can\t get all of not existing object type: \"+e+\". Use initialize.\"),t[e].all()}function h(){angular.forEach(t,function(n){n.clearCache()})}function p(t){var e={data:[],included:[]};void 0===t&&n.error(\"Can't proccess results:\",t);var r={saved:!0,\"synchronized\":!0,stable:!0,pristine:!1,initialization:!1};return angular.forEach(t.included,function(n){e.included.push(s(n.type).cache.addOrUpdate(n,r))}),angular.isArray(t.data)?angular.forEach(t.data,function(n){e.data.push(s(n.type).cache.addOrUpdate(n,r))}):e.data.push(s(t.data.type).cache.addOrUpdate(t.data,r)),e}return{form:c,get:u,remove:l,all:d,addResource:i,getResource:s,clearCache:h,proccesResults:p,allResources:a,listResources:o}}var t={},e=[];this.$get=n,n.$inject=[\"$log\",\"AngularJsonAPIResource\"]}angular.module(\"angular-jsonapi\").provider(\"$jsonapi\",n)}(),function(){\"use strict\";angular.module(\"angular-jsonapi\").config([\"$logProvider\",function(n){n.debugEnabled(!1)}]).run([\"validateJS\",\"$q\",function(n,t){n.Promise=t}])}();\n//# sourceMappingURL=angular-jsonapi.min.js.map","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPIModelRelationshipHasOne', AngularJsonAPIModelRelationshipHasOne);\n\n  function AngularJsonAPIModelRelationshipHasOne(\n    $jsonapi,\n    $log\n  ) {\n\n    return {\n      create: ModelRelationshipHasOneFactory\n    };\n\n    function ModelRelationshipHasOneFactory(parent, key, object) {\n      ModelRelationshipHasOne.prototype = object;\n      ModelRelationshipHasOne.prototype.constructor = ModelRelationshipHasOne;\n\n      ModelRelationshipHasOne.prototype.add = set;\n      ModelRelationshipHasOne.prototype.set = set;\n      ModelRelationshipHasOne.prototype.remove = remove;\n      ModelRelationshipHasOne.prototype.initialize = initialize;\n\n      return new ModelRelationshipHasOne(parent, key);\n\n      function ModelRelationshipHasOne(parent, key) {\n        var _this = this;\n\n        _this.parent = parent;\n        _this.key = key;\n        _this.schema = parent.schema.relationships[key];\n        _this.undefined = true;\n        _this.null = false;\n      }\n\n      /**\n       * Removes target to relationship\n       * @param {AngularJsonAPIModel} target model to be removed from relationship\n       */\n      function remove(target) {\n        var _this = this;\n        return _this.parent.unlink(_this.key, target);\n      }\n\n      /**\n       * Initialize new model linked to the object by form, you can edit and save it later\n       * @param  {String} type type neme for polymorphic associations\n       * @return {AngularJsonAPIModel}      Newly initialized object\n       */\n      function initialize(type) {\n        var _this = this;\n\n        if (_this.schema.polymorphic === true) {\n          if (type === undefined) {\n            $log.error('Run initialize with type for polymorphic asscoiation');\n\n            return;\n          }\n        } else {\n          type = _this.schema.model;\n        }\n\n        var object = $jsonapi.getResource(type).initialize();\n\n        object.form.link(_this.schema.reflection, _this);\n\n        return object;\n      }\n\n      /**\n       * Clears and sets relationship data according to the argument\n       * @param  {[AngularJsonAPIModel]} targets Array of models to replace\n       * current relationship\n       * @return {ModelRelationshipHasMany}     this\n       */\n      function set(targets) {\n        var _this = this;\n\n        _this.length = 0;\n        _this.undefined = false;\n        _this.push.apply(_this, targets);\n\n        _this.null = _this.length === 0;\n\n        return _this;\n      }\n    }\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPIModelRelationshipHasMany', AngularJsonAPIModelRelationshipHasMany);\n\n  function AngularJsonAPIModelRelationshipHasMany(\n    $jsonapi,\n    $log\n  ) {\n    ModelRelationshipHasMany.prototype = Object.create(Array.prototype);\n    ModelRelationshipHasMany.prototype.constructor = ModelRelationshipHasMany;\n\n    ModelRelationshipHasMany.prototype.add = add;\n    ModelRelationshipHasMany.prototype.remove = remove;\n    ModelRelationshipHasMany.prototype.set = set;\n    ModelRelationshipHasMany.prototype.initialize = initialize;\n\n    ModelRelationshipHasMany.prototype.push = push;\n    ModelRelationshipHasMany.prototype.splice = splice;\n\n    ModelRelationshipHasMany.prototype.__push = __push;\n    ModelRelationshipHasMany.prototype.__pop = __pop;\n\n    return {\n      create: ModelRelationshipHasManyFactory\n    };\n\n    function ModelRelationshipHasManyFactory(parent, key) {\n      return new ModelRelationshipHasMany(parent, key);\n    }\n\n    function ModelRelationshipHasMany(parent, key) {\n      var _this = this;\n\n      _this.parent = parent;\n      _this.key = key;\n      _this.schema = parent.schema.relationships[key];\n      _this.undefined = true;\n      _this.null = false;\n    }\n\n    /**\n     * Adds target to relationship\n     * @param {AngularJsonAPIModel} target model to be added to relationship\n     */\n    function add(target) {\n      var _this = this;\n      return _this.parent.link(_this.key, target);\n    }\n\n    /**\n     * Removes target to relationship\n     * @param {AngularJsonAPIModel} target model to be removed from relationship\n     */\n    function remove(target) {\n      var _this = this;\n      return _this.parent.unlink(_this.key, target);\n    }\n\n    /**\n     * Initialize new model linked to the object by form, you can edit and save it later\n     * @param  {String} type type neme for polymorphic associations\n     * @return {AngularJsonAPIModel}      Newly initialized object\n     */\n    function initialize(type) {\n      var _this = this;\n\n      if (_this.schema.polymorphic === true) {\n        if (type === undefined) {\n          $log.error('Run initialize with type for polymorphic asscoiation');\n\n          return;\n        }\n      } else {\n        type = _this.schema.model;\n      }\n\n      var object = $jsonapi.getResource(type).initialize();\n\n      object.form.link(_this.schema.reflection, _this);\n\n      return object;\n    }\n\n    /**\n     * Clears and sets relationship data according to the argument\n     * @param  {[AngularJsonAPIModel]} targets Array of models to replace\n     * current relationship\n     * @return {ModelRelationshipHasMany}     this\n     */\n    function set(targets) {\n      var _this = this;\n\n      _this.length = 0;\n      _this.undefined = false;\n      _this.push.apply(_this, targets);\n\n      _this.null = _this.length === 0;\n\n      return _this;\n    }\n\n    /**\n     * Internal method used to add object to relationship\n     * @param  {AngularJsonAPIModel} target Object to be added\n     * @return {AngularJsonAPIModel}        Added object\n     */\n    function __push(target) {\n      var _this = this;\n      _this.undefined = false;\n      _this.undefined = null;\n\n      return _this.push(target);\n    }\n\n    /**\n     * Internal method used to remove object from relationship\n     * @param  {AngularJsonAPIModel} target Object to be removed\n     * @return {AngularJsonAPIModel or null}        Removed object\n     */\n    function __pop(target) {\n      var _this = this;\n\n      var index = _this.indexOf(target);\n      if (index > -1) {\n        return null;\n      } else {\n        _this.splice(index, 1);\n        _this.null = _this.length === 0;\n        return target;\n      }\n    }\n\n    function push() {\n      $log.error('User add or __push instead');\n    }\n\n    function splice() {\n      $log.error('User remove or __pop instead');\n    }\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .service('AngularJsonAPIModelLinkerService', AngularJsonAPIModelLinkerService);\n\n  function AngularJsonAPIModelLinkerService($log) {\n    var _this = this;\n\n    _this.toLinkData = toLinkData;\n\n    _this.link = link;\n    _this.unlink = unlink;\n\n    return this;\n\n    /**\n     * Extracts data needed for relationship linking from object\n     * @param  {AngularJsonAPIModel} object Object\n     * @return {json}        Link data\n     */\n    function toLinkData(object) {\n      if (object === null) {\n        return null;\n      }\n\n      return {type: object.data.type, id: object.data.id};\n    }\n\n    /**\n     * Add target to object relationships and data.relationships\n     * @param {AngularJsonAPIModel} object     Object to be modified\n     * @param {string} key        Relationship name\n     * @param {AngularJsonAPIModel} target     Object to be linked\n     * @param {AngularJsonAPISchema} schema     Relationship schema\n     */\n    function link(object, key, target, oneWay) {\n      var schema;\n\n      if (object === undefined) {\n        $log.error('Can\\'t add link to non existing object', object, key, target);\n        $log.error('Object:', object.data.type, object);\n        $log.error('Target:', target.data.type, target);\n        $log.error('Key:', key);\n        return [];\n      }\n\n      schema = object.schema.relationships[key];\n\n      if (target === undefined) {\n        $log.error('Can\\'t link non existing object', object, key, target, schema);\n        $log.error('Object:', object.data.type, object);\n        $log.error('Target:', target.data.type, target);\n        $log.error('Key:', key);\n        $log.error('Schema:', schema);\n        return [];\n      }\n\n      if (schema === undefined) {\n        $log.error('Can\\'t add link not present in schema:', object, key, target, schema);\n        $log.error('Object:', object.data.type, object);\n        $log.error('Target:', target.data.type, target);\n        $log.error('Key:', key);\n        $log.error('Schema:', schema);\n        return [];\n      }\n\n      if (target !== null && schema.polymorphic === false && schema.model !== target.data.type) {\n        $log.error('This relation is not polymorphic, expected: ' + schema.model + ' instead of ' + target.data.type);\n        $log.error('Object:', object.data.type, object);\n        $log.error('Target:', target.data.type, target);\n        $log.error('Key:', key);\n        $log.error('Schema:', schema);\n        return [];\n      }\n\n      if (schema.type === 'hasMany') {\n        if (oneWay === true) {\n          __addHasMany(object, key, target, false);\n          return [];\n        } else {\n          return __processAddHasMany(object, key, target);\n        }\n      } else if (schema.type === 'hasOne') {\n        if (oneWay === true) {\n          __addHasOne(object, key, target, false);\n          return [];\n        } else {\n          return __processAddHasOne(object, key, target);\n        }\n      }\n    }\n\n    /**\n     * Remove target from object relationships and data.relationships\n     * @param {AngularJsonAPIModel} object     Object to be modified\n     * @param {string} key        Relationship name\n     * @param {AngularJsonAPIModel} target     Object to be unlinked\n     * @param {AngularJsonAPISchema} schema     Relationship schema\n     */\n    function unlink(object, key, target, oneWay) {\n      var schema;\n\n      if (object === undefined) {\n        $log.error('Can\\'t remove link from non existing object', object, key, target);\n        $log.error('Object:', object.data.type, object);\n        $log.error('Target:', target.data.type, target);\n        $log.error('Key:', key);\n        return [];\n      }\n\n      schema = object.schema.relationships[key];\n\n      if (schema === undefined) {\n        $log.error('Can\\'t remove link not present in schema:', object, key, target, schema);\n        $log.error('Object:', object.data.type, object);\n        $log.error('Target:', target.data.type, target);\n        $log.error('Key:', key);\n        $log.error('Schema:', schema);\n        return [];\n      }\n\n      if (oneWay === true) {\n        __removeHasMany(object, key, target, false);\n        return [];\n      } else {\n        return __processRemove(object, key, target);\n      }\n    }\n\n    /////////////\n    // Private //\n    /////////////\n\n    function __processAddHasMany(object, key, target) {\n      var reflectionKey = object.schema.relationships[key].reflection;\n      var reflectionSchema;\n\n      if (reflectionKey === false) {\n        __addHasMany(object, key, target);\n        return [];\n      }\n\n      reflectionSchema = target.schema.relationships[reflectionKey];\n\n      if (reflectionSchema.type === 'hasOne') {\n        return __swapResults(\n          __wrapResults(object, key, target),\n          __wrapResults(target, reflectionKey, object),\n          __processAddHasOne(target, reflectionKey, object)\n        );\n      } else if (reflectionSchema.type === 'hasMany') {\n        __addHasMany(object, key, target);\n        __addHasMany(target, reflectionKey, object);\n        return [__wrapResults(target, reflectionKey, object)];\n      }\n    }\n\n    function __processAddHasOne(object, key, target) {\n      var reflectionKey = object.schema.relationships[key].reflection;\n      var oldReflection = object.relationships[key];\n      var reflectionSchema;\n      var oldReflectionSchema;\n      var result = [];\n\n      __addHasOne(object, key, target);\n\n      if (oldReflection !== undefined && oldReflection !== null) {\n        oldReflectionSchema = oldReflection.schema.relationships[reflectionKey];\n\n        if (oldReflectionSchema.type === 'hasOne') {\n          __removeHasOne(oldReflection, reflectionKey, object);\n        } else if (oldReflectionSchema.type === 'hasMany') {\n          __removeHasMany(oldReflection, reflectionKey, object);\n        }\n\n        result.push(oldReflection, reflectionKey, object);\n      }\n\n      if (target !== undefined && target !== null && reflectionKey !== false) {\n        reflectionSchema = target.schema.relationships[reflectionKey];\n\n        if (reflectionSchema.type === 'hasOne') {\n          __addHasOne(target, reflectionKey, object);\n        } else if (reflectionSchema.type === 'hasMany') {\n          __addHasMany(target, reflectionKey, object);\n        }\n\n        result.push(target, reflectionKey, object);\n      }\n\n      return result;\n    }\n\n    function __processRemove(object, key, target) {\n      var schema = object.schema.relationships[key];\n      var reflectionKey = schema.reflection;\n      var reflectionSchema;\n\n      if (schema.type === 'hasMany') {\n        __removeHasMany(object, key, target);\n      } else if (schema.type === 'hasOne') {\n        __removeHasOne(object, key, target);\n      }\n\n      if (reflectionKey === false) {\n        return [];\n      }\n\n      reflectionSchema = target.schema.relationships[reflectionKey];\n\n      if (reflectionSchema.type === 'hasOne') {\n        __removeHasOne(target, reflectionKey, object);\n      } else if (reflectionSchema.type === 'hasMany') {\n        __removeHasMany(target, reflectionKey, object);\n      }\n\n      return [__wrapResults(target, reflectionKey, object)];\n    }\n\n    function __addHasOne(object, key, target, reset) {\n      $log.debug('addHasOne', object, key, target);\n\n      object.relationships[key] = target;\n      object.data.relationships[key].data = toLinkData(target);\n      if (reset !== false) {\n        object.reset(true);\n      }\n\n      return true;\n    }\n\n    function __addHasMany(object, key, target, reset) {\n      var linkData = toLinkData(target);\n      $log.debug('addHasMany', object, key, target);\n\n      if (angular.isArray(object.relationships[key]) && object.relationships[key].indexOf(target) > -1) {\n        return false;\n      }\n\n      object.relationships[key] = object.relationships[key] || [];\n      object.data.relationships[key].data = object.data.relationships[key].data || [];\n\n      object.relationships[key].push(target);\n      object.data.relationships[key].data.push(linkData);\n      if (reset !== false) {\n        object.reset(true);\n      }\n\n      return true;\n    }\n\n    function __removeHasOne(object, key, target, reset) {\n      $log.debug('removeHasOne', object, key, target);\n\n      if (target !== undefined && object.relationships[key] !== target) {\n        return false;\n      }\n\n      object.relationships[key] = null;\n      object.data.relationships[key].data = undefined;\n      if (reset !== false) {\n        object.reset(true);\n      }\n\n      return true;\n    }\n\n    function __removeHasMany(object, key, target, reset) {\n      $log.debug('removeHasMany', object, key, target);\n\n      if (object.relationships[key] === undefined) {\n        return;\n      }\n\n      if (target === undefined) {\n        object.relationships[key] = [];\n        object.data.relationships[key].data = [];\n        if (reset !== false) {\n          object.reset(true);\n        }\n\n        return true;\n      }\n\n      var index = object.relationships[key].indexOf(target);\n\n      if (index === -1) {\n        return false;\n      }\n\n      object.relationships[key].splice(index, 1);\n      object.data.relationships[key].data.splice(index, 1);\n      if (reset !== false) {\n        object.reset(true);\n      }\n\n      return true;\n    }\n\n    function __wrapResults(object, key, target) {\n      return {\n        object: object,\n        key: key,\n        target: target\n      };\n    }\n\n    function __swapResults(value, newValue, array) {\n      var index = -1;\n      angular.forEach(array, function(item, i) {\n        if (item.object === value.object && item.key === value.key && item.target === value.target) {\n          index = i;\n        }\n      });\n\n      if (index > -1) {\n        array[index] = newValue;\n      } else {\n        array.push(newValue);\n      }\n\n      return array;\n    }\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPIModelForm', AngularJsonAPIModelFormWrapper);\n\n  function AngularJsonAPIModelFormWrapper(\n    AngularJsonAPIModelValidationError,\n    AngularJsonAPIModelLinkerService,\n    validateJS,\n    $q\n  ) {\n\n    AngularJsonAPIModelForm.prototype.save = save;\n    AngularJsonAPIModelForm.prototype.reset = reset;\n    AngularJsonAPIModelForm.prototype.validate = validate;\n\n    AngularJsonAPIModelForm.prototype.link = link;\n    AngularJsonAPIModelForm.prototype.unlink = unlink;\n\n    AngularJsonAPIModelForm.prototype.toJson = toJson;\n\n    return {\n      create: AngularJsonAPIModelFormFactory\n    };\n\n    function AngularJsonAPIModelFormFactory(parent) {\n      return new AngularJsonAPIModelForm(parent);\n    }\n\n    function AngularJsonAPIModelForm(parent) {\n      var _this = this;\n\n      _this.data = {\n        id: parent.data.id,\n        type: parent.data.type,\n        attributes: {},\n        relationships: {}\n      };\n\n      _this.relationships = {};\n      _this.parent = parent;\n      _this.schema = parent.schema;\n      _this.reset();\n    }\n\n    /**\n     * Encodes object into json\n     * @return {json} Json object\n     */\n    function toJson() {\n      var _this = this;\n      var data = angular.copy(_this.data);\n      var relationships = {};\n\n      angular.forEach(data.relationships, function(value, key) {\n        if (value.data !== undefined) {\n          relationships[key] = value;\n        }\n      });\n\n      data.relationships = relationships;\n\n      return {\n        data: data\n      };\n    }\n\n    /**\n     * Saves form, shortcut to parent.save()\n     * @return {promise} Promise associated with synchronization\n     */\n    function save() {\n      var _this = this;\n\n      return _this.parent.save();\n    }\n\n    /**\n     * Resets form to state of a parent\n     * @return {undefined}\n     */\n    function reset(auto) {\n      var _this = this;\n\n      angular.forEach(_this.schema.relationships, function(data, key) {\n        _this.data.relationships[key] = angular.copy(_this.parent.data.relationships[key]) || {};\n        if (angular.isArray(_this.relationships[key])) {\n          _this.relationships[key] = _this.parent.relationships[key].slice();\n        } else {\n          _this.relationships[key] = _this.parent.relationships[key];\n        }\n      });\n\n      if (auto === true && _this.parent.synchronized === true) {\n        return;\n      }\n\n      angular.forEach(_this.schema.attributes, function(validator, key) {\n        _this.data.attributes[key] = angular.copy(_this.parent.data.attributes[key]);\n      });\n\n      _this.parent.errors.validation.clear();\n    }\n\n    /**\n     * Validates form\n     * @return {promise} Promise rejected to errors object indexed by keys. If the\n     * key param i stated it only validates an attribute, else all attributes.\n     */\n    function validate(key) {\n      var _this = this;\n      var attributesWrapper;\n      var constraintsWrapper;\n      var deferred = $q.defer();\n\n      if (key === undefined) {\n        attributesWrapper = _this.data.attributes;\n        constraintsWrapper = _this.schema.attributes;\n      } else {\n        attributesWrapper = {};\n        constraintsWrapper = {};\n\n        attributesWrapper[key] = _this.data.attributes[key];\n        constraintsWrapper[key] = _this.schema.attributes[key];\n      }\n\n      validateJS.async(\n        attributesWrapper,\n        constraintsWrapper\n      ).then(resolve, reject);\n\n      function resolve() {\n        if (key === undefined) {\n          _this.parent.errors.validation.clear();\n        } else {\n          _this.parent.errors.validation.clear(key);\n        }\n\n        deferred.resolve();\n      }\n\n      function reject(errorsMap) {\n        _this.parent.error = true;\n        if (key === undefined) {\n          _this.parent.errors.validation.clear();\n        } else {\n          _this.parent.errors.validation.clear(key);\n        }\n\n        angular.forEach(errorsMap, function(errors, attribute) {\n          angular.forEach(errors, function(error) {\n            _this.parent.errors.validation.add(attribute, AngularJsonAPIModelValidationError.create(error, attribute));\n          });\n        });\n\n        deferred.reject(_this.parent.errors.validation);\n      }\n\n      return deferred.promise;\n    }\n\n    /**\n     * Adds link to a form without synchronization\n     * @param {string} key    Relationship name\n     * @param {AngularJsonAPIModel} target Object to be linked\n     * @return {Boolean}        Status\n     */\n    function link(key, target) {\n      var _this = this;\n\n      return $q.resolve(AngularJsonAPIModelLinkerService.link(_this, key, target, true));\n    }\n\n    /**\n     * Removes link from form without synchronization\n     * @param  {[type]} key    Relationship name\n     * @param {AngularJsonAPIModel} target Object to be linked\n     * @return {Boolean}        Status\n     */\n    function unlink(key, target) {\n      var _this = this;\n\n      return $q.resolve(AngularJsonAPIModelLinkerService.unlink(_this, key, target, true));\n    }\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPIAbstractModel', AngularJsonAPIAbstractModelWrapper);\n\n  function AngularJsonAPIAbstractModelWrapper(\n    AngularJsonAPIModelSynchronizationError,\n    AngularJsonAPIModelValidationError,\n    AngularJsonAPIModelErrorsManager,\n    AngularJsonAPIModelLinkerService,\n    AngularJsonAPIModelForm,\n    uuid4,\n    $rootScope,\n    $injector,\n    $log,\n    $q\n  ) {\n    AngularJsonAPIAbstractModel.prototype.refresh = refresh;\n    AngularJsonAPIAbstractModel.prototype.remove = remove;\n    AngularJsonAPIAbstractModel.prototype.reset = reset;\n    AngularJsonAPIAbstractModel.prototype.save = save;\n\n    AngularJsonAPIAbstractModel.prototype.update = update;\n\n    AngularJsonAPIAbstractModel.prototype.link = link;\n    AngularJsonAPIAbstractModel.prototype.unlink = unlink;\n    AngularJsonAPIAbstractModel.prototype.unlinkAll = unlinkAll;\n\n    AngularJsonAPIAbstractModel.prototype.toJson = toJson;\n\n    AngularJsonAPIAbstractModel.prototype.hasErrors = hasErrors;\n\n    return AngularJsonAPIAbstractModel;\n\n    /**\n     * Constructor\n     * @param {json}  data      Validated data used to create an object\n     * @param {object} config   Is object new (for form)\n     */\n    function AngularJsonAPIAbstractModel(data, config, updatedAt) {\n      var _this = this;\n\n      data.relationships = data.relationships || {};\n\n      /**\n       * Is not a new record\n       * @type {Boolean}\n       */\n      _this.saved = config.saved === undefined ? true : config.saved;\n\n      /**\n       * Is present on the server\n       * @type {Boolean}\n       */\n      _this.stable = config.stable === undefined ? true : config.stable;\n\n      /**\n       * Has been synchronized with the server\n       * @type {Boolean}\n       */\n      _this.synchronized = config.synchronized === undefined ? true : config.synchronized;\n\n      /**\n       * Has just been created by request and may not exist on the server\n       * @type {Boolean}\n       */\n      _this.pristine = config.pristine === undefined ? true : config.pristine;\n\n      _this.removed = false;\n      _this.loading = false;\n      _this.saving = false;\n      _this.updatedAt = _this.synchronized === true ? Date.now() : updatedAt;\n\n      _this.loadingCount = 0;\n      _this.savingCount = 0;\n\n      _this.data = {\n        relationships: {},\n        attributes: {}\n      };\n      _this.relationships = {};\n\n      angular.forEach(_this.schema.relationships, function(schema, key) {\n        _this.relationships[key] = undefined;\n      });\n\n      _this.errors = {\n        validation: AngularJsonAPIModelErrorsManager.create(\n          'Validation',\n          'Errors of attributes validation',\n          AngularJsonAPIModelValidationError\n        ),\n        synchronization: AngularJsonAPIModelErrorsManager.create(\n          'Synchronization',\n          'Errors of synchronizations',\n          AngularJsonAPIModelSynchronizationError\n        )\n      };\n\n      _this.promises = {};\n\n      __setData(_this, data);\n\n      _this.form = AngularJsonAPIModelForm.create(_this);\n    }\n\n    /**\n     * Saves model's form\n     * @return {promise} Promise associated with synchronization that resolves to this\n     */\n    function save() {\n      var _this = this;\n      var deferred = $q.defer();\n      var config = {\n        action: _this.saved === false ? 'add' : 'update',\n        object: _this\n      };\n\n      _this.form.validate().then(\n        synchronize,\n        deferred.reject\n      ).finally(__decrementSavingCounter.bind(_this, undefined));\n\n      __incrementSavingCounter(_this);\n\n      return deferred.promise;\n\n      function synchronize() {\n        _this.synchronize(config).then(resolve, reject, notify);\n      }\n\n      function resolve(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:' + config.action, 'resolved', _this, response);\n        _this.update(_this.form.data);\n\n        if (_this.saved === false) {\n          _this.factory.cache.indexIds = _this.factory.cache.indexIds || [];\n          _this.factory.cache.indexIds.push(_this.data.id);\n        }\n\n        _this.synchronized = true;\n        _this.saved = true;\n        _this.stable = true;\n\n        response.finish();\n        _this.errors.synchronization.concat(response.errors);\n        deferred.resolve(_this);\n      }\n\n      function reject(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:save', 'rejected', _this, response);\n\n        response.finish();\n        _this.errors.synchronization.concat(response.errors);\n        deferred.reject(response);\n      }\n\n      function notify(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:save', 'notify', _this, response);\n\n        deferred.notify(response);\n      }\n    }\n\n    /**\n     * Reset object form\n     * @return {undefined}\n     */\n    function reset() {\n      var _this = this;\n\n      if (_this.form !== undefined) {\n        _this.form.reset();\n      }\n    }\n\n    /**\n     * Synchronize object with remote\n     * @return {promise} Promise associated with synchronization that resolves to this\n     */\n    function refresh() {\n      var $jsonapi = $injector.get('$jsonapi');\n      var deferred = $q.defer();\n      var _this = this;\n      var config = {\n        action: 'refresh',\n        object: _this,\n        params: _this.schema.params.get\n      };\n\n      if (_this.saved === false) {\n        var error = AngularJsonAPIModelSynchronizationError.create('Can\\'t refresh new object', null, 0, 'refresh');\n        _this.errors.synchronization.add('refresh', error);\n        deferred.reject(error);\n      } else {\n        __incrementLoadingCounter(_this);\n\n        _this.synchronize(config)\n          .then(resolve, reject, notify)\n          .finally(__decrementLoadingCounter.bind(_this, undefined));\n      }\n\n      return deferred.promise;\n\n      function resolve(response) {\n        var results = $jsonapi.proccesResults(response.data);\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:refresh', 'resolved', _this, response);\n        $q.allSettled(results.included.map(synchronizeIncluded)).then(resolveIncluded, deferred.reject);\n\n        _this.synchronized = true;\n        _this.stable = true;\n\n        response.finish();\n        _this.errors.synchronization.concat(response.errors);\n\n        function synchronizeIncluded(object) {\n          __incrementLoadingCounter(object);\n\n          return object.synchronize({\n            action: 'include',\n            object: object\n          }).finally(__decrementLoadingCounter.bind(object, undefined));\n        }\n\n        function resolveIncluded(includedResponse) {\n          angular.forEach(includedResponse, function(operation, key) {\n            if (operation.success === true) {\n              $rootScope.$emit('angularJsonAPI:' + results.included[key].data.type + ':object:include', 'resolved', results.included[key], operation);\n              operation.value.finish();\n            }\n          });\n\n          deferred.resolve(response);\n        }\n      }\n\n      function reject(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:refresh', 'rejected', _this, response);\n\n        response.finish();\n        _this.errors.synchronization.concat(response.errors);\n        deferred.reject(response);\n      }\n\n      function notify(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:refresh', 'notify', _this, response);\n\n        deferred.notify(response);\n      }\n    }\n\n    /**\n     * Encodes object into json\n     * @return {json} Json object\n     */\n    function toJson() {\n      var _this = this;\n      var data = angular.copy(_this.data);\n      var relationships = {};\n\n      angular.forEach(data.relationships, function(value, key) {\n        if (value.data !== undefined) {\n          relationships[key] = value;\n        }\n      });\n\n      data.relationships = relationships;\n\n      return {\n        data: data,\n        updatedAt: _this.updatedAt\n      };\n    }\n\n    /**\n     * Remove object\n     * @return {promise} Promise associated with synchronization that resolves to nothing\n     */\n    function remove() {\n      var _this = this;\n      var deferred = $q.defer();\n\n      var config = {\n        action: 'remove',\n        object: _this\n      };\n\n      _this.factory.cache.remove(_this.data.id);\n\n      if (_this.saved === false) {\n        deferred.resolve();\n      } else {\n        __incrementSavingCounter(_this);\n\n        _this.synchronize(config)\n          .then(resolve, reject, notify)\n          .finally(__decrementSavingCounter.bind(_this, undefined));\n      }\n\n      return deferred.promise;\n\n      function resolve(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:remove', 'resolved', _this, response);\n        _this.removed = true;\n        _this.unlinkAll();\n        _this.factory.cache.clearRemoved(_this.data.id);\n\n        response.finish();\n        _this.errors.synchronization.concat(response.errors);\n        deferred.resolve(response);\n      }\n\n      function reject(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:remove', 'rejected', _this, response);\n        _this.factory.cache.revertRemove(_this.data.id);\n\n        response.finish();\n        _this.errors.synchronization.concat(response.errors);\n        deferred.reject(response);\n      }\n\n      function notify(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:remove', 'notify', _this, response);\n\n        deferred.notify(response);\n      }\n    }\n\n    /**\n     * Unlink all reflection relationships of the object **without synchronization**\n     * @return {boolean} Result\n     */\n    function unlinkAll(key) {\n      var _this = this;\n      var deferred = $q.defer();\n\n      __incrementLoadingCounter(_this);\n\n      if (key === undefined) {\n        angular.forEach(_this.relationships, removeLink);\n      } else {\n        removeLink(_this.relationships[key], key);\n      }\n\n      __decrementLoadingCounter(_this);\n\n      return deferred.promise;\n\n      function removeLink(linksObj, key) {\n        var schema = _this.schema.relationships[key];\n        var reflectionKey = schema.reflection;\n\n        if (angular.isArray(linksObj)) {\n          angular.forEach(linksObj, removeReflectionLink.bind(undefined, reflectionKey));\n        } else if (angular.isObject(linksObj)) {\n          removeReflectionLink(reflectionKey, linksObj);\n        }\n\n        if (schema.type === 'hasOne') {\n          _this.relationships[key] = null;\n        } else if (schema.type === 'hasMany') {\n          _this.relationships[key] = [];\n        }\n      }\n\n      function removeReflectionLink(reflectionKey, target) {\n        var reflectionSchema = target.schema.relationships[reflectionKey];\n        var config = {\n          action: 'unlinkReflection',\n          object: target,\n          target: _this,\n          key: reflectionKey\n        };\n\n        __incrementLoadingCounter(target);\n        AngularJsonAPIModelLinkerService.unlink(target, reflectionKey, _this, reflectionSchema);\n\n        target.synchronize(config)\n          .then(resolve, reject, notify)\n          .finally(__decrementLoadingCounter.bind(target, undefined));\n\n        function resolve(response) {\n          $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:unlinkReflection', 'resolve', _this, response);\n\n          response.finish();\n          _this.errors.synchronization.concat(response.errors);\n          deferred.resolve(_this);\n        }\n\n        function reject(response) {\n          $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:unlinkReflection', 'rejected', _this, response);\n\n          response.finish();\n          _this.errors.synchronization.concat(response.errors);\n          deferred.reject(response);\n        }\n\n        function notify(response) {\n          $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:unlinkReflection', 'notify', _this, response);\n\n          response.finish();\n          deferred.notify(response);\n        }\n      }\n    }\n\n    /**\n     * Links object to relationship with the key\n     * @param  {string} key    Relationship name\n     * @param  {AngularJsonAPIModel} target Object to be linked\n     * @return {promise}        Promise associated with synchronizations\n     */\n    function link(key, target) {\n      var deferred = $q.defer();\n      var _this = this;\n      var error;\n      var config = {\n        action: 'link',\n        object: _this,\n        target: target,\n        key: key\n      };\n\n      if (target === undefined) {\n        error = AngularJsonAPIModelSynchronizationError.create('Can\\'t link undefined', null, 0, 'link');\n        _this.errors.synchronization.add('link', error);\n        deferred.reject(error);\n      } else if (_this.saved === false) {\n        error = AngularJsonAPIModelSynchronizationError.create('Can\\'t link new object', null, 0, 'link');\n        _this.errors.synchronization.add('link', error);\n        deferred.reject(error);\n      } else {\n        __incrementSavingCounter(_this);\n\n        _this.synchronize(config)\n          .then(resolve, reject, notify)\n          .finally(__decrementSavingCounter.bind(_this, undefined));\n      }\n\n      return deferred.promise;\n\n      function resolve(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:link', 'resolved', _this, response);\n\n        var targets = AngularJsonAPIModelLinkerService.link(_this, key, target);\n\n        _this.stable = true;\n        response.finish();\n        _this.errors.synchronization.concat(response.errors);\n\n        $q.allSettled(targets.map(synchronize))\n          .then(resolveReflection, deferred.reject);\n\n        function synchronize(result) {\n          __incrementLoadingCounter(target);\n\n          return target.synchronize({\n            action: 'linkReflection',\n            object: result.object,\n            target: result.target,\n            key: result.key\n          }).finally(__decrementLoadingCounter.bind(target, undefined));\n        }\n\n        function resolveReflection(response) {\n          angular.forEach(response, function(operation) {\n            if (operation.success === true) {\n              $rootScope.$emit('angularJsonAPI:' + targets[key].data.type + ':object:linkReflection', 'resolved', targets[key], operation);\n              response.value.finish();\n            }\n          });\n\n          deferred.resolve(_this);\n        }\n      }\n\n      function reject(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:link', 'rejected', _this, response);\n\n        deferred.reject(response.errors);\n        response.finish();\n        _this.errors.synchronization.concat(response.errors);\n        deferred.reject(response);\n      }\n\n      function notify(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:link', 'notify', _this, response);\n\n        deferred.notify(response);\n      }\n    }\n\n    /**\n     * Unlinks object from relationship with the key\n     * @param  {string} key    Relationship name\n     * @param  {AngularJsonAPIModel} target Object to be unlinked if undefined unlinks all\n     * @return {promise}        Promise associated with synchronizations\n     */\n    function unlink(key, target) {\n      var deferred = $q.defer();\n      var _this = this;\n      var error;\n      var config = {\n        action: 'unlink',\n        object: _this,\n        target: target,\n        key: key\n      };\n\n      if (target === undefined) {\n        error = AngularJsonAPIModelSynchronizationError.create('Can\\'t unlink undefined', null, 0, 'link');\n        _this.errors.synchronization.add('link', error);\n        deferred.reject(error);\n      } else if (_this.saved === false) {\n        error = AngularJsonAPIModelSynchronizationError.create('Can\\'t unlink new object', null, 0, 'link');\n        _this.errors.synchronization.add('link', error);\n        deferred.reject(error);\n      } else {\n        __incrementSavingCounter(_this);\n\n        _this.synchronize(config)\n          .then(resolve, reject, notify)\n          .finally(__decrementSavingCounter.bind(_this, undefined));\n      }\n\n      return deferred.promise;\n\n      function resolve(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:unlink', 'resolved', _this, response);\n\n        var targets = AngularJsonAPIModelLinkerService.link(_this, key, target);\n\n        _this.stable = true;\n        response.finish();\n        _this.errors.synchronization.concat(response.errors);\n\n        $q.allSettled(targets.map(synchronize))\n          .then(resolveReflection, deferred.reject);\n\n        function synchronize(result) {\n          __incrementLoadingCounter(target);\n\n          return target.synchronize({\n            action: 'unlinkReflection',\n            object: result.object,\n            target: result.target,\n            key: result.key\n          }).finally(__decrementLoadingCounter.bind(target, undefined));\n        }\n\n        function resolveReflection(response) {\n          angular.forEach(response, function(operation) {\n            if (operation.success === true) {\n              $rootScope.$emit('angularJsonAPI:' + targets[key].data.type + ':object:unlinkReflection', 'resolved', targets[key], operation);\n              response.value.finish();\n            }\n          });\n\n          deferred.resolve(_this);\n        }\n      }\n\n      function reject(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:unlink', 'rejected', _this, response);\n\n        deferred.reject(response.errors);\n        response.finish();\n        _this.errors.synchronization.concat(response.errors);\n        deferred.reject(response);\n      }\n\n      function notify(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.data.type + ':object:unlink', 'notify', _this, response);\n\n        deferred.notify(response);\n      }\n    }\n\n    /**\n     * Sets object state to data\n     * @param  {object} validatedData JsonAPI object with data\n     * @return {bool}               Result\n     */\n    function update(validatedData, auto, initialization) {\n      var _this = this;\n\n      __incrementLoadingCounter(_this);\n\n      __setData(_this, validatedData);\n      _this.reset(auto);\n      _this.synchronized = initialization === true ? false : true;\n      _this.stable = initialization === true ? false : true;\n      _this.updatedAt = Date.now();\n\n      __decrementLoadingCounter(_this);\n    }\n\n    /**\n     * Check if the object has errors\n     * @return {Boolean}\n     */\n    function hasErrors() {\n      var _this = this;\n      var answer = false;\n\n      angular.forEach(_this.errors, function(error) {\n        answer = error.hasErrors() || answer;\n      });\n\n      return answer;\n    }\n\n    /////////////\n    // PRIVATE //\n    /////////////\n\n    /**\n     * Low level set data function, use only with validated data\n     * @param  {AngularJsonAPIModel} object        object to be modified\n     * @param  {object} validatedData Validated data\n     * @return {boolean}               Status\n     */\n    function __setData(object, validatedData) {\n\n      var $jsonapi = $injector.get('$jsonapi');\n      var schema = object.schema;\n\n      object.data.id = validatedData.id;\n      object.data.type = validatedData.type;\n\n      if (object.factory.schema.type !== validatedData.type) {\n        $log.error('Different type then factory', object.factory.schema.type, validatedData);\n        return false;\n      }\n\n      if (!uuid4.validate(object.data.id)) {\n        $log.error('Invalid id');\n        return false;\n      }\n\n      validatedData.attributes = validatedData.attributes || {};\n      validatedData.relationships = validatedData.relationships || {};\n\n      angular.forEach(schema.attributes, setAttributes);\n      angular.forEach(schema.relationships, setRelationships);\n\n      return true;\n\n      function setAttributes(validators, key) {\n        object.data.attributes[key] = validatedData.attributes[key];\n      }\n\n      function setRelationships(schema, key) {\n        var relationshipData = validatedData.relationships[key];\n\n        if (relationshipData === undefined) {\n          object.data.relationships[key] = {data: undefined};\n          return;\n        }\n\n        object.data.relationships[key] = object.data.relationships[key] || {};\n        object.data.relationships[key].links = relationshipData.links;\n\n        if (schema.type === 'hasOne') {\n          linkOne(object, key, relationshipData.data);\n        } else if (schema.type === 'hasMany') {\n          if (angular.isArray(relationshipData.data)) {\n            if (relationshipData.data.length === 0) {\n              object.data.relationships[key].data = [];\n              object.unlinkAll(key);\n            } else {\n              angular.forEach(\n                object.relationships[key],\n                unlinkOne.bind(undefined, object, key, relationshipData.data)\n              );\n              angular.forEach(\n                relationshipData.data,\n                linkOne.bind(undefined, object, key)\n              );\n            }\n          }\n        }\n      }\n\n      function linkOne(object, key, data) {\n        var factory;\n\n        if (data === null) {\n          AngularJsonAPIModelLinkerService.link(object, key, null);\n          return;\n        }\n\n        if (data === undefined) {\n          return;\n        }\n\n        factory = $jsonapi.getResource(data.type);\n\n        if (factory === undefined) {\n          $log.error('Factory not found', data.type, data);\n          return;\n        }\n\n        var target = factory.cache.get(data.id);\n\n        AngularJsonAPIModelLinkerService.link(object, key, target);\n      }\n\n      function unlinkOne(object, key, relationshipData, target) {\n        if (relationshipData.indexOf(target.data.id) > -1) {\n          return;\n        }\n\n        AngularJsonAPIModelLinkerService.unlink(object, key, target);\n      }\n    }\n  }\n\n  /////////////\n  // Private //\n  /////////////\n\n  function __incrementLoadingCounter(object) {\n    object = object === undefined ? this : object;\n    object.loadingCount += 1;\n    object.loading = true;\n  }\n\n  function __decrementLoadingCounter(object) {\n    object = object === undefined ? this : object;\n    object.loadingCount -= 1;\n    object.loading = object.loadingCount > 0;\n  }\n\n  function __incrementSavingCounter(object) {\n    object = object === undefined ? this : object;\n    object.savingCount += 1;\n    object.saving = true;\n  }\n\n  function __decrementSavingCounter(object) {\n    object = object === undefined ? this : object;\n    object.savingCount -= 1;\n    object.saving = object.savingCount > 0;\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPIModelValidationError', AngularJsonAPIModelValidationErrorWrapper);\n\n  function AngularJsonAPIModelValidationErrorWrapper() {\n    ValidationError.prototype = Object.create(Error.prototype);\n    ValidationError.prototype.constructor = ValidationError;\n    ValidationError.prototype.name = 'ValidationError';\n\n    return {\n      create: ValidationErrorFactory\n    };\n\n    function ValidationErrorFactory(message, attribute) {\n      return new ValidationError(message, attribute);\n    }\n\n    function ValidationError(message, attribute) {\n      var _this = this;\n      Error.captureStackTrace(_this, _this.constructor);\n\n      _this.message = message;\n      _this.context = {\n        attribute: attribute\n      };\n    }\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPIModelSynchronizationError', AngularJsonAPIModelSynchronizationErrorWrapper);\n\n  function AngularJsonAPIModelSynchronizationErrorWrapper() {\n    SynchronizationError.prototype = Object.create(Error.prototype);\n    SynchronizationError.prototype.constructor = SynchronizationError;\n    SynchronizationError.prototype.name = 'SynchronizationError';\n\n    return {\n      create: SynchronizationErrorFactory\n    };\n\n    function SynchronizationErrorFactory(message, synchronization, code, action) {\n      return new SynchronizationError(message, synchronization, code, action);\n    }\n\n    function SynchronizationError(message, synchronization, code, action) {\n      var _this = this;\n      Error.captureStackTrace(_this, _this.constructor);\n\n      _this.message = message;\n      _this.context = {\n        synchronization: synchronization,\n        code: code,\n        action: action\n      };\n    }\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPIModelErrorsManager', AngularJsonAPIModelErrorsManagerWrapper);\n\n  function AngularJsonAPIModelErrorsManagerWrapper() {\n    ErrorsManager.prototype.constructor = ErrorsManager;\n    ErrorsManager.prototype.concat = concat;\n    ErrorsManager.prototype.clear = clear;\n    ErrorsManager.prototype.add = add;\n    ErrorsManager.prototype.hasErrors = hasErrors;\n\n    return {\n      create: ErrorsManagerFactory\n    };\n\n    function ErrorsManagerFactory(name, description, ErrorConstructor, defaultFilter) {\n      return new ErrorsManager(name, description, ErrorConstructor, defaultFilter);\n    }\n\n    function ErrorsManager(name, description, ErrorConstructor, defaultFilter) {\n      var _this = this;\n      _this.name = name;\n      _this.description = description;\n\n      _this.ErrorConstructor = ErrorConstructor;\n      _this.errors = {};\n      _this.defaultFilter = defaultFilter || function() { return true; };\n    }\n\n    function clear(key) {\n      var _this = this;\n\n      if (key === undefined) {\n        angular.forEach(_this.errors, function(obj, key) {\n          _this.errors[key] = [];\n        });\n      } else {\n        _this.errors[key] = [];\n      }\n    }\n\n    function add(key, error) {\n      var _this = this;\n\n      _this.errors[key] = _this.errors[key] || [];\n      _this.errors[key].push(error);\n    }\n\n    function concat(errors) {\n      var _this = this;\n\n      angular.forEach(errors, function(error) {\n        _this.errors[error.key] = [];\n      });\n\n      angular.forEach(errors, function(error) {\n        _this.errors[error.key].push(error.object);\n      });\n\n    }\n\n    function hasErrors(key) {\n      var _this = this;\n\n      if (key === undefined) {\n        var answer = false;\n\n        angular.forEach(_this.errors, function(error) {\n          answer = answer || error.length > 0;\n        });\n\n        return answer;\n      } else {\n        return _this.errors[key] !== undefined && _this.errors[key].length > 0;\n      }\n    }\n  }\n})();\n","// from https://www.sitepen.com/blog/2012/10/19/lazy-property-access/\n(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n    .constant('lazyProperty', function(target, propertyName, callback) {\n      var result;\n      var done;\n      Object.defineProperty(target, propertyName, {\n        get: function() { // Define the getter\n          if (!done) {\n            // We cache the result and only compute once.\n            done = true;\n            result = callback.call(target);\n          }\n\n          return result;\n        },\n\n        // Keep it enumerable and configurable, certainly not necessary.\n        enumerable: true,\n        configurable: true\n      });\n    });\n\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n    .constant('toKebabCase', function(str) {\n      return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();\n    });\n\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi').config(['$provide', function($provide) {\n    $provide.decorator('$q', ['$delegate', function($delegate) {\n      var $q = $delegate;\n\n      $q.allSettled = $q.allSettled || function allSettled(promises, resolvedCallback, rejectedCallback) {\n        // Implementation of allSettled function from Kris Kowal's Q:\n        // https://github.com/kriskowal/q/wiki/API-Reference#promiseallsettled\n        // by Michael Kropat from http://stackoverflow.com/a/27114615/1400432 slightly modified\n\n        var wrapped = angular.isArray(promises) ? [] : {};\n\n        angular.forEach(promises, function(promise, key) {\n          if (!wrapped.hasOwnProperty(key)) {\n            wrapped[key] = wrap(promise);\n          }\n        });\n\n        return $q.all(wrapped);\n\n        function wrap(promise) {\n          return $q.resolve(promise)\n            .then(function(value) {\n              if (angular.isFunction(resolvedCallback)) {\n                resolvedCallback(value);\n              }\n\n              return { success: true, value: value };\n            },\n\n            function(reason) {\n              if (angular.isFunction(rejectedCallback)) {\n                rejectedCallback(reason);\n              }\n\n              return { success: false, reason: reason };\n            });\n        }\n      };\n\n      return $q;\n    }]);\n  }]);\n\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPISynchronizerSimple', AngularJsonAPISynchronizerSimpleWrapper);\n\n  function AngularJsonAPISynchronizerSimpleWrapper(AngularJsonAPISynchronizerPrototype, $q, $log) {\n\n    AngularJsonAPISynchronizerSimple.prototype = Object.create(AngularJsonAPISynchronizerPrototype.prototype);\n    AngularJsonAPISynchronizerSimple.prototype.constructor = AngularJsonAPISynchronizerSimple;\n\n    AngularJsonAPISynchronizerSimple.prototype.synchronize = synchronize;\n\n    return {\n      create: AngularJsonAPISynchronizerSimpleFactory\n    };\n\n    function AngularJsonAPISynchronizerSimpleFactory(synchronizations) {\n      return new AngularJsonAPISynchronizerSimple(synchronizations);\n    }\n\n    function AngularJsonAPISynchronizerSimple(synchronizations) {\n      var _this = this;\n\n      _this.state = {};\n\n      AngularJsonAPISynchronizerPrototype.call(_this, synchronizations);\n\n      angular.forEach(synchronizations, function(synchronization) {\n        synchronization.synchronizer = _this;\n      });\n    }\n\n    function synchronize(config) {\n      var _this = this;\n      var promises = [];\n      var deferred = $q.defer();\n      var action = config.action;\n\n      AngularJsonAPISynchronizerPrototype.prototype.synchronize.call(_this, config);\n\n      angular.forEach(_this.synchronizations, function(synchronization) {\n        angular.forEach(synchronization.beginHooks[action], function(hook) {\n          deferred.notify({step: 'begin', data: hook.call(_this, config)});\n        });\n      });\n\n      angular.forEach(_this.synchronizations, function(synchronization) {\n        angular.forEach(synchronization.beforeHooks[action], function(hook) {\n          deferred.notify({step: 'before', data: hook.call(_this, config)});\n        });\n      });\n\n      angular.forEach(_this.synchronizations, function(synchronization) {\n        angular.forEach(synchronization.synchronizationHooks[action], function(hook) {\n          promises.push(hook.call(_this, config));\n        });\n      });\n\n      $q.allSettled(promises, resolvedCallback, rejectedCallback).then(resolved, rejected);\n\n      function resolvedCallback(value) {\n        deferred.notify({step: 'synchronization', data: value});\n      }\n\n      function rejectedCallback(reason) {\n        deferred.notify({step: 'synchronization', errors: reason});\n      }\n\n      function resolved(results) {\n        _this.state[action] = _this.state[action] || {};\n        _this.state[action].success = true;\n\n        angular.forEach(results, function(result) {\n          if (result.success === false) {\n            _this.state[action].success = false;\n          }\n        });\n\n        angular.forEach(_this.synchronizations, function(synchronization) {\n          angular.forEach(synchronization.afterHooks[action], function(hook) {\n            deferred.notify({step: 'after', errors: hook.call(_this, config, results)});\n          });\n        });\n\n        var data;\n        var errors = [];\n\n        angular.forEach(results, function(result) {\n          if (result.success === true) {\n            data = result.value;\n          } else {\n            errors.push({\n              key: action,\n              object: result.reason\n            });\n          }\n        });\n\n        if (errors.length > 0) {\n          deferred.reject({data: data, finish: finish, errors: errors});\n        } else {\n          deferred.resolve({data: data, finish: finish, errors: errors});\n        }\n      }\n\n      function finish() {\n        angular.forEach(_this.synchronizations, function(synchronization) {\n          angular.forEach(synchronization.finishHooks[action], function(hook) {\n            deferred.notify({step: 'finish', errors: hook.call(_this, config)});\n          });\n        });\n      }\n\n      function rejected(errors) {\n        $log.error('All settled rejected! Something went wrong');\n\n        deferred.reject({finish: angular.noop, errors: errors});\n      }\n\n      return deferred.promise;\n    }\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPISynchronizerPrototype', AngularJsonAPISynchronizerPrototypeWrapper);\n\n  function AngularJsonAPISynchronizerPrototypeWrapper($log) {\n\n    AngularJsonAPISynchronizerPrototype.prototype.synchronize = synchronize;\n\n    return AngularJsonAPISynchronizerPrototype;\n\n    function AngularJsonAPISynchronizerPrototype(synchronizations) {\n      var _this = this;\n\n      _this.synchronizations = synchronizations;\n    }\n\n    function synchronize(config) {\n      var _this = this;\n\n      $log.debug('Synchro Collection', _this.factory.schema.type, config);\n\n      if (config.action === undefined) {\n        $log.error('Can\\'t synchronize undefined action', config);\n      }\n    }\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi-rest', ['angular-jsonapi'])\n  .factory('AngularJsonAPISynchronizationRest', AngularJsonAPISynchronizationRestWrapper);\n\n  function AngularJsonAPISynchronizationRestWrapper(\n    AngularJsonAPIModelSynchronizationError,\n    AngularJsonAPISynchronizationPrototype,\n    AngularJsonAPIModelLinkerService,\n    toKebabCase,\n    $q,\n    $http\n  ) {\n\n    AngularJsonAPISynchronizationRest.prototype = Object.create(AngularJsonAPISynchronizationPrototype.prototype);\n    AngularJsonAPISynchronizationRest.prototype.constructor = AngularJsonAPISynchronizationRest;\n\n    return {\n      create: AngularJsonAPISynchronizationRestFactory\n    };\n\n    function AngularJsonAPISynchronizationRestFactory(name, url) {\n      return new AngularJsonAPISynchronizationRest(name, url);\n    }\n\n    function AngularJsonAPISynchronizationRest(name, url) {\n      var _this = this;\n      var headers = { // jscs:disable disallowQuotedKeysInObjects\n        'Accept': 'application/vnd.api+json',\n        'Content-Type': 'application/vnd.api+json'\n      }; // jscs:enable disallowQuotedKeysInObjects\n\n      AngularJsonAPISynchronizationPrototype.apply(_this, arguments);\n\n      _this.synchronization('remove', remove);\n      _this.synchronization('unlink', unlink);\n      _this.synchronization('link', link);\n      _this.synchronization('update', update);\n      _this.synchronization('add', add);\n      _this.synchronization('all', all);\n      _this.synchronization('get', get);\n      _this.synchronization('refresh', get);\n\n      function all(config) {\n        return $http({\n          method: 'GET',\n          headers: headers,\n          url: url,\n          params: config.params || {}\n        }).then(resolveHttp, rejectHttp.bind(null, 'all'));\n      }\n\n      function get(config) {\n        return $http({\n          method: 'GET',\n          headers: headers,\n          url: url + '/' + config.object.data.id,\n          params: config.params || {}\n        }).then(resolveHttp, rejectHttp.bind(null, 'get'));\n      }\n\n      function remove(config) {\n        return $http({\n          method: 'DELETE',\n          headers: headers,\n          url: url + '/' + config.object.data.id\n        }).then(resolveHttp, rejectHttp.bind(null, 'remove'));\n      }\n\n      function unlink(config) {\n        var deferred = $q.defer();\n        var schema = config.object.schema.relationships[config.key];\n\n        if (config.object.removed === true) {\n          deferred.reject(AngularJsonAPIModelSynchronizationError.create('Object has been removed', _this, 0, 'unlink'));\n        } else if (config.target !== undefined && config.target.data.id === undefined) {\n          deferred.reject(AngularJsonAPIModelSynchronizationError.create('Can\\'t unlink object without id through rest call', _this, 0, 'unlink'));\n        } else if (schema.type === 'hasOne') {\n          $http({\n            method: 'DELETE',\n            headers: headers,\n            url: url + '/' + config.object.data.id + '/relationships/' + config.key\n          }).then(resolveHttp, rejectHttp.bind(null, 'get')).then(deferred.resolve, deferred.reject);\n        } else if (schema.type === 'hasMany') {\n          if (config.target === undefined) {\n            $http({\n              method: 'PUT',\n              headers: headers,\n              data: {data: []},\n              url: url + '/' + config.object.data.id + '/relationships/' + config.key\n            }).then(resolveHttp, rejectHttp.bind(null, 'unlink')).then(deferred.resolve, deferred.reject);\n          } else {\n            $http({\n              method: 'DELETE',\n              headers: headers,\n              url: url + '/' + config.object.data.id + '/relationships/' + config.key + '/' + config.target.data.id\n            }).then(resolveHttp, rejectHttp.bind(null, 'unlink')).then(deferred.resolve, deferred.reject);\n          }\n        }\n\n        return deferred.promise;\n      }\n\n      function link(config) {\n        var deferred = $q.defer();\n        var schema = config.object.schema.relationships[config.key];\n\n        if (config.object.removed === true) {\n          deferred.reject({errors: [{status: 0, statusText: 'Object has been removed'}]});\n        } else if (config.target === undefined || config.target.data.id === undefined) {\n          deferred.reject({errors: [{status: 0, statusText: 'Can\\'t link object without id through rest call'}]});\n        } else if (schema.type === 'hasOne') {\n          $http({\n            method: 'PUT',\n            headers: headers,\n            data: {data: AngularJsonAPIModelLinkerService.toLinkData(config.target)},\n            url: url + '/' + config.object.data.id + '/relationships/' + config.key\n          }).then(resolveHttp, rejectHttp.bind(null, 'link')).then(deferred.resolve, deferred.reject);\n        } else if (schema.type === 'hasMany') {\n          $http({\n            method: 'POST',\n            headers: headers,\n            data: {data: [AngularJsonAPIModelLinkerService.toLinkData(config.target)]},\n            url: url + '/' + config.object.data.id + '/relationships/' + config.key\n          }).then(resolveHttp, rejectHttp.bind(null, 'link')).then(deferred.resolve, deferred.reject);\n        }\n\n        return deferred.promise;\n      }\n\n      function update(config) {\n        return $http({\n          method: 'PUT',\n          headers: headers,\n          url: url + '/' + config.object.data.id,\n          data: config.object.form.toJson()\n        }).then(resolveHttp, rejectHttp.bind(null, 'update'));\n      }\n\n      function add(config) {\n        return $http({\n          method: 'POST',\n          headers: headers,\n          url: url + '/',\n          data: config.object.form.toJson()\n        }).then(resolveHttp, rejectHttp.bind(null, 'add'));\n      }\n\n      function resolveHttp(response) {\n        return $q.resolve(response.data);\n      }\n\n      function rejectHttp(action, response) {\n        var deferred = $q.defer();\n\n        if (response.status === 0) {\n          $http({\n            method: 'GET',\n            url: 'https://status.cloud.google.com/incidents.schema.json'\n          }).then(rejectServerOffline, rejectNoConnection);\n        } else {\n          deferred.reject(AngularJsonAPIModelSynchronizationError.create(response.statusText, _this, response.status, action));\n        }\n\n        return deferred.promise;\n\n        function rejectServerOffline(response) {\n          console.log('offline');\n          console.log(response);\n          deferred.reject(AngularJsonAPIModelSynchronizationError.create('Server is offline', _this, response.status, action));\n        }\n\n        function rejectNoConnection() {\n          console.log('no internet');\n          deferred.reject(AngularJsonAPIModelSynchronizationError.create('No internet connection', _this, response.status, action));\n        }\n      }\n    }\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPISynchronizationPrototype', AngularJsonAPISynchronizationPrototypeWrapper);\n\n  function AngularJsonAPISynchronizationPrototypeWrapper() {\n    AngularJsonAPISynchronizationPrototype.prototype.before = beforeSynchro;\n    AngularJsonAPISynchronizationPrototype.prototype.after = afterSynchro;\n    AngularJsonAPISynchronizationPrototype.prototype.begin = begin;\n    AngularJsonAPISynchronizationPrototype.prototype.finish = finish;\n    AngularJsonAPISynchronizationPrototype.prototype.synchronization = synchronization;\n\n    return AngularJsonAPISynchronizationPrototype;\n\n    function AngularJsonAPISynchronizationPrototype(name) {\n      var _this = this;\n      var allHooks = [\n        'add',\n        'init',\n        'get',\n        'all',\n        'clearCache',\n        'remove',\n        'unlink',\n        'unlinkReflection',\n        'link',\n        'linkReflection',\n        'update',\n        'refresh',\n        'include'\n      ];\n\n      _this.name = name;\n      _this.state = {};\n\n      _this.beginHooks = {};\n      _this.beforeHooks = {};\n      _this.synchronizationHooks = {};\n      _this.afterHooks = {};\n      _this.finishHooks = {};\n\n      _this.options = {};\n\n      angular.forEach(allHooks, function(hookName) {\n        _this.beginHooks[hookName] = [];\n        _this.beforeHooks[hookName] = [];\n        _this.synchronizationHooks[hookName] = [];\n        _this.afterHooks[hookName] = [];\n        _this.finishHooks[hookName] = [];\n        _this.state[hookName] = {\n          loading: false,\n          success: true\n        };\n      });\n    }\n\n    function begin(action, callback) {\n      var _this = this;\n\n      _this.beginHooks[action].push(callback);\n    }\n\n    function finish(action, callback) {\n      var _this = this;\n\n      _this.finishHooks[action].push(callback);\n    }\n\n    function beforeSynchro(action, callback) {\n      var _this = this;\n\n      _this.beforeHooks[action].push(callback);\n    }\n\n    function afterSynchro(action, callback) {\n      var _this = this;\n\n      _this.afterHooks[action].push(callback);\n    }\n\n    function synchronization(action, callback) {\n      var _this = this;\n\n      _this.synchronizationHooks[action].push(callback);\n    }\n\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi-local', ['angular-jsonapi'])\n  .factory('AngularJsonAPISynchronizationLocal', AngularJsonAPISynchronizationLocalWrapper);\n\n  function AngularJsonAPISynchronizationLocalWrapper(\n    AngularJsonAPISynchronizationPrototype,\n    $window,\n    $q\n  ) {\n\n    AngularJsonAPISynchronizationLocal.prototype = Object.create(AngularJsonAPISynchronizationPrototype.prototype);\n    AngularJsonAPISynchronizationLocal.prototype.constructor = AngularJsonAPISynchronizationLocal;\n\n    return {\n      create: AngularJsonAPISynchronizationLocalFactory\n    };\n\n    function AngularJsonAPISynchronizationLocalFactory(name, prefix) {\n      return new AngularJsonAPISynchronizationLocal(name, prefix);\n    }\n\n    function AngularJsonAPISynchronizationLocal(name, prefix) {\n      var _this = this;\n\n      prefix = prefix || 'AngularJsonAPI';\n\n      _this.__updateStorage = updateStorage;\n\n      AngularJsonAPISynchronizationPrototype.apply(_this, arguments);\n\n      _this.synchronization('init', init);\n\n      _this.begin('clearCache', clear);\n      _this.begin('remove', updateStorage);\n      _this.begin('refresh', updateStorage);\n      _this.begin('unlink', updateStorage);\n      _this.begin('unlinkReflection', updateStorage);\n      _this.begin('link', updateStorage);\n      _this.begin('linkReflection', updateStorage);\n      _this.begin('update', updateStorage);\n      _this.begin('add', updateStorage);\n      _this.begin('get', updateStorage);\n      _this.begin('all', updateStorage);\n      _this.begin('include', updateStorage);\n\n      _this.finish('init', updateStorage);\n      _this.finish('clearCache', updateStorage);\n      _this.finish('remove', updateStorage);\n      _this.finish('refresh', updateStorage);\n      _this.finish('unlink', updateStorage);\n      _this.finish('unlinkReflection', updateStorage);\n      _this.finish('link', updateStorage);\n      _this.finish('linkReflection', updateStorage);\n      _this.finish('update', updateStorage);\n      _this.finish('add', updateStorage);\n      _this.finish('get', updateStorage);\n      _this.finish('all', updateStorage);\n      _this.finish('include', updateStorage);\n\n      function init() {\n        var type = _this.synchronizer.factory.schema.type;\n        return $q.resolve($window.localStorage.getItem(prefix + '.' + type));\n      }\n\n      function clear() {\n        var type = _this.synchronizer.factory.schema.type;\n        $window.localStorage.removeItem(prefix + '.' + type);\n      }\n\n      function updateStorage() {\n        var type = _this.synchronizer.factory.schema.type;\n        var cache = _this.synchronizer.factory.cache;\n        $window.localStorage.setItem(prefix + '.' + type, cache.toJson());\n      }\n    }\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPISchema', AngularJsonAPISchemaWrapper);\n\n  function AngularJsonAPISchemaWrapper($log, pluralize, AngularJsonAPISchemaLink) {\n\n    return {\n      create: AngularJsonAPISchemaFactory\n    };\n\n    function AngularJsonAPISchemaFactory(schema) {\n      return new AngularJsonAPISchema(schema);\n    }\n\n    function AngularJsonAPISchema(schema) {\n      var _this = this;\n      var include = schema.include || {};\n      schema.include = include;\n      include.get = schema.include.get || [];\n      include.all = schema.include.all || [];\n\n      _this.params = {\n        get: {},\n        all: {}\n      };\n\n      angular.forEach(schema.relationships, function(linkSchema, linkName) {\n        var linkSchemaObj = AngularJsonAPISchemaLink.create(linkSchema, linkName, schema.type);\n        schema.relationships[linkName] = linkSchemaObj;\n        if (linkSchemaObj.included === true) {\n          include.get.push(linkName);\n          if (linkSchemaObj.type === 'hasOne') {\n            include.all.push(linkName);\n          }\n        }\n      });\n\n      angular.extend(_this, schema);\n\n      if (include.get.length > 0) {\n        _this.params.get.include = include.get.join(',');\n      }\n\n      if (include.all.length > 0) {\n        _this.params.all.include = include.all.join(',');\n      }\n    }\n\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPISchemaLink', AngularJsonAPILinkSchrapperLink);\n\n  function AngularJsonAPILinkSchrapperLink($log, pluralize) {\n\n    return {\n      create: AngularJsonAPISchemaLinkFactory\n    };\n\n    function AngularJsonAPISchemaLinkFactory(linkSchema, linkName, type) {\n      return new AngularJsonAPISchemaLink(linkSchema, linkName, type);\n    }\n\n    function AngularJsonAPISchemaLink(linkSchema, linkName, type) {\n      var _this = this;\n\n      if (angular.isString(linkSchema)) {\n        _this.model = pluralize.plural(linkName);\n        _this.type = linkSchema;\n        _this.polymorphic = false;\n        _this.reflection = type;\n      } else {\n        if (linkSchema.type === undefined) {\n          $log.error('Schema of link without a type: ', linkSchema, linkName);\n        }\n\n        if (linkSchema.type !== 'hasMany' && linkSchema.type !== 'hasOne') {\n          $log.error('Schema of link with wrong type: ', linkSchema.type, 'available: hasOne, hasMany');\n        }\n\n        _this.model = linkSchema.model || pluralize.plural(linkName);\n        _this.type = linkSchema.type;\n        _this.polymorphic = linkSchema.polymorphic || false;\n\n        if (linkSchema.reflection === undefined) {\n          _this.reflection = _this.type === 'hasMany' ? pluralize.singular(type) : type;\n        } else {\n          _this.reflection = linkSchema.reflection;\n        }\n\n        _this.included = linkSchema.included || false;\n      }\n    }\n\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPIResource', AngularJsonAPIResourceWrapper);\n\n  function AngularJsonAPIResourceWrapper(\n    AngularJsonAPIModel,\n    AngularJsonAPISchema,\n    AngularJsonAPIResourceCache,\n    AngularJsonAPICollection,\n    uuid4,\n    $rootScope,\n    $log,\n    $q\n  ) {\n    AngularJsonAPIResource.prototype.get = get;\n    AngularJsonAPIResource.prototype.all = all;\n    AngularJsonAPIResource.prototype.remove = remove;\n    AngularJsonAPIResource.prototype.initialize = initialize;\n\n    AngularJsonAPIResource.prototype.clearCache = clearCache;\n\n    return {\n      create: AngularJsonAPIResourceFactory\n    };\n\n    function AngularJsonAPIResourceFactory(schema, synchronizer) {\n      return new AngularJsonAPIResource(schema, synchronizer);\n    }\n\n    /**\n     * AngularJsonAPIResource constructor\n     * @param {json} schema       Schema object\n     * @param {AngularJsonAPISynchronizer} synchronizer Synchronizer for the factory\n     */\n    function AngularJsonAPIResource(schema, synchronizer) {\n      var _this = this;\n      var config = {\n        action: 'init'\n      };\n\n      _this.schema = AngularJsonAPISchema.create(schema);\n      _this.cache = AngularJsonAPIResourceCache.create(_this);\n\n      _this.synchronizer = synchronizer;\n      _this.synchronizer.factory = _this;\n\n      _this.modelFactory = AngularJsonAPIModel.modelFactory(\n        _this.schema,\n        _this\n      );\n\n      _this.initialized = false;\n      _this.type = _this.schema.type;\n\n      synchronizer.factory = _this;\n\n      _this.synchronizer.synchronize(config).then(resolve, reject, notify);\n\n      function resolve(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.type + ':factory:init', 'resolved', response);\n        _this.cache.fromJson(response.data);\n        _this.initialized = true;\n\n        response.finish();\n      }\n\n      function reject(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.type + ':factory:init', 'rejected', response);\n        response.finish();\n        _this.initialized = true;\n      }\n\n      function notify(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.type + ':factory:init', 'notify', response);\n      }\n    }\n\n    /**\n     * Get request\n     * @param  {uuid} id\n     * @return {AngularJsonAPIModel} Model associated with id, synchronized\n     */\n    function get(id) {\n      var _this = this;\n\n      if (!uuid4.validate(id)) {\n        return $q.reject({errors: [{status: 0, statusText: 'Invalid id not uuid4'}]});\n      }\n\n      var object = _this.cache.get(id);\n\n      object.refresh();\n\n      return object;\n    }\n\n    /**\n     * All request\n     * @param  {object} params Object associated with params (for filters/pagination etc.)\n     * @return {AngularJsonAPICollection} Collection of AngularJsonAPIModel, synchronized\n     */\n    function all(params) {\n      var _this = this;\n      params = params || {};\n\n      var collection = AngularJsonAPICollection.create(\n        _this,\n        angular.extend(params, _this.schema.params.all)\n      );\n\n      collection.fetch();\n\n      return collection;\n    }\n\n    /**\n     * Remove request\n     * @param  {uuid} id\n     * @return {promise} Promise associated with the synchronization, in case of\n     * fail object is reverted to previous state\n     */\n    function remove(id) {\n      var _this = this;\n      var object = _this.cache.remove(id);\n\n      return object.remove();\n    }\n\n    /**\n     * Initialize new AngularJsonAPIModel\n     * @return {AngularJsonAPIModel} New model\n     */\n    function initialize() {\n      var _this = this;\n      var relationships = {};\n\n      angular.forEach(_this.schema.relationships, function(relationshipSchema, relationshipName) {\n        if (relationshipSchema.type === 'hasOne') {\n          relationships[relationshipName] = {\n            data: null\n          };\n        } else if (relationshipSchema.type === 'hasMany') {\n          relationships[relationshipName] = {\n            data: []\n          };\n        }\n      });\n\n      var data = {\n        type: _this.type,\n        id: uuid4.generate(),\n        attributes: {},\n        relationships: relationships\n      };\n\n      var config = {\n        saved: false,\n        synchronized: false,\n        stable: false,\n        pristine: false,\n        initialization: false\n      };\n\n      var object = _this.cache.addOrUpdate(data, config);\n\n      $rootScope.$emit('angularJsonAPI:' + _this.type + ':factory:initialize', 'resolved', object);\n\n      return object;\n    }\n\n    /**\n     * Clears localy saved data\n     * @return {promise} Promise associated with the synchronization resolves to nothing\n     */\n    function clearCache() {\n      var _this = this;\n      var deferred = $q.defer();\n      var config = {\n        action: 'clearCache'\n      };\n\n      _this.cache.clear();\n\n      _this.synchronizer.synchronize(config).then(resolve, reject, notify);\n\n      return deferred;\n\n      function resolve(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.type + ':factory:clearCache', 'resolved', response);\n        response.finish();\n\n        deferred.resolve(response);\n      }\n\n      function reject(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.type + ':factory:clearCache', 'resolved', response);\n        response.finish();\n\n        deferred.reject(response);\n      }\n\n      function notify(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.type + ':factory:clearCache', 'notify', response);\n\n        deferred.notify(response);\n      }\n    }\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPIModel', AngularJsonAPIModel);\n\n  function AngularJsonAPIModel(AngularJsonAPIAbstractModel, AngularJsonAPISchema, $log) {\n\n    return {\n      modelFactory: createModelFactory\n    };\n\n    function createModelFactory(schemaObj, factory) {\n      var Model = function(data, updatedAt, saved) {\n        var _this = this;\n\n        if (data.type !== _this.schema.type) {\n          $log.error('Data type other then declared in schema: ', data.type, ' instead of ', _this.schema.type);\n        }\n\n        AngularJsonAPIAbstractModel.call(_this, data, updatedAt, saved);\n\n        _this.form.parent = _this;\n      };\n\n      Model.prototype = Object.create(AngularJsonAPIAbstractModel.prototype);\n      Model.prototype.constructor = Model;\n\n      Model.prototype.schema = schemaObj;\n      Model.prototype.factory = factory;\n      Model.prototype.synchronize = factory.synchronizer.synchronize.bind(factory.synchronizer);\n\n      angular.forEach(schemaObj.functions, function(metaFunction, metaFunctionName) {\n        Model.prototype[metaFunctionName] = function() {\n          return metaFunction.apply(this, arguments);\n        };\n      });\n\n      return modelFactory;\n\n      function modelFactory(data, updatedAt, saved) {\n        return new Model(data, updatedAt, saved);\n      }\n    }\n\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .factory('AngularJsonAPICollection', AngularJsonAPICollectionWrapper);\n\n  function AngularJsonAPICollectionWrapper(\n    AngularJsonAPIModelSynchronizationError,\n    AngularJsonAPIModelErrorsManager,\n    $rootScope,\n    $injector,\n    $q\n  ) {\n\n    AngularJsonAPICollection.prototype.fetch = fetch;\n    AngularJsonAPICollection.prototype.refresh = fetch;\n    AngularJsonAPICollection.prototype.get = get;\n    AngularJsonAPICollection.prototype.hasErrors = hasErrors;\n\n    return {\n      create: AngularJsonAPICollectionFactory\n    };\n\n    function AngularJsonAPICollectionFactory(factory, params) {\n      return new AngularJsonAPICollection(factory, params);\n    }\n\n    /**\n     * Constructor\n     * @param {AngularJsonAPIResource} factory Factory associated with the collection\n     * @param {object} params  Params associated with this factory (such as filters)\n     */\n    function AngularJsonAPICollection(factory, params) {\n      var _this = this;\n\n      _this.factory = factory;\n      _this.type = factory.schema.type;\n      _this.params = params;\n\n      _this.errors = {\n        synchronization: AngularJsonAPIModelErrorsManager.create(\n          'Synchronization',\n          'Errors of synchronizations',\n          AngularJsonAPIModelSynchronizationError\n        )\n      };\n\n      _this.data = _this.factory.cache.index(_this.params);\n\n      _this.loading = false;\n      _this.loadingCount = 0;\n      _this.synchronized = false;\n      _this.pristine = _this.data === undefined;\n\n      $rootScope.$on('angularJsonAPI:' + _this.type + ':object:remove', remove);\n      $rootScope.$on('angularJsonAPI:' + _this.type + ':factory:clearCache', clear);\n      $rootScope.$on('angularJsonAPI:' + _this.type + ':object:add', add);\n\n      function remove(event, status, object) {\n        var index;\n\n        if (status === 'resolved' && _this.data !== undefined) {\n          index = _this.data.indexOf(object);\n          if (index > -1) {\n            _this.data.splice(index, 1);\n            _this.factory.cache.setIndexIds(_this.data);\n          }\n        }\n      }\n\n      function clear() {\n        _this.data = undefined;\n        _this.pristine = true;\n      }\n\n      function add(event, status, object) {\n        if (status === 'resolved') {\n          _this.data = _this.data || [];\n          _this.data.push(object);\n        }\n      }\n    }\n\n    /**\n     * Check if the object has errors\n     * @return {Boolean}\n     */\n    function hasErrors() {\n      var _this = this;\n      var answer = false;\n\n      angular.forEach(_this.errors, function(error) {\n        answer = error.hasErrors() || answer;\n      });\n\n      return answer;\n    }\n\n    /**\n     * Shortcut to this.factory.get\n     * @param  {uuid4} id Id of object]\n     * @return {AngularJsonAPIModel}          Model with id\n     */\n    function get(id) {\n      var _this = this;\n\n      return _this.factory.get(id);\n    }\n\n    /**\n     * Synchronizes collection with the server\n     * @return {promise} Promise associated with synchronization that resolves to this\n     */\n    function fetch() {\n      var _this = this;\n      var deferred = $q.defer();\n      var $jsonapi = $injector.get('$jsonapi');\n      var config = {\n        action: 'all',\n        params: _this.params\n      };\n\n      __incrementLoadingCounter(_this);\n\n      angular.forEach(_this.data, __incrementLoadingCounter);\n\n      _this.factory.synchronizer.synchronize(config)\n        .then(resolve, reject, notify)\n        .finally(__decrementLoadingCounter.bind(_this, undefined));\n\n      return deferred.promise;\n\n      function resolve(response) {\n        var results = $jsonapi.proccesResults(response.data);\n        $rootScope.$emit('angularJsonAPI:' + _this.type + ':collection:fetch', 'resolved', _this, response);\n        $q.allSettled(results.included.map(synchronizeIncluded)).then(resolveIncluded, deferred.reject);\n\n        angular.forEach(_this.data, __decrementLoadingCounter);\n\n        _this.data = results.data;\n\n        _this.updatedAt = Date.now();\n        _this.synchronized = true;\n\n        _this.factory.cache.setIndexIds(_this.data);\n        response.finish();\n        _this.errors.synchronization.concat(response.errors);\n\n        function synchronizeIncluded(object) {\n          __incrementLoadingCounter(object);\n\n          return object.synchronize({\n            action: 'include',\n            object: object\n          }).finally(__decrementLoadingCounter.bind(object, undefined));\n        }\n\n        function resolveIncluded(includedResponse) {\n          angular.forEach(includedResponse, function(operation, key) {\n            if (operation.success === true) {\n              $rootScope.$emit('angularJsonAPI:' + results.included[key].data.type + ':object:include', 'resolved', results.included[key], operation);\n\n              operation.value.finish();\n            }\n          });\n\n          deferred.resolve(response);\n        }\n\n        deferred.resolve(_this);\n      }\n\n      function reject(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.type + ':collection:fetch', 'rejected', _this, response);\n        console.log(response);\n\n        angular.forEach(_this.data, __decrementLoadingCounter);\n        response.finish();\n        _this.errors.synchronization.concat(response.errors);\n        deferred.reject(response);\n      }\n\n      function notify(response) {\n        $rootScope.$emit('angularJsonAPI:' + _this.type + ':collection:fetch', 'notify', _this, response);\n\n        deferred.notify(response);\n      }\n    }\n  }\n\n  function __incrementLoadingCounter(object) {\n    object = object === undefined ? this : object;\n    object.loadingCount += 1;\n    object.loading = true;\n  }\n\n  function __decrementLoadingCounter(object) {\n    object = object === undefined ? this : object;\n    object.loadingCount -= 1;\n    object.loading = object.loadingCount > 0;\n  }\n})();\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .provider('$jsonapi', jsonapiProvider);\n\n  function jsonapiProvider() {\n    var memory = {};\n    var names = [];\n    this.$get = jsonapiFactory;\n\n    function jsonapiFactory($log, AngularJsonAPIResource) {\n      return {\n        form: form,\n        get: get,\n        remove: remove,\n        all: all,\n        addResource: addResource,\n        getResource: getResource,\n        clearCache: clearCache,\n        proccesResults: proccesResults,\n\n        allResources: allResources,\n        listResources: listResources\n      };\n\n      function allResources() {\n        return memory;\n      }\n\n      function listResources() {\n        return names;\n      }\n\n      function addResource(schema, synchronization) {\n        var factory = AngularJsonAPIResource.create(schema, synchronization);\n\n        memory[schema.type] = factory;\n        names.push(schema.type);\n      }\n\n      function getResource(type) {\n        return memory[type];\n      }\n\n      function form(type) {\n        if (memory[type] === undefined) {\n          $log.error('Can\\t add not existing object type: ' + type + '. Use initialize.');\n        }\n\n        return memory[type].saved.form;\n      }\n\n      function get(type, id) {\n        if (memory[type] === undefined) {\n          $log.error('Can\\t get not existing object type: ' + type + '. Use initialize.');\n        }\n\n        return memory[type].get(id);\n      }\n\n      function remove(type, id) {\n        if (memory[type] === undefined) {\n          $log.error('Can\\t remove not existing object type: ' + type + '. Use initialize.');\n        }\n\n        return memory[type].remove(id);\n      }\n\n      function all(type) {\n        if (memory[type] === undefined) {\n          $log.error('Can\\t get all of not existing object type: ' + type + '. Use initialize.');\n        }\n\n        return memory[type].all();\n      }\n\n      function clearCache() {\n        angular.forEach(memory, function(factory) {\n          factory.clearCache();\n        });\n      }\n\n      function proccesResults(results) {\n        var objects = {\n          data: [],\n          included: []\n        };\n\n        if (results === undefined) {\n          $log.error('Can\\'t proccess results:', results);\n        }\n\n        var config = {\n          saved: true,\n          synchronized: true,\n          stable: true,\n          pristine: false,\n          initialization: false\n        };\n\n        angular.forEach(results.included, function(data) {\n          objects.included.push(getResource(data.type).cache.addOrUpdate(data, config));\n        });\n\n        if (angular.isArray(results.data)) {\n          angular.forEach(results.data, function(data) {\n            objects.data.push(getResource(data.type).cache.addOrUpdate(data, config));\n          });\n        } else {\n          objects.data.push(getResource(results.data.type).cache.addOrUpdate(results.data, config));\n        }\n\n        return objects;\n      }\n    }\n  }\n\n})();\n\n","(function() {\n  'use strict';\n\n  angular.module('angular-jsonapi')\n  .config(function($logProvider) {\n    $logProvider.debugEnabled(false);\n  })\n  .run(function(validateJS, $q) {\n    validateJS.Promise = $q;\n  });\n})();\n"],"sourceRoot":"/source/"}