!function(){"use strict";angular.module("angular-jsonapi",["uuid4"]).constant("pluralize",pluralize)}(),function(){"use strict";function t(t,n,o,a){function e(t,n){var e=this,r=new a(t);e.Model=o.model(r,e.allCollections,e),e.synchronization=n,e.loadingCount=0,e.data={},e.removed={},e.schema=r,e.dummy=new e.Model({type:t.type},void 0,!0),e.dummy.form.save=h.bind(e.dummy),e.allCollections[t.type]=e,e.__synchronize("init")}function r(t){var n=this,o=angular.fromJson(t);null!==o&&void 0!==o.data&&(n.updatedAt=o.updatedAt,angular.forEach(o.data,function(t){var o=t.data;n.addOrUpdate(o,t.updatedAt)}))}function i(){var t=this,n={data:{},updatedAt:t.updatedAt};return angular.forEach(t.data,function(t,o){n.data[o]=t.toJson()}),angular.toJson(n)}function s(n,o){var a=this;return void 0===n.id?void t.error("Can't add data without id!",n):(void 0===a.data[n.id]?a.data[n.id]=new this.Model(n,o):(a.data[n.id].__setData(n,o),a.data[n.id].__setLinks(n.relationships)),a.data[n.id].__setUpdated(o),a.data[n.id])}function l(t){var n=this;return void 0===n.data[t]&&(n.data[t]=new n.Model({id:t,type:n.Model.prototype.schema.type},void 0,!0)),n.data[t]}function u(t){var n,o=this;return angular.isArray(t)?(n=[],angular.forEach(t,function(t){n.push(o.__get(t))})):n=o.__get(t),o.__synchronize("get",n,void 0,void 0,o.schema.params.get),n}function d(){var t=this;return t.__synchronize("all",void 0,void 0,void 0,t.schema.params.all),t}function c(){var t=this;t.updatedAt=Date.now(),t.data={},t.__synchronize("clear")}function p(t){var n=this,o=n.data[t];n.removed[t]=o,n.updatedAt=Date.now(),delete n.data[t]}function f(n){var o=this,a=o.data[n];void 0!==a?(o.__remove(n),a.__remove(n)):t.error("Object with this id does not exist"),o.__synchronize("remove",a)}function h(){var o,a=this,e=a.form.validate();if(angular.equals(e,{})){var r=angular.copy(a.form.data);if(void 0===r.id)r.id=n.generate();else if(!n.validate(r.id))return void t.error("Wrong id of dummy data!");r.relationships={},r.type=a.schema.type,o=a.parentCollection.addOrUpdate(r),a.form.reset(),a.parentCollection.__synchronize("add",a)}}function v(n,o,a,e,r){var i=this;t.log("Synchro Collection",this.Model.prototype.schema.type,{action:n,object:o,linkKey:a,linkedObject:e,params:r}),i.synchronization.synchronize(n,i,o,a,e,r)}return e.prototype.allCollections={},e.prototype.__synchronize=v,e.prototype.__get=l,e.prototype.__remove=p,e.prototype.get=u,e.prototype.all=d,e.prototype.remove=f,e.prototype.clear=c,e.prototype.fromJson=r,e.prototype.toJson=i,e.prototype.addOrUpdate=s,e}angular.module("angular-jsonapi").factory("AngularJsonAPICollection",t),t.$inject=["$log","uuid4","JsonAPIModelFactory","AngularJsonAPISchema"]}(),function(){"use strict";angular.module("angular-jsonapi").constant("lazyProperty",function(t,n,o){var a,e;Object.defineProperty(t,n,{get:function(){return e||(e=!0,a=o.call(t)),a},enumerable:!0,configurable:!0})})}(),function(){"use strict";angular.module("angular-jsonapi").config(["$provide",function(t){t.decorator("$q",["$delegate",function(t){var n=t;return n.allSettled=n.allSettled||function(t){function o(t){return n.when(t).then(function(t){return{success:!0,value:t}},function(t){return{success:!1,reason:t}})}var a=angular.isArray(t)?[]:{};return angular.forEach(t,function(t,n){a.hasOwnProperty(n)||(a[n]=o(t))}),n.all(a)},n}])}])}(),function(){"use strict";function t(t){function n(){var t=this,n=["add","init","get","all","clear","remove","removeLink","removeLinkReflection","addLink","addLinkReflection","update","refresh"];t.state={},t.beginHooks={},t.beforeHooks={},t.synchronizationHooks={},t.afterHooks={},t.finishHooks={},t.options={},angular.forEach(n,function(n){t.beginHooks[n]=[],t.beforeHooks[n]=[],t.synchronizationHooks[n]=[],t.afterHooks[n]=[],t.finishHooks[n]=[],t.state[n]={loading:!1,success:!0}})}function o(t){function n(n){angular.forEach(t[n],function(t,a){o[n][a]=o[n][a].concat(t)})}var o=this;n("beginHooks"),n("beforeHooks"),n("synchronizationHooks"),n("afterHooks"),n("finishHooks"),angular.extend(o.options,t.options)}function a(t,n){var o=this;o.beginHooks[t].push(n)}function e(t,n){var o=this;o.finishHooks[t].push(n)}function r(t,n){var o=this;o.beforeHooks[t].push(n)}function i(t,n){var o=this;o.afterHooks[t].push(n)}function s(t,n){var o=this;o.synchronizationHooks[t].push(n)}function l(n,o,a,e,r,i){var s=this,l=[];s.state[n].loading=!0,void 0!==a&&(a.loadingCount+=1),void 0!==o&&(o.loadingCount+=1),angular.forEach(s.beginHooks[n],function(t){t.call(s,o,a,e,r,i)}),angular.forEach(s.beforeHooks[n],function(t){t.call(s,o,a,e,r,i)}),angular.forEach(s.synchronizationHooks[n],function(t){l.push(t.call(s,o,a,e,r,i))}),t.allSettled(l).then(function(t){s.state[n].success=!0,angular.forEach(t,function(t){t.success===!1&&(s.state[n].success=!1)}),angular.forEach(s.afterHooks[n],function(n){n.call(s,o,a,e,r,i,t)}),angular.forEach(s.finishHooks[n],function(t){t.call(s,o,a,e,r,i)}),s.state[n].loading=!1,void 0!==a&&(a.loadingCount-=1),void 0!==o&&(o.loadingCount-=1)})}return n.prototype.before=r,n.prototype.after=i,n.prototype.begin=a,n.prototype.finish=e,n.prototype.synchronization=s,n.prototype.synchronize=l,n.prototype.extend=o,n}angular.module("angular-jsonapi").factory("AngularJsonAPISynchronization",t),t.$inject=["$q"]}(),function(){"use strict";function t(t,n,o){function a(a){function e(t,n,o,a){return{data:t,status:n,headers:o,config:a}}function r(t,n,o,a,e,r){var i=r[0].value.data.data,s=r[0].value.data.included;if(r[0].success===!0&&void 0!==i){var l={};angular.forEach(i,function(n){l[n.id]=n,t.addOrUpdate(n)}),angular.forEach(t.data,function(n){void 0===l[n.id]&&t.__remove(n.id)}),angular.forEach(s,function(n){t.allCollections[n.type].addOrUpdate(n)})}}function i(t,n,o,a,e,r){var i,s;r[0].success===!0?(i=r[0].value.data.data,s=r[0].value.data.included,t.addOrUpdate(i),angular.forEach(s,function(n){t.allCollections[n.type].addOrUpdate(n)})):(n.error=!0,n.__remove(),t.__remove(n.data.id))}function s(t,r,i){var s=n.defer(),l={method:"GET",url:a,params:i||{}};return o(l).success(function(t,n,o,a){s.resolve(e(t,n,o,a))}).error(function(t,n,o,a){s.reject(e(t,n,o,a))}),s.promise}function l(t,r,i,s,l){var u,d,c=n.defer();return angular.isArray(r)?(d=[],angular.forEach(r,function(t){d.push(t.data.id)})):d=r.data.id,u={method:"GET",url:a+"/"+d.toString(),params:l||{}},o(u).success(function(t,n,o,a){c.resolve(e(t,n,o,a))}).error(function(t,n,o,a){c.reject(e(t,n,o,a))}),c.promise}function u(t,r){var i=n.defer(),s={method:"DELETE",url:a+"/"+r.data.id};return o(s).success(function(t,n,o,a){i.resolve(e(t,n,o,a))}).error(function(t,n,o,a){i.reject(e(t,n,o,a))}),i.promise}function d(t,r,i,s){var l,u=n.defer();return r.removed===!0||void 0===s?u.resolve():(l={method:"DELETE",url:a+"/"+r.data.id+"/relationships/"+i,data:{data:s.toLink()}},o(l).success(function(t,n,o,a){u.resolve(e(t,n,o,a))}).error(function(t,n,o,a){u.reject(e(t,n,o,a))})),u.promise}function c(t,r,i,s){var l=n.defer(),u={method:"POST",url:a+"/"+r.data.id+"/relationships/"+i,data:{data:s.toLink()}};return o(u).success(function(t,n,o,a){l.resolve(e(t,n,o,a))}).error(function(t,n,o,a){l.reject(e(t,n,o,a))}),l.promise}function p(t,r){var i=n.defer(),s={method:"PATCH",url:a+"/"+r.data.id,data:{data:r.toPatchData()}};return o(s).success(function(t,n,o,a){i.resolve(e(t,n,o,a))}).error(function(t,n,o,a){i.reject(e(t,n,o,a))}),i.promise}function f(t,r){var i=n.defer();console.log(r);var s={method:"POST",url:a+"/",data:{data:r.toJson()}};return o(s).success(function(t,n,o,a){i.resolve(e(t,n,o,a))}).error(function(t,n,o,a){i.reject(e(t,n,o,a))}),i.promise}var h=this;t.call(h),h.synchronization("remove",u),h.synchronization("removeLink",d),h.synchronization("addLink",c),h.synchronization("update",p),h.synchronization("add",f),h.synchronization("all",s),h.synchronization("get",l),h.synchronization("refresh",l),h.after("all",r),h.after("get",i),h.after("refresh",i)}return a.prototype=Object.create(t.prototype),a.prototype.constructor=a,a}angular.module("angular-jsonapi-rest",["angular-jsonapi"]).factory("AngularJsonAPISynchronizationRest",t),t.$inject=["AngularJsonAPISynchronization","$q","$http"]}(),function(){"use strict";function t(t,n){function o(o){function a(t){var a=n.localStorage.getItem(o+"."+t.Model.prototype.schema.type);t.fromJson(a)}function e(t){n.localStorage.removeItem(o+"."+t.Model.prototype.schema.type)}function r(t){n.localStorage.setItem(o+"."+t.Model.prototype.schema.type,t.toJson())}var i=this;i.__updateStorage=r,t.call(i),i.begin("init",a),i.begin("clear",e),i.begin("remove",r),i.begin("removeLink",r),i.begin("removeLinkReflection",r),i.begin("addLink",r),i.begin("addLinkReflection",r),i.begin("update",r),i.begin("add",r),i.finish("get",r),i.finish("all",r),i.finish("init",r),i.finish("clear",r),i.finish("remove",r),i.finish("removeLink",r),i.finish("removeLinkReflection",r),i.finish("addLink",r),i.finish("addLinkReflection",r),i.finish("update",r),i.finish("add",r),i.finish("get",r),i.finish("all",r)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o}angular.module("angular-jsonapi-local",["angular-jsonapi"]).factory("AngularJsonAPISynchronizationLocal",t),t.$inject=["AngularJsonAPISynchronization","$window"]}(),function(){"use strict";function t(t,n){function o(t){var n=this,o=[];n.params={get:{},all:{}},angular.forEach(t.relationships,function(n,e){var r=new a(n,e,t.type);t.relationships[e]=r,r.included===!0&&o.push(e)}),angular.extend(n,t),o.length>0&&(n.params.get.include=o.join(","))}function a(o,a,e){var r=this;angular.isString(o)?(r.model=n.plural(a),r.type=o,r.polymorphic=!1,r.reflection=e):(void 0===o.type&&t.error("Schema of link without a type: ",o,a),r.model=o.model||n.plural(a),r.type=o.type,r.polymorphic=o.polymorphic||!1,r.reflection=o.reflection||e,r.included=o.included||!1)}return o}angular.module("angular-jsonapi").factory("AngularJsonAPISchema",t),t.$inject=["$log","pluralize"]}(),function(){"use strict";function t(t,n,o){function a(n,a,e){var r=function(n,a,e){var r=this;n.type!==r.schema.type&&o.error("Data type other then declared in schema: ",n.type," instead of ",r.schema.type),t.call(r,n,a,e),r.form.parent=r};return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.schema=n,r.prototype.linkedCollections=a,r.prototype.parentCollection=e,angular.forEach(n.functions,function(t,n){r.prototype[n]=function(){return t.call(this)}}),r}return{model:a}}angular.module("angular-jsonapi").factory("JsonAPIModelFactory",t),t.$inject=["AngularJsonAPIAbstractData","AngularJsonAPISchema","$log"]}(),function(){"use strict";function t(t,n,o,a){function e(t,n,o){var e=this;t.relationships=t.relationships||{},e.removed=!1,e.loadingCount=0,e.data={relationships:{},attributes:{}},e.relationships={},e.errors={validation:{}},e.dummy=o||!1,e.error=!1,e.__setUpdated(n),e.__setData(t,n),e.form=new a(e)}function r(){var t=this;t.parentCollection.__synchronize("refresh",t)}function i(){var t=this;return{data:t.data,updatedAt:t.updatedAt}}function s(t){var n=this;n.updatedAt=t||Date.now(),n.parentCollection.updatedAt=n.updatedAt}function l(){var t=this;t.__setUpdated(),t.removed=!0,t.removeAllLinks()}function u(){var t=this;t.__remove(),t.parentCollection.remove(t.data.id)}function d(){return{type:this.data.type,id:this.data.id}}function c(){var t=this,n={data:{}};return angular.forEach(t.data,function(t,o){"relationships"!==o&&(n.data[o]=t)}),n}function p(o,a,e){var r=this,i=r.linkedCollections[a].__get(e);return void 0===r.schema.relationships[o]?void t.error("Cannot add link not specified in schema: "+o):void 0===r.linkedCollections[a]?void t.error("Cannot add link of not existing type: "+a):n.validate(e)?void 0===i?void t.error("Cant find",a,"with",e):void r.addLink(o,i):void t.error("Wrong link id, not uuid4: "+e)}function f(n,o,a){var e,r,i,s=this,l=s.schema.relationships[n];if(void 0===o)return void t.error("Can't add non existing object");if(void 0===l)return void t.error("Can't add link not present in schema: ",n,s,a);if(l.polymorphic===!1&&l.model!==o.schema.type)return void t.error("This relation is not polymorphic, expected: "+l.model+" instead of "+o.schema.type);if(e=l.type,r=l.reflection,i=s.data.relationships[n].data,"hasOne"===e){if(null!==i&&i.id===o.data.id)return;void 0!==i&&null!==i&&(t.warn("Swaping hasOne",n,"of",s.toString()),s.removeLink(n)),i=o.toLink()}else{var u=!1;if(angular.forEach(i,function(t){t.id===o.data.id&&(u=!0)}),u===!0)return;i.push(o.toLink())}a===!0?s.parentCollection.__synchronize("addLinkReflection",s,n,o):(o.addLink(r,s,!0),s.parentCollection.__synchronize("addLink",s,n,o)),s.__setUpdated(),s.__setLinkInternal(i,n,l)}function h(){var t=this;angular.forEach(t.relationships,function(n,o){t.removeLink(o)})}function v(n,o,a){var e,r,i,s=this,l=s.schema.relationships[n],u=!1;return void 0===s.schema.relationships[n]?void t.error("Can't remove link not present in schema"):(e=l.type,i=l.reflection,r=s.data.relationships[n].data,"hasOne"===e?null===o.data||void 0!==o&&o.data.id!==r.id||(s.data.relationships[n].data=null,r=null,u=!0,a!==!0&&void 0!==s.relationships[n]&&s.relationships[n].removeLink(i,s,!0)):void 0===o?(s.data.relationships[n].data=[],r=[],u=!0,a!==!0&&angular.forEach(s.relationships[n],function(t){t.removeLink(i,s,!0)})):angular.forEach(r,function(t,n){t.id===o.data.id&&(a!==!0&&o.removeLink(i,s,!0),r.splice(n,1),u=!0)}),void(u===!0&&(s.__setUpdated(),a!==!0?s.parentCollection.__synchronize("removeLink",s,n,o):s.parentCollection.__synchronize("removeLinkReflection",s,n,o),s.__setLinkInternal(r,n,l))))}function g(t){var n=this;n.__setUpdated(),n.__setAttributes(t),n.parentCollection.__synchronize("update",n)}function y(n,a,e){var r=this,i=e.type,s=e.reflection;if(null===n)delete r.relationships[a],r.relationships[a]=void 0;else if("hasMany"===i&&angular.isArray(n)){var l=function(){var o=[];return angular.forEach(n,function(a){var e=r.linkedCollections[a.type];if(void 0===e)return void t.error("No angular-jsonapi schema for",n.type);var i=e.__get(a.id);i.addLink(s,r,!0),o.push(i)}),o};o(r.relationships,a,l)}else if("hasOne"===i&&n.id){var u=function(){var o=r.linkedCollections[n.type];if(void 0===o)return void t.error("No angular-jsonapi schema for",n.type);var a=o.__get(n.id);return a.addLink(s,r,!0),a};o(r.relationships,a,u)}}function m(t,n,o){var a=this,e=o.type,r=o.reflection;if("hasMany"===e&&angular.isArray(t)){var i={};angular.forEach(t,function(t){i[t.id]=t}),angular.forEach(a.relationships[n],function(t){void 0===i[t.data.id]&&t.removeLink(r,a,!0)})}else"hasOne"===e&&null!==t&&t.id&&void 0!==a.relationships[n]&&a.relationships[n].data.id!==t.id&&a.relationships[n].removeLink(r,a,!0);a.__setLinkInternal(t,n,o)}function _(t){var n=this;angular.forEach(n.schema.relationships,function(o,a){"hasOne"===o.type?(n.data.relationships[a]=t[a]||{},n.data.relationships[a].data=n.data.relationships[a].data||null):(n.data.relationships[a]=t[a]||{},n.data.relationships[a].data=n.data.relationships[a].data||[])}),angular.forEach(n.schema.relationships,function(o,a){void 0!==t[a]&&n.__setLink(t[a].data,a,o)})}function k(t,n){var o=this,a=[];return void 0!==t&&(a=j(o.schema.attributes[n],t,n)),a}function A(n){var o=this,a={};return angular.forEach(o.schema.attributes,function(e,r){var i=o.__validateField(n[r],r);i.length>0&&(a[r]=i,t.warn("Erorrs when validating ",n[r],a))}),a}function b(t){var n=this;angular.forEach(n.schema.attributes,function(o,a){t[a]&&(n.data.attributes[a]=t[a])})}function L(t){var n=this,o=angular.copy(t);n.errors.validation=n.__validateData(o),o.relationships=o.relationships||{},o.attributes=o.attributes||{},n.data.id=o.id,n.data.type=o.type,n.__setAttributes(o.attributes),n.__setLinks(o.relationships)}function j(o,a,e){var r=[];if(angular.isArray(o))angular.forEach(o,function(t){r=r.concat(j(t,a,e))});else if(angular.isFunction(o)){var i=o(a);angular.isArray(i)?r.concat(i):t.error("Wrong validator type it should return array of errors instead of: "+i.toString())}else angular.isString(o)?"text"===o||"string"===o?angular.isString(a)||r.push(e+" is not a string "):"number"===o||"integer"===o?parseInt(a).toString()!==a.toString()&&r.push(e+" is not a number"):"uuid4"===o?n.validate(a)||r.push(e+" is not a uuid4"):"required"===o?0===a.toString().length&&r.push(e+" is empty"):t.error("Wrong validator type: "+o.toString()):angular.isObject(o)?(void 0!==o.maxlength&&a.length>o.maxlength&&r.push(e+" is too long max "+o.maxlength),void 0!==o.minlength&&a.length<o.minlength&&r.push(e+" is too short min "+o.minlength),void 0!==o.maxvalue&&parseInt(a)>o.maxvalue&&r.push(e+" is too big max "+o.maxvalue),void 0!==o.minvalue&&parseInt(a)<o.minvalue&&r.push(e+" is too small min "+o.minvalue)):t.error("Wrong validator type: "+o.toString());return r}return e.prototype.__setData=L,e.prototype.__setLinks=_,e.prototype.__setLink=m,e.prototype.__setAttributes=b,e.prototype.__validateData=A,e.prototype.__validateField=k,e.prototype.__updateAttributes=g,e.prototype.__remove=l,e.prototype.__setUpdated=s,e.prototype.__setLinkInternal=y,e.prototype.refresh=r,e.prototype.remove=u,e.prototype.addLinkById=p,e.prototype.addLink=f,e.prototype.removeLink=v,e.prototype.toLink=d,e.prototype.toPatchData=c,e.prototype.removeAllLinks=h,e.prototype.toJson=i,e}angular.module("angular-jsonapi").factory("AngularJsonAPIAbstractData",t),t.$inject=["$log","uuid4","lazyProperty","AngularJsonAPIAbstractDataForm"]}(),function(){"use strict";function t(t){function n(t){var n=this;n.data={},n.parent=t,n.reset()}function o(){var n=this,o=n.validate();return angular.equals(o,{})===!1?void t.error("Errors in form: ",o):void n.parent.__updateAttributes(n.data)}function a(){var t=this;angular.forEach(t.parent.schema.attributes,function(n,o){t.data[o]=t.parent.data.attributes[o]||""}),t.errors={validation:{}}}function e(){var t,n=this;return t=n.parent.__validateData(n.data),n.errors.validation=t,t}function r(t){var n,o=this;return n=o.parent.__validateField(o.data[t],t),o.errors.validation[t]=n,n}function i(n){t.log("Synchro Collection "+this.Model.prototype.schema.type,n)}return n.prototype.save=o,n.prototype.reset=a,n.prototype.validate=e,n.prototype.validateField=r,n.prototype.__synchronize=i,n}angular.module("angular-jsonapi").factory("AngularJsonAPIAbstractDataForm",t),t.$inject=["$log"]}(),function(){"use strict";function t(){function t(t,o){function a(t,a){var e=new o(t,a);n[t.type]=e}function e(t){return n[t]}function r(o){return void 0===n[o]&&t.error("Can	 add not existing object type: "+o+". Use initialize(Model, datas)."),n[o].dummy.form}function i(o,a){return void 0===n[o]&&t.error("Can	 get not existing object type: "+o+". Use initialize(Model, datas)."),n[o].get(a)}function s(o,a){return void 0===n[o]&&t.error("Can	 remove not existing object type: "+o+". Use initialize(Model, datas)."),n[o].remove(a)}function l(o){return void 0===n[o]&&t.error("Can	 get all of not existing object type: "+o+". Use initialize(Model, datas)."),n[o].all()}return{form:r,get:i,remove:s,all:l,addModel:a,getModel:e}}var n={};this.$get=t,t.$inject=["$log","AngularJsonAPICollection"]}angular.module("angular-jsonapi").provider("$jsonapi",t)}();
//# sourceMappingURL=angular-jsonapi.min.js.map