!function(){"use strict";angular.module("angular-jsonapi",["uuid4"]).constant("pluralize",pluralize).constant("validateJS",validate)}(),function(){"use strict";function n(n){function t(n){return null===n?null:{type:n.data.type,id:n.data.id}}function e(t,e,r,i){var l;return void 0===t?(n.error("Can't add link to non existing object",t,e,r),n.error("Object:",t.data.type,t),n.error("Target:",r.data.type,r),n.error("Key:",e),[]):(l=t.schema.relationships[e],void 0===r?(n.error("Can't link non existing object",t,e,r,l),n.error("Object:",t.data.type,t),n.error("Target:",r.data.type,r),n.error("Key:",e),n.error("Schema:",l),[]):void 0===l?(n.error("Can't add link not present in schema:",t,e,r,l),n.error("Object:",t.data.type,t),n.error("Target:",r.data.type,r),n.error("Key:",e),n.error("Schema:",l),[]):null!==r&&l.polymorphic===!1&&l.model!==r.data.type?(n.error("This relation is not polymorphic, expected: "+l.model+" instead of "+r.data.type),n.error("Object:",t.data.type,t),n.error("Target:",r.data.type,r),n.error("Key:",e),n.error("Schema:",l),[]):"hasMany"===l.type?i===!0?(c(t,e,r,!1),[]):a(t,e,r):"hasOne"===l.type?i===!0?(s(t,e,r,!1),[]):o(t,e,r):void 0)}function r(t,e,r,a){var o;return void 0===t?(n.error("Can't remove link from non existing object",t,e,r),n.error("Object:",t.data.type,t),n.error("Target:",r.data.type,r),n.error("Key:",e),[]):(o=t.schema.relationships[e],void 0===o?(n.error("Can't remove link not present in schema:",t,e,r,o),n.error("Object:",t.data.type,t),n.error("Target:",r.data.type,r),n.error("Key:",e),n.error("Schema:",o),[]):a===!0?(u(t,e,r,!1),[]):i(t,e,r))}function a(n,t,e){var r,a=n.schema.relationships[t].reflection;return a===!1?(c(n,t,e),[]):(r=e.schema.relationships[a],"hasOne"===r.type?h(d(n,t,e),d(e,a,n),o(e,a,n)):"hasMany"===r.type?(c(n,t,e),c(e,a,n),[d(e,a,n)]):void 0)}function o(n,t,e){var r,a,o=n.schema.relationships[t].reflection,i=n.relationships[t],d=[];return s(n,t,e),void 0!==i&&null!==i&&(a=i.schema.relationships[o],"hasOne"===a.type?l(i,o,n):"hasMany"===a.type&&u(i,o,n),d.push(i,o,n)),void 0!==e&&null!==e&&o!==!1&&(r=e.schema.relationships[o],"hasOne"===r.type?s(e,o,n):"hasMany"===r.type&&c(e,o,n),d.push(e,o,n)),d}function i(n,t,e){var r,a=n.schema.relationships[t],o=a.reflection;return"hasMany"===a.type?u(n,t,e):"hasOne"===a.type&&l(n,t,e),o===!1?[]:(r=e.schema.relationships[o],"hasOne"===r.type?l(e,o,n):"hasMany"===r.type&&u(e,o,n),[d(e,o,n)])}function s(e,r,a,o){return n.debug("addHasOne",e,r,a),e.relationships[r]=a,e.data.relationships[r].data=t(a),o!==!1&&e.reset(!0),!0}function c(e,r,a,o){var i=t(a);return n.debug("addHasMany",e,r,a),angular.isArray(e.relationships[r])&&e.relationships[r].indexOf(a)>-1?!1:(e.relationships[r]=e.relationships[r]||[],e.data.relationships[r].data=e.data.relationships[r].data||[],e.relationships[r].push(a),e.data.relationships[r].data.push(i),o!==!1&&e.reset(!0),!0)}function l(t,e,r,a){return n.debug("removeHasOne",t,e,r),void 0!==r&&t.relationships[e]!==r?!1:(t.relationships[e]=null,t.data.relationships[e].data=void 0,a!==!1&&t.reset(!0),!0)}function u(t,e,r,a){if(n.debug("removeHasMany",t,e,r),void 0!==t.relationships[e]){if(void 0===r)return t.relationships[e]=[],t.data.relationships[e].data=[],a!==!1&&t.reset(!0),!0;var o=t.relationships[e].indexOf(r);return-1===o?!1:(t.relationships[e].splice(o,1),t.data.relationships[e].data.splice(o,1),a!==!1&&t.reset(!0),!0)}}function d(n,t,e){return{object:n,key:t,target:e}}function h(n,t,e){var r=-1;return angular.forEach(e,function(t,e){t.object===n.object&&t.key===n.key&&t.target===n.target&&(r=e)}),r>-1?e[r]=t:e.push(t),e}var p=this;return p.toLinkData=t,p.link=e,p.unlink=r,this}angular.module("angular-jsonapi").service("AngularJsonAPIModelLinkerService",n),n.$inject=["$log"]}(),function(){"use strict";function n(n,t,e,r){function a(n){var t=this;t.data={id:n.data.id,type:n.data.type,attributes:{},relationships:{}},t.relationships={},t.parent=n,t.schema=n.schema,t.reset()}function o(){var n=this,t=angular.copy(n.data),e={};return angular.forEach(t.relationships,function(n,t){void 0!==n.data&&(e[t]=n)}),t.relationships=e,{data:t}}function i(){var n=this;return n.parent.save()}function s(n){var t=this;angular.forEach(t.schema.relationships,function(n,e){t.data.relationships[e]=angular.copy(t.parent.data.relationships[e])||{},t.relationships[e]=angular.isArray(t.relationships[e])?t.parent.relationships[e].slice():t.parent.relationships[e]}),(n!==!0||t.parent["synchronized"]!==!0)&&(angular.forEach(t.schema.attributes,function(n,e){t.data.attributes[e]=angular.copy(t.parent.data.attributes[e])}),t.parent.errors.validation.clear())}function c(t){function a(){void 0===t?c.parent.errors.validation.clear():c.parent.errors.validation.clear(t),l.resolve()}function o(e){c.parent.error=!0,void 0===t?c.parent.errors.validation.clear():c.parent.errors.validation.clear(t),angular.forEach(e,function(t,e){angular.forEach(t,function(t){c.parent.errors.validation.add(e,new n(t,e))})}),l.reject(c.parent.errors.validation)}var i,s,c=this,l=r.defer();return void 0===t?(i=c.data.attributes,s=c.schema.attributes):(i={},s={},i[t]=c.data.attributes[t],s[t]=c.schema.attributes[t]),e.async(i,s).then(a,o),l.promise}function l(n,e){var a=this;return r.resolve(t.link(a,n,e,!0))}function u(n,e){var a=this;return r.resolve(t.unlink(a,n,e,!0))}return a.prototype.save=i,a.prototype.reset=s,a.prototype.validate=c,a.prototype.link=l,a.prototype.unlink=u,a.prototype.toJson=o,a}angular.module("angular-jsonapi").factory("AngularJsonAPIModelForm",n),n.$inject=["AngularJsonAPIModelValidationError","AngularJsonAPIModelLinkerService","validateJS","$q"]}(),function(){"use strict";function n(n,o,i,s,c,l,u,d,h,p){function f(t,e,r){var a=this;t.relationships=t.relationships||{},a.saved=void 0===e.saved?!0:e.saved,a.stable=void 0===e.stable?!0:e.stable,a["synchronized"]=void 0===e["synchronized"]?!0:e["synchronized"],a.pristine=void 0===e.pristine?!0:e.pristine,a.removed=!1,a.loading=!1,a.saving=!1,a.updatedAt=a["synchronized"]===!0?Date.now():r,a.loadingCount=0,a.savingCount=0,a.data={relationships:{},attributes:{}},a.relationships={},angular.forEach(a.schema.relationships,function(n,t){a.relationships[t]=void 0}),a.errors={validation:new i("Validation","Errors of attributes validation",o),synchronization:new i("Synchronization","Errors of synchronizations",n)},a.promises={},P(a,t),a.form=new c(a)}function y(){function n(){i.synchronize(c).then(t,e,o)}function t(n){u.$emit("angularJsonAPI:"+i.data.type+":object:"+c.action,"resolved",i,n),i.update(i.form.data),i.saved===!1&&(i.factory.cache.indexIds=i.factory.cache.indexIds||[],i.factory.cache.indexIds.push(i.data.id)),i["synchronized"]=!0,i.saved=!0,i.stable=!0,n.finish(),i.errors.synchronization.concat(n.errors),s.resolve(i)}function e(n){u.$emit("angularJsonAPI:"+i.data.type+":object:save","rejected",i,n),n.finish(),i.errors.synchronization.concat(n.errors),s.reject(n)}function o(n){u.$emit("angularJsonAPI:"+i.data.type+":object:save","notify",i,n),s.notify(n)}var i=this,s=p.defer(),c={action:i.saved===!1?"add":"update",object:i};return i.form.validate().then(n,s.reject)["finally"](a.bind(i)),r(i),s.promise}function g(){var n=this;void 0!==n.form&&n.form.reset()}function v(){function r(n){function r(n){return t.bind(n),n.synchronize({action:"include",object:n})["finally"](e.bind(n))}function a(t){angular.forEach(t,function(n,t){n.success===!0&&(u.$emit("angularJsonAPI:"+o.included[t].data.type+":object:include","resolved",o.included[t],n),n.value.finish())}),s.resolve(n)}var o=i.proccesResults(n.data);u.$emit("angularJsonAPI:"+c.data.type+":object:refresh","resolved",c,n),p.allSettled(o.included.map(r)).then(a,s.reject),c["synchronized"]=!0,c.stable=!0,n.finish(),c.errors.synchronization.concat(n.errors)}function a(n){u.$emit("angularJsonAPI:"+c.data.type+":object:refresh","rejected",c,n),n.finish(),c.errors.synchronization.concat(n.errors),s.reject(n)}function o(n){u.$emit("angularJsonAPI:"+c.data.type+":object:refresh","notify",c,n),s.notify(n)}var i=d.get("$jsonapi"),s=p.defer(),c=this,l={action:"refresh",object:c,params:c.schema.params.get};if(c.saved===!1){var h=new n("Can't refresh new object",null,0,"refresh");c.errors.synchronization.add("refresh",h),s.reject(h)}else t(c),c.synchronize(l).then(r,a,o)["finally"](e.bind(c));return s.promise}function m(){var n=this,t=angular.copy(n.data),e={};return angular.forEach(t.relationships,function(n,t){void 0!==n.data&&(e[t]=n)}),t.relationships=e,{data:t,updatedAt:n.updatedAt}}function b(){function n(n){u.$emit("angularJsonAPI:"+o.data.type+":object:remove","resolved",o,n),o.removed=!0,o.unlinkAll(),o.factory.cache.clearRemoved(o.data.id),n.finish(),o.errors.synchronization.concat(n.errors),i.resolve(n)}function t(n){u.$emit("angularJsonAPI:"+o.data.type+":object:remove","rejected",o,n),o.factory.cache.revertRemove(o.data.id),n.finish(),o.errors.synchronization.concat(n.errors),i.reject(n)}function e(n){u.$emit("angularJsonAPI:"+o.data.type+":object:remove","notify",o,n),i.notify(n)}var o=this,i=p.defer(),s={action:"remove",object:o};return o.factory.cache.remove(o.data.id),o.saved===!1?i.resolve():(r.bind(o),o.synchronize(s).then(n,t,e)["finally"](a.bind(o))),i.promise}function j(n){function r(n,t){var e=o.schema.relationships[t],r=e.reflection;angular.isArray(n)?angular.forEach(n,a.bind(void 0,r)):angular.isObject(n)&&a(r,n),"hasOne"===e.type?o.relationships[t]=null:"hasMany"===e.type&&(o.relationships[t]=[])}function a(n,r){function a(n){u.$emit("angularJsonAPI:"+o.data.type+":object:unlinkReflection","resolve",o,n),n.finish(),o.errors.synchronization.concat(n.errors),i.resolve(o)}function c(n){u.$emit("angularJsonAPI:"+o.data.type+":object:unlinkReflection","rejected",o,n),n.finish(),o.errors.synchronization.concat(n.errors),i.reject(n)}function l(n){u.$emit("angularJsonAPI:"+o.data.type+":object:unlinkReflection","notify",o,n),n.finish(),i.notify(n)}var d=r.schema.relationships[n],h={action:"unlinkReflection",object:r,target:o,key:n};t(r),s.unlink(r,n,o,d),r.synchronize(h).then(a,c,l)["finally"](e.bind(r))}var o=this,i=p.defer();return t(o),void 0===n?angular.forEach(o.relationships,r):r(o.relationships[n],n),e(o),i.promise}function A(o,i){function c(n){function r(n){return t(i),i.synchronize({action:"linkReflection",object:n.object,target:n.target,key:n.key})["finally"](e.bind(i))}function a(n){angular.forEach(n,function(t){t.success===!0&&(u.$emit("angularJsonAPI:"+c[o].data.type+":object:linkReflection","resolved",c[o],t),n.value.finish())}),f.resolve(y)}u.$emit("angularJsonAPI:"+y.data.type+":object:link","resolved",y,n);var c=s.link(y,o,i);y.stable=!0,n.finish(),y.errors.synchronization.concat(n.errors),p.allSettled(c.map(r)).then(a,f.reject)}function l(n){u.$emit("angularJsonAPI:"+y.data.type+":object:link","rejected",y,n),f.reject(n.errors),n.finish(),y.errors.synchronization.concat(n.errors),f.reject(n)}function d(n){u.$emit("angularJsonAPI:"+y.data.type+":object:link","notify",y,n),f.notify(n)}var h,f=p.defer(),y=this,g={action:"link",object:y,target:i,key:o};return void 0===i?(h=new n("Can't link undefined",null,0,"link"),y.errors.synchronization.add("link",h),f.reject(h)):y.saved===!1?(h=new n("Can't link new object",null,0,"link"),y.errors.synchronization.add("link",h),f.reject(h)):(r(y),y.synchronize(g).then(c,l,d)["finally"](a.bind(y))),f.promise}function z(o,i){function c(n){function r(n){return t(i),i.synchronize({action:"unlinkReflection",object:n.object,target:n.target,key:n.key})["finally"](e.bind(i))}function a(n){angular.forEach(n,function(t){t.success===!0&&(u.$emit("angularJsonAPI:"+c[o].data.type+":object:unlinkReflection","resolved",c[o],t),n.value.finish())}),f.resolve(y)}u.$emit("angularJsonAPI:"+y.data.type+":object:unlink","resolved",y,n);var c=s.link(y,o,i);y.stable=!0,n.finish(),y.errors.synchronization.concat(n.errors),p.allSettled(c.map(r)).then(a,f.reject)}function l(n){u.$emit("angularJsonAPI:"+y.data.type+":object:unlink","rejected",y,n),f.reject(n.errors),n.finish(),y.errors.synchronization.concat(n.errors),f.reject(n)}function d(n){u.$emit("angularJsonAPI:"+y.data.type+":object:unlink","notify",y,n),f.notify(n)}var h,f=p.defer(),y=this,g={action:"unlink",object:y,target:i,key:o};return void 0===i?(h=new n("Can't unlink undefined",null,0,"link"),y.errors.synchronization.add("link",h),f.reject(h)):y.saved===!1?(h=new n("Can't unlink new object",null,0,"link"),y.errors.synchronization.add("link",h),f.reject(h)):(r(y),y.synchronize(g).then(c,l,d)["finally"](a.bind(y))),f.promise}function k(n,r,a){var o=this;t(o),P(o,n),o.reset(r),o["synchronized"]=a===!0?!1:!0,o.stable=a===!0?!1:!0,o.updatedAt=Date.now(),e(o)}function I(){var n=this,t=!1;return angular.forEach(n.errors,function(n){t=n.hasErrors()||t}),t}function P(n,t){function e(e,r){n.data.attributes[r]=t.attributes[r]}function r(e,r){var i=t.relationships[r];return void 0===i?void(n.data.relationships[r]={data:void 0}):(n.data.relationships[r]=n.data.relationships[r]||{},n.data.relationships[r].links=i.links,void("hasOne"===e.type?a(n,r,i.data):"hasMany"===e.type&&angular.isArray(i.data)&&(0===i.data.length?(n.data.relationships[r].data=[],n.unlinkAll(r)):(angular.forEach(n.relationships[r],o.bind(void 0,n,r,i.data)),angular.forEach(i.data,a.bind(void 0,n,r))))))}function a(n,t,e){var r;if(null===e)return void s.link(n,t,null);if(void 0!==e){if(r=i.getFactory(e.type),void 0===r)return void h.error("Factory not found",e.type,e);var a=r.cache.get(e.id);s.link(n,t,a)}}function o(n,t,e,r){e.indexOf(r.data.id)>-1||s.unlink(n,t,r)}var i=d.get("$jsonapi"),c=n.schema;return n.data.id=t.id,n.data.type=t.type,n.factory.schema.type!==t.type?(h.error("Different type then factory",n.factory.schema.type,t),!1):l.validate(n.data.id)?(t.attributes=t.attributes||{},t.relationships=t.relationships||{},angular.forEach(c.attributes,e),angular.forEach(c.relationships,r),!0):(h.error("Invalid id"),!1)}return f.prototype.refresh=v,f.prototype.remove=b,f.prototype.reset=g,f.prototype.save=y,f.prototype.update=k,f.prototype.link=A,f.prototype.unlink=z,f.prototype.unlinkAll=j,f.prototype.toJson=m,f.prototype.hasErrors=I,f}function t(n){n=void 0===n?this:n,n.loadingCount+=1,n.loading=!0}function e(n){n=void 0===n?this:n,n.loadingCount-=1,n.loading=n.loadingCount>0}function r(n){n=void 0===n?this:n,n.savingCount+=1,n.saving=!0}function a(n){n=void 0===n?this:n,n.savingCount-=1,n.saving=n.savingCount>0}angular.module("angular-jsonapi").factory("AngularJsonAPIAbstractModel",n),n.$inject=["AngularJsonAPIModelSynchronizationError","AngularJsonAPIModelValidationError","AngularJsonAPIModelErrorsManager","AngularJsonAPIModelLinkerService","AngularJsonAPIModelForm","uuid4","$rootScope","$injector","$log","$q"]}(),function(){"use strict";function n(n,t){function e(n){var t=this;t.factory=n,t.data={},t.removed={},t.size=0,t.indexIds=void 0}function r(n,e){var r=this,a=n.id;return void 0===a?void t.error("Can't add data without id!",n):(void 0===r.data[a]?(r.data[a]=new r.factory.Model(n,e),r.size+=1):r.data[a].update(n,e.saved,e.initialization),r.data[a])}function a(n){var t=this,e=angular.fromJson(n),r={saved:!0,"synchronized":!1,stable:!1,pristine:!1,initialization:!0};angular.isObject(e)&&void 0!==e.data&&(t.updatedAt=e.updatedAt,t.indexIds=e.indexIds,angular.forEach(e.data,function(n){var e=n.data;t.addOrUpdate(e,r,n.updatedAt)}))}function o(){var n=this,t={data:[],updatedAt:n.updatedAt,indexIds:n.indexIds};return angular.forEach(n.data,function(n){n.error===!1&&t.data.push(n.toJson())}),angular.toJson(t)}function i(){var n=this;n.indexIds=void 0,n.data={},n.removed={}}function s(n){var t=this,e={id:n,type:t.factory.Model.prototype.schema.type},r={saved:!0,"synchronized":!1,stable:!1,pristine:!0};return void 0===t.data[n]&&(t.data[n]=new t.factory.Model(e,r)),t.data[n]}function c(n){var e=this;return t.debug("Unused params",n),void 0===e.indexIds?e.indexIds:e.indexIds.map(e.get.bind(e))}function l(t){var e=this;e.indexIds=[],angular.forEach(t,function(t){angular.isString(t)&&n.validate(t)?e.indexIds.push(t):angular.isObject(t)&&n.validate(t.data.id)&&e.indexIds.push(t.data.id)})}function u(n){var t=this;return void 0!==t.data[n]&&(t.removed[n]=t.data[n],delete t.data[n],t.size-=1),t.removed[n]}function d(n){var t=this;return void 0!==t.removed[n]&&(t.data[n]=t.removed[n],delete t.removed[n],t.size+=1),t.data[n]}function h(n){var t=this;delete t.removed[n]}return e.prototype.get=s,e.prototype.index=c,e.prototype.setIndexIds=l,e.prototype.addOrUpdate=r,e.prototype.fromJson=a,e.prototype.toJson=o,e.prototype.clear=i,e.prototype.remove=u,e.prototype.revertRemove=d,e.prototype.clearRemoved=h,e}angular.module("angular-jsonapi").factory("AngularJsonAPICache",n),n.$inject=["uuid4","$log"]}(),function(){"use strict";function n(){function n(n,t){var e=this;Error.captureStackTrace(e,e.constructor),e.message=n,e.context={attribute:t}}return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n.prototype.name="ValidationError",n}angular.module("angular-jsonapi").factory("AngularJsonAPIModelValidationError",n)}(),function(){"use strict";function n(){function n(n,t,e,r){var a=this;Error.captureStackTrace(a,a.constructor),a.message=n,a.context={synchronization:t,code:e,action:r}}return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n.prototype.name="SynchronizationError",n}angular.module("angular-jsonapi").factory("AngularJsonAPIModelSynchronizationError",n)}(),function(){"use strict";function n(){function n(n,t,e,r){var a=this;a.name=n,a.description=t,a.ErrorConstructor=e,a.errors={},a.defaultFilter=r||function(){return!0}}function t(n){var t=this;void 0===n?angular.forEach(t.errors,function(n,e){t.errors[e]=[]}):t.errors[n]=[]}function e(n,t){var e=this;e.errors[n]=e.errors[n]||[],e.errors[n].push(t)}function r(n){var t=this;angular.forEach(n,function(n){t.errors[n.key]=[]}),angular.forEach(n,function(n){t.errors[n.key].push(n.object)})}function a(n){var t=this;if(void 0===n){var e=!1;return angular.forEach(t.errors,function(n){e=e||n.length>0}),e}return void 0!==t.errors[n]&&t.errors[n].length>0}return n.prototype.constructor=n,n.prototype.concat=r,n.prototype.clear=t,n.prototype.add=e,n.prototype.hasErrors=a,n}angular.module("angular-jsonapi").factory("AngularJsonAPIModelErrorsManager",n)}(),function(){"use strict";angular.module("angular-jsonapi").constant("lazyProperty",function(n,t,e){var r,a;Object.defineProperty(n,t,{get:function(){return a||(a=!0,r=e.call(n)),r},enumerable:!0,configurable:!0})})}(),function(){"use strict";angular.module("angular-jsonapi").constant("toKebabCase",function(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()})}(),function(){"use strict";angular.module("angular-jsonapi").config(["$provide",function(n){n.decorator("$q",["$delegate",function(n){var t=n;return t.allSettled=t.allSettled||function(n,e,r){function a(n){return t.resolve(n).then(function(n){return angular.isFunction(e)&&e(n),{success:!0,value:n}},function(n){return angular.isFunction(r)&&r(n),{success:!1,reason:n}})}var o=angular.isArray(n)?[]:{};return angular.forEach(n,function(n,t){o.hasOwnProperty(t)||(o[t]=a(n))}),t.all(o)},t}])}])}(),function(){"use strict";function n(n,t,e){function r(t){var e=this;e.state={},n.call(e,t),angular.forEach(t,function(n){n.synchronizer=e})}function a(r){function a(n){d.notify({step:"synchronization",data:n})}function o(n){d.notify({step:"synchronization",errors:n})}function i(n){l.state[h]=l.state[h]||{},l.state[h].success=!0,angular.forEach(n,function(n){n.success===!1&&(l.state[h].success=!1)}),angular.forEach(l.synchronizations,function(t){angular.forEach(t.afterHooks[h],function(t){d.notify({step:"after",errors:t.call(l,r,n)})})});var t,e=[];angular.forEach(n,function(n){n.success===!0?t=n.value:e.push({key:h,object:n.reason})}),e.length>0?d.reject({data:t,finish:s,errors:e}):d.resolve({data:t,finish:s,errors:e})}function s(){angular.forEach(l.synchronizations,function(n){angular.forEach(n.finishHooks[h],function(n){d.notify({step:"finish",errors:n.call(l,r)})})})}function c(n){e.error("All settled rejected! Something went wrong"),d.reject({finish:angular.noop,errors:n})}var l=this,u=[],d=t.defer(),h=r.action;return n.prototype.synchronize.call(l,r),angular.forEach(l.synchronizations,function(n){angular.forEach(n.beginHooks[h],function(n){d.notify({step:"begin",data:n.call(l,r)})})}),angular.forEach(l.synchronizations,function(n){angular.forEach(n.beforeHooks[h],function(n){d.notify({step:"before",data:n.call(l,r)})})}),angular.forEach(l.synchronizations,function(n){angular.forEach(n.synchronizationHooks[h],function(n){u.push(n.call(l,r))})}),t.allSettled(u,a,o).then(i,c),d.promise}return r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.synchronize=a,r}angular.module("angular-jsonapi").factory("AngularJsonAPISynchronizerSimple",n),n.$inject=["AngularJsonAPISynchronizerPrototype","$q","$log"]}(),function(){"use strict";function n(n){function t(n){var t=this;t.synchronizations=n}function e(t){var e=this;n.debug("Synchro Collection",e.factory.Model.prototype.schema.type,t),void 0===t.action&&n.error("Can't synchronize undefined action",t)}return t.prototype.synchronize=e,t}angular.module("angular-jsonapi").factory("AngularJsonAPISynchronizerPrototype",n),n.$inject=["$log"]}(),function(){"use strict";function n(n,t,e,r,a,o){function i(r,i){function s(n){return o({method:"GET",headers:v,url:i,params:n.params||{}}).then(f,y.bind(null,"all"))}function c(n){return o({method:"GET",headers:v,url:i+"/"+n.object.data.id,params:n.params||{}}).then(f,y.bind(null,"get"))}function l(n){return o({method:"DELETE",headers:v,url:i+"/"+n.object.data.id}).then(f,y.bind(null,"remove"))}function u(t){var e=a.defer(),r=t.object.schema.relationships[t.key];return t.object.removed===!0?e.reject(new n("Object has been removed",g,0,"unlink")):void 0!==t.target&&void 0===t.target.data.id?e.reject(new n("Can't unlink object without id through rest call",g,0,"unlink")):"hasOne"===r.type?o({method:"DELETE",headers:v,url:i+"/"+t.object.data.id+"/relationships/"+t.key}).then(f,y.bind(null,"get")).then(e.resolve,e.reject):"hasMany"===r.type&&(void 0===t.target?o({method:"PUT",headers:v,data:{data:[]},url:i+"/"+t.object.data.id+"/relationships/"+t.key}).then(f,y.bind(null,"unlink")).then(e.resolve,e.reject):o({method:"DELETE",headers:v,url:i+"/"+t.object.data.id+"/relationships/"+t.key+"/"+t.target.data.id}).then(f,y.bind(null,"unlink")).then(e.resolve,e.reject)),e.promise}function d(n){var t=a.defer(),r=n.object.schema.relationships[n.key];return n.object.removed===!0?t.reject({errors:[{status:0,statusText:"Object has been removed"}]}):void 0===n.target||void 0===n.target.data.id?t.reject({errors:[{status:0,statusText:"Can't link object without id through rest call"}]}):"hasOne"===r.type?o({method:"PUT",headers:v,data:{data:e.toLinkData(n.target)},url:i+"/"+n.object.data.id+"/relationships/"+n.key}).then(f,y.bind(null,"link")).then(t.resolve,t.reject):"hasMany"===r.type&&o({method:"POST",headers:v,data:{data:[e.toLinkData(n.target)]},url:i+"/"+n.object.data.id+"/relationships/"+n.key}).then(f,y.bind(null,"link")).then(t.resolve,t.reject),t.promise}function h(n){return o({method:"PUT",headers:v,url:i+"/"+n.object.data.id,data:n.object.form.toJson()}).then(f,y.bind(null,"update"))}function p(n){return o({method:"POST",headers:v,url:i+"/",data:n.object.form.toJson()}).then(f,y.bind(null,"add"))}function f(n){return a.resolve(n.data)}function y(t,e){function r(e){console.log("offline"),console.log(e),s.reject(new n("Server is offline",g,e.status,t))}function i(){console.log("no internet"),s.reject(new n("No internet connection",g,e.status,t))}var s=a.defer();return 0===e.status?o({method:"GET",url:"https://status.cloud.google.com/incidents.schema.json"}).then(r,i):s.reject(new n(e.statusText,g,e.status,t)),s.promise}var g=this,v={Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"};t.apply(g,arguments),g.synchronization("remove",l),g.synchronization("unlink",u),g.synchronization("link",d),g.synchronization("update",h),g.synchronization("add",p),g.synchronization("all",s),g.synchronization("get",c),g.synchronization("refresh",c)}return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i}angular.module("angular-jsonapi-rest",["angular-jsonapi"]).factory("AngularJsonAPISynchronizationRest",n),n.$inject=["AngularJsonAPIModelSynchronizationError","AngularJsonAPISynchronizationPrototype","AngularJsonAPIModelLinkerService","toKebabCase","$q","$http"]}(),function(){"use strict";function n(){function n(n){var t=this,e=["add","init","get","all","clearCache","remove","unlink","unlinkReflection","link","linkReflection","update","refresh","include"];t.name=n,t.state={},t.beginHooks={},t.beforeHooks={},t.synchronizationHooks={},t.afterHooks={},t.finishHooks={},t.options={},angular.forEach(e,function(n){t.beginHooks[n]=[],t.beforeHooks[n]=[],t.synchronizationHooks[n]=[],t.afterHooks[n]=[],t.finishHooks[n]=[],t.state[n]={loading:!1,success:!0}})}function t(n,t){var e=this;e.beginHooks[n].push(t)}function e(n,t){var e=this;e.finishHooks[n].push(t)}function r(n,t){var e=this;e.beforeHooks[n].push(t)}function a(n,t){var e=this;e.afterHooks[n].push(t)}function o(n,t){var e=this;e.synchronizationHooks[n].push(t)}return n.prototype.before=r,n.prototype.after=a,n.prototype.begin=t,n.prototype.finish=e,n.prototype.synchronization=o,n}angular.module("angular-jsonapi").factory("AngularJsonAPISynchronizationPrototype",n)}(),function(){"use strict";function n(n,t,e){function r(r,a){function o(){var n=c.synchronizer.factory.schema.type;return e.resolve(t.localStorage.getItem(a+"."+n))}function i(){var n=c.synchronizer.factory.schema.type;t.localStorage.removeItem(a+"."+n)}function s(){var n=c.synchronizer.factory.schema.type,e=c.synchronizer.factory.cache;t.localStorage.setItem(a+"."+n,e.toJson())}var c=this;a=a||"AngularJsonAPI",c.__updateStorage=s,n.apply(c,arguments),c.synchronization("init",o),c.begin("clearCache",i),c.begin("remove",s),c.begin("refresh",s),c.begin("unlink",s),c.begin("unlinkReflection",s),c.begin("link",s),c.begin("linkReflection",s),c.begin("update",s),c.begin("add",s),c.begin("get",s),c.begin("all",s),c.begin("include",s),c.finish("init",s),c.finish("clearCache",s),c.finish("remove",s),c.finish("refresh",s),c.finish("unlink",s),c.finish("unlinkReflection",s),c.finish("link",s),c.finish("linkReflection",s),c.finish("update",s),c.finish("add",s),c.finish("get",s),c.finish("all",s),c.finish("include",s)}return r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r}angular.module("angular-jsonapi-local",["angular-jsonapi"]).factory("AngularJsonAPISynchronizationLocal",n),n.$inject=["AngularJsonAPISynchronizationPrototype","$window","$q"]}(),function(){"use strict";function n(n,t,e){function r(n){var t=this,r=n.include||{};n.include=r,r.get=n.include.get||[],r.all=n.include.all||[],t.params={get:{},all:{}},angular.forEach(n.relationships,function(t,a){var o=new e(t,a,n.type);n.relationships[a]=o,o.included===!0&&(r.get.push(a),"hasOne"===o.type&&r.all.push(a))}),angular.extend(t,n),r.get.length>0&&(t.params.get.include=r.get.join(",")),r.all.length>0&&(t.params.all.include=r.all.join(","))}return r}angular.module("angular-jsonapi").factory("AngularJsonAPISchema",n),n.$inject=["$log","pluralize","AngularJsonAPISchemaLink"]}(),function(){"use strict";function n(n,t){function e(e,r,a){var o=this;angular.isString(e)?(o.model=t.plural(r),o.type=e,o.polymorphic=!1,o.reflection=a):(void 0===e.type&&n.error("Schema of link without a type: ",e,r),"hasMany"!==e.type&&"hasOne"!==e.type&&n.error("Schema of link with wrong type: ",e.type,"available: hasOne, hasMany"),o.model=e.model||t.plural(r),o.type=e.type,o.polymorphic=e.polymorphic||!1,o.reflection=void 0===e.reflection?"hasMany"===o.type?t.singular(a):a:e.reflection,o.included=e.included||!1)}return e}angular.module("angular-jsonapi").factory("AngularJsonAPISchemaLink",n),n.$inject=["$log","pluralize"]}(),function(){"use strict";function n(n,t,e){function r(t,r){var a=function(t,r,a){var o=this;t.type!==o.schema.type&&e.error("Data type other then declared in schema: ",t.type," instead of ",o.schema.type),n.call(o,t,r,a),o.form.parent=o};return a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.schema=t,a.prototype.factory=r,a.prototype.synchronize=r.synchronizer.synchronize.bind(r.synchronizer),angular.forEach(t.functions,function(n,t){a.prototype[t]=function(){return n.apply(this,arguments)}}),a}return{model:r}}angular.module("angular-jsonapi").factory("AngularJsonAPIModel",n),n.$inject=["AngularJsonAPIAbstractModel","AngularJsonAPISchema","$log"]}(),function(){"use strict";function n(n,t,e,r,a,o,i,s){function c(r,a){function i(n){o.$emit("angularJsonAPI:"+l.type+":factory:init","resolved",n),l.cache.fromJson(n.data),l.initialized=!0,n.finish()}function s(n){o.$emit("angularJsonAPI:"+l.type+":factory:init","rejected",n),n.finish(),l.initialized=!0}function c(n){o.$emit("angularJsonAPI:"+l.type+":factory:init","notify",n)}var l=this,u={action:"init"};l.schema=new t(r),l.cache=new e(l),l.synchronizer=a,l.synchronizer.factory=l,l.Model=n.model(l.schema,l),l.initialized=!1,l.type=l.schema.type,a.factory=l,l.synchronizer.synchronize(u).then(i,s,c)}function l(n){var t=this;if(!a.validate(n))return s.reject({errors:[{status:0,statusText:"Invalid id not uuid4"}]});var e=t.cache.get(n);return e.refresh(),e}function u(n){var t=this;n=n||{};var e=new r(t,angular.extend(n,t.schema.params.all));return e.fetch(),e}function d(n){var t=this,e=t.cache.remove(n);return e.remove()}function h(n,t){var e=this,r={};if(angular.forEach(e.schema.relationships,function(n,t){"hasOne"===n.type?r[t]={data:null}:"hasMany"===n.type&&(r[t]={data:[]})}),void 0!==n&&void 0!==t){var s=e.schema[n];"hasOne"===s.type?r[n]={data:t.data.id}:"hasMany"===s.type&&i.warn("Initialize with relationship disallowed for hasMany relationships")}var c={type:e.type,id:a.generate(),attributes:{},relationships:r},l={saved:!1,"synchronized":!1,stable:!1,pristine:!1,initialization:!1},u=e.cache.addOrUpdate(c,l);return o.$emit("angularJsonAPI:"+e.type+":factory:initialize","resolved",u),u}function p(){function n(n){o.$emit("angularJsonAPI:"+r.type+":factory:clearCache","resolved",n),n.finish(),a.resolve(n)}function t(n){o.$emit("angularJsonAPI:"+r.type+":factory:clearCache","resolved",n),n.finish(),a.reject(n)}function e(n){o.$emit("angularJsonAPI:"+r.type+":factory:clearCache","notify",n),a.notify(n)}var r=this,a=s.defer(),i={action:"clearCache"};return r.cache.clear(),r.synchronizer.synchronize(i).then(n,t,e),a}return c.prototype.get=l,c.prototype.all=u,c.prototype.remove=d,c.prototype.initialize=h,c.prototype.clearCache=p,c}angular.module("angular-jsonapi").factory("AngularJsonAPIFactory",n),n.$inject=["AngularJsonAPIModel","AngularJsonAPISchema","AngularJsonAPICache","AngularJsonAPICollection","uuid4","$rootScope","$log","$q"]}(),function(){"use strict";function n(n,r,a,o,i){function s(t,e){function o(n,t,e){var r;"resolved"===t&&void 0!==c.data&&(r=c.data.indexOf(e),r>-1&&(c.data.splice(r,1),c.factory.cache.setIndexIds(c.data)))}function i(){c.data=void 0,c.pristine=!0}function s(n,t,e){"resolved"===t&&(c.data=c.data||[],c.data.push(e))}var c=this;c.factory=t,c.type=t.schema.type,c.params=e,c.errors={synchronization:new r("Synchronization","Errors of synchronizations",n)},c.data=c.factory.cache.index(c.params),c.loading=!1,c.loadingCount=0,c["synchronized"]=!1,c.pristine=void 0===c.data,a.$on("angularJsonAPI:"+c.type+":object:remove",o),a.$on("angularJsonAPI:"+c.type+":factory:clearCache",i),a.$on("angularJsonAPI:"+c.type+":object:add",s)}function c(){var n=this,t=!1;return angular.forEach(n.errors,function(n){t=n.hasErrors()||t}),t}function l(n){var t=this;return t.factory.get(n)}function u(){function n(n){function r(n){return t.bind(n),n.synchronize({action:"include",object:n})["finally"](e.bind(n))}function o(t){angular.forEach(t,function(n,t){
n.success===!0&&(a.$emit("angularJsonAPI:"+s.included[t].data.type+":object:include","resolved",s.included[t],n),n.value.finish())}),l.resolve(n)}var s=u.proccesResults(n.data);a.$emit("angularJsonAPI:"+c.type+":collection:fetch","resolved",c,n),i.allSettled(s.included.map(r)).then(o,l.reject),angular.forEach(c.data,e),c.data=s.data,c.updatedAt=Date.now(),c["synchronized"]=!0,c.factory.cache.setIndexIds(c.data),n.finish(),c.errors.synchronization.concat(n.errors),l.resolve(c)}function r(n){a.$emit("angularJsonAPI:"+c.type+":collection:fetch","rejected",c,n),console.log(n),angular.forEach(c.data,e),n.finish(),c.errors.synchronization.concat(n.errors),l.reject(n)}function s(n){a.$emit("angularJsonAPI:"+c.type+":collection:fetch","notify",c,n),l.notify(n)}var c=this,l=i.defer(),u=o.get("$jsonapi"),d={action:"all",params:c.params};return t(this),angular.forEach(c.data,t),c.factory.synchronizer.synchronize(d).then(n,r,s)["finally"](e.bind(c)),l.promise}return s.prototype.fetch=u,s.prototype.refresh=u,s.prototype.get=l,s.prototype.hasErrors=c,s}function t(n){n=void 0===n?this:n,n.loadingCount+=1,n.loading=!0}function e(n){n=void 0===n?this:n,n.loadingCount-=1,n.loading=n.loadingCount>0}angular.module("angular-jsonapi").factory("AngularJsonAPICollection",n),n.$inject=["AngularJsonAPIModelSynchronizationError","AngularJsonAPIModelErrorsManager","$rootScope","$injector","$q"]}(),function(){"use strict";function n(){function n(n,r){function a(){return t}function o(){return e}function i(n,a){var o=new r(n,a);t[n.type]=o,e.push(n.type)}function s(n){return t[n]}function c(e){return void 0===t[e]&&n.error("Can	 add not existing object type: "+e+". Use initialize(Model, datas)."),t[e].saved.form}function l(e,r){return void 0===t[e]&&n.error("Can	 get not existing object type: "+e+". Use initialize(Model, datas)."),t[e].get(r)}function u(e,r){return void 0===t[e]&&n.error("Can	 remove not existing object type: "+e+". Use initialize(Model, datas)."),t[e].remove(r)}function d(e){return void 0===t[e]&&n.error("Can	 get all of not existing object type: "+e+". Use initialize(Model, datas)."),t[e].all()}function h(){angular.forEach(t,function(n){n.clearCache()})}function p(t){var e={data:[],included:[]};void 0===t&&n.error("Can't proccess results:",t);var r={saved:!0,"synchronized":!0,stable:!0,pristine:!1,initialization:!1};return angular.forEach(t.included,function(n){e.included.push(s(n.type).cache.addOrUpdate(n,r))}),angular.isArray(t.data)?angular.forEach(t.data,function(n){e.data.push(s(n.type).cache.addOrUpdate(n,r))}):e.data.push(s(t.data.type).cache.addOrUpdate(t.data,r)),e}return{form:c,get:l,remove:u,all:d,addFactory:i,getFactory:s,clearCache:h,proccesResults:p,allFactories:a,factoriesNames:o}}var t={},e=[];this.$get=n,n.$inject=["$log","AngularJsonAPIFactory"]}angular.module("angular-jsonapi").provider("$jsonapi",n)}(),function(){"use strict";angular.module("angular-jsonapi").config(["$logProvider",function(n){n.debugEnabled(!1)}]).run(["validateJS","$q",function(n,t){n.Promise=t}])}();
//# sourceMappingURL=angular-jsonapi.min.js.map