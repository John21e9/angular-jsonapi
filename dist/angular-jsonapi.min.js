!function(){"use strict";angular.module("angular-jsonapi",["uuid4"]).constant("pluralize",pluralize)}(),function(){"use strict";function n(){function n(n,t){return{}}function t(n,t){return[]}var e=this;return e.validateForm=n,e.validateField=t,this}angular.module("angular-jsonapi").service("AngularJsonAPIModelValidatorService",n)}(),function(){"use strict";function n(n){function t(n){return null===n?null:{type:n.data.type,id:n.data.id}}function e(t,e,r,i){return void 0===r?(n.error("Can't link non existing object",t,e,r,i),!1):void 0===t?(n.error("Can't add link to non existing object",t,e,r,i),!1):void 0===i?(n.error("Can't add link not present in schema: ",t,e,r,i),!1):null!==r&&i.polymorphic===!1&&i.model!==r.data.type?(n.error("This relation is not polymorphic, expected: "+i.model+" instead of "+r.data.type),!1):"hasMany"===i.type?a(t,e,r,i):"hasOne"===i.type?o(t,e,r,i):void 0}function r(t,e,r,o){return void 0===o?void n.error("Can't remove link not present in schema: "+e):"hasMany"===o.type?s(c,e,t,o):"hasOne"===o.type?i(c,e,t,o):void 0}function o(e,r,o,a){return n.log("addHasOne",e),e.relationships[r]===o?(n.warn(e,"is already linked to",o),!1):(e.relationships[r]=o,e.data.relationships[r].data=t(o),!0)}function a(e,r,o,a){return n.log("addHasMany",e,r,o,a),e.relationships[r].indexOf(o)>-1?(n.warn(e,"is already linked to",o),!1):(e.relationships[r].push(o),e.data.relationships[r].data.push(t(o)),!0)}function i(t,e,r,o){return n.log("removeHasOne",t,e,r,o),void 0!==r&&t.relationships[e]!==r?(n.warn(t,"is not linked to",r),!1):(t.relationships[e]=null,t.data.relationships[e].data=void 0,!0)}function s(t,e,r,o){if(n.log("removeHasMany",t,e,r,o),void 0===r)t.relationships[e]=[],t.data.relationships[e].data=[];else{var a=t.relationships[e].indexOf(r);if(-1===a)return n.warn(t,"is not linked to",r),!1;t.relationships[e].splice(a,1),t.data.relationships[e].data.splice(a,1)}return!0}var c=this;return c.toLinkData=t,c.link=e,c.unlink=r,this}angular.module("angular-jsonapi").service("AngularJsonAPIModelLinkerService",n),n.$inject=["$log"]}(),function(){"use strict";function n(n,t){function e(n){var t=this;t.data={attributes:{},relationships:{}},t.relationships={},t.parent=n,t.schema=n.schema,t.reset()}function r(){var n=this,t=angular.copy(n.data),e={};return angular.forEach(t.relationships,function(n,t){void 0!==n.data&&(e[t]=n)}),t.relationships=e,{data:t}}function o(){var n=this;return n.parent.save()}function a(){var n=this;angular.forEach(n.schema.attributes,function(t,e){n.data.attributes[e]=n.parent.data.attributes[e]||""}),angular.forEach(n.schema.relationships,function(t,e){n.data.relationships[e]=n.parent.data.relationships[e]||{},n.relationships[e]=n.parent.relationships[e]}),n.errors={validation:{}}}function i(){var t,e=this;return t=n.validateForm(e.data),e.errors.validation=t,t}function s(t){var e,r=this;return e=n.validateField(r.data[t],t),r.errors.validation[t]=e,e}function c(n,e){var r=this,o=r.schema.relationships[n];return t.link(r,n,e,o)}function u(n,e){var r=this,o=r.schema.relationships[n];return t.unlink(r,n,e,o)}return e.prototype.save=o,e.prototype.reset=a,e.prototype.validate=i,e.prototype.validateField=s,e.prototype.link=c,e.prototype.unlink=u,e.prototype.toJson=r,e}angular.module("angular-jsonapi").factory("AngularJsonAPIModelForm",n),n.$inject=["AngularJsonAPIModelValidatorService","AngularJsonAPIModelLinkerService"]}(),function(){"use strict";function n(n,t,e,r,o,a){function i(t,e){var r=this;t.relationships=t.relationships||{},r.isNew=e||!1,r.removed=!1,r.loadingCount=0,r.data={relationships:{},attributes:{}},r.relationships={},r.errors={validation:{}},r.promises={},g(r,t,!0),r.form=new n(r)}function s(){function n(n){return g(e,e.form.data),n.finish(),e}function t(){return response.finish(),response.errors}var e=this,r=a.defer(),o=!1,i={action:"update",object:e};e.isNew===!0&&(i.action="add");var s=e.form.validate();for(var c in s)s.hasOwnProperty(c)&&(o=!0);return o===!0?(r.reject(s),r.promise):(e.synchronize(i).then(n,t),r.promise)}function c(){var n=this;return n.form.reset()}function u(){function n(n){return r.update(n.data),n.finish(),r}function t(n){return n.finish(),n.errors}var e=a.defer(),r=this,i={action:"refresh",object:r,params:r.schema.params.get};return r.isNew===!0?(o.error("Can't refresh new object"),e.reject("Can't refresh new object")):r.synchronize(i).then(n,t),e.promise}function l(){var n=this,t=angular.copy(n.data),e={};return angular.forEach(t.relationships,function(n,t){void 0!==n.data&&(e[t]=n)}),t.relationships=e,{data:t}}function h(){var n=this;return n.parentFactory.remove(n.data.id)}function d(){var n=this;angular.forEach(n.relationships,function(e,r){t.unlink(n,r,void 0,n.schema.relationships[r])})}function p(n,e){function r(n){return s.resolve(c),n.finish(),n.data}function o(r){return t.unlink(c,n,e,u),t.unlink(e,l,c,h),s.reject(r.errors),r.finish(),r.errors}var i,s=a.defer(),c=this,u=c.schema.relationships[n],l=u.reflection,h=e.schema.relationships[l];return t.link(c,n,e,u)&&t.link(e,l,c,h)?(i=a.all(c.synchronize({action:"link",object:c,target:e,key:n}),c.synchronize({action:"linkReflection",object:c,target:e,key:n})),i.then(r,o),s.promise):(s.reject(),s.promise)}function f(n,e){function r(n){return s.resolve(c),n.finish(),n.data}function o(r){return t.unlink(c,n,e,u),t.unlink(e,l,c,h),s.reject(r.errors),r.finish(),r.errors}var i,s=a.defer(),c=this,u=c.schema.relationships[n],l=u.reflection,h=e.schema.relationships[l];return t.unlink(c,n,e,u)&&t.unlink(e,l,c,h)?(i=a.all(c.synchronize({action:"unlink",object:c,target:e,key:n}),c.synchronize({action:"unlinkReflection",object:c,target:e,key:n})),i.then(r,o),s.promise):(s.reject(),s.promise)}function y(n){var t=this;return g(t,n)}function g(n,a,i){function s(t,e){n.data.attributes[e]=a.attributes[e]}function c(t,e){void 0===a.relationships[e]?"hasOne"===t.type?n.data.relationships[e]={data:void 0}:"hasMany"===t.type&&(n.data.relationships[e]={data:[]}):(n.data.relationships[e]=a.relationships[e],"hasOne"===t.type?u(n,e,t,n.data.relationships[e].data):"hasMany"===t.type&&angular.forEach(n.data.relationships[e].data,u.bind(void 0,n,e,t)))}function u(n,e,r,o){if(null===o)return void t.link(n,e,null,r);if(void 0!==o){var a=l.getFactory(o.type),s=a.cache.get(o.id),c=r.reflection,u=s.schema.relationships[c];t.link(n,e,s,r),i!==!0&&c!==!1&&t.link(n,c,s,u)}}var l=r.get("$jsonapi"),h=n.schema;return n.data.id=a.id,n.data.type=a.type,n.parentFactory.schema.type!==a.type?(o.error("Different type then factory"),!1):e.validate(n.data.id)?(a.attributes=a.attributes||{},a.relationships=a.relationships||{},angular.forEach(h.attributes,s),angular.forEach(h.relationships,c),!0):(o.error("Invalid id"),!1)}return i.prototype.refresh=u,i.prototype.remove=h,i.prototype.reset=c,i.prototype.save=s,i.prototype.update=y,i.prototype.link=p,i.prototype.unlink=f,i.prototype.unlinkAll=d,i.prototype.toJson=l,i}angular.module("angular-jsonapi").factory("AngularJsonAPIAbstractModel",n),n.$inject=["AngularJsonAPIModelForm","AngularJsonAPIModelLinkerService","uuid4","$injector","$log","$q"]}(),function(){"use strict";function n(n){function t(n){var t=this;t.factory=n,t.data={},t.removed={},t.size=0}function e(t){var e=this,r=t.id;return void 0===r?void n.error("Can't add data without id!",t):(void 0===e.data[r]?(e.data[r]=new e.factory.Model(t),e.size+=1):e.data[r].update(t),e.data[r])}function r(n){var t=this,e=angular.fromJson(n);null!==e&&void 0!==e.data&&(t.updatedAt=e.updatedAt,angular.forEach(e.data,function(n){var e=n.data;t.addOrUpdate(e,n.updatedAt)}))}function o(){var n=this,t={data:{},updatedAt:n.updatedAt};return angular.forEach(n.data,function(n,e){t.data[e]=n.toJson()}),angular.toJson(t)}function a(){var n=this;n.data={},n.removed={}}function i(n){var t=this;return void 0===t.data[n]&&(t.data[n]=new t.factory.Model({id:n,type:t.factory.Model.prototype.schema.type})),t.data[n]}function s(n){var t=this;return void 0!==t.data[n]&&(t.removed[n]=t.data[n],delete t.data[n],t.size-=1),t.removed[n]}function c(n){var t=this;return void 0!==t.removed[n]&&(t.data[n]=t.removed[n],delete t.removed[n],t.size+=1),t.data[n]}function u(n){var t=this;delete t.removed[n]}return t.prototype.get=i,t.prototype.addOrUpdate=e,t.prototype.fromJson=r,t.prototype.toJson=o,t.prototype.clear=a,t.prototype.remove=s,t.prototype.revertRemove=c,t.prototype.clearRemoved=u,t}angular.module("angular-jsonapi").factory("AngularJsonAPICache",n),n.$inject=["$log"]}(),function(){"use strict";angular.module("angular-jsonapi").constant("lazyProperty",function(n,t,e){var r,o;Object.defineProperty(n,t,{get:function(){return o||(o=!0,r=e.call(n)),r},enumerable:!0,configurable:!0})})}(),function(){"use strict";angular.module("angular-jsonapi").constant("toKebabCase",function(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()})}(),function(){"use strict";angular.module("angular-jsonapi").config(["$provide",function(n){n.decorator("$q",["$delegate",function(n){var t=n;return t.allSettled=t.allSettled||function(n,e,r){function o(n){return t.when(n).then(function(n){return angular.isFunction(e)&&e(n),{success:!0,value:n}},function(n){return angular.isFunction(r)&&r(n),{success:!1,reason:n}})}var a=angular.isArray(n)?[]:{};return angular.forEach(n,function(n,t){a.hasOwnProperty(t)||(a[t]=o(n))}),t.all(a)},t}])}])}(),function(){"use strict";function n(n,t,e){function r(t){var e=this;e.state={},n.call(e,t),angular.forEach(t,function(n){n.synchronizer=e})}function o(r){function o(n){h.notify({step:"synchronization",data:n})}function a(n){h.notify({step:"synchronization",errors:n})}function i(n){u.state[d]=u.state[d]||{},u.state[d].success=!0,angular.forEach(n,function(n){n.success===!1&&(u.state[d].success=!1)}),angular.forEach(u.synchronizations,function(t){angular.forEach(t.afterHooks[d],function(t){h.notify({step:"after",errors:t.call(u,r,n)})})});var t,e=[];angular.forEach(n,function(n){n.success===!0?t=n.value:e.push(n.reason)}),void 0===t?h.reject({finish:s,errors:e}):h.resolve({data:t,finish:s,errors:e})}function s(){angular.forEach(u.synchronizations,function(n){angular.forEach(n.finishHooks[d],function(n){h.notify({step:"finish",errors:n.call(u,r)})})})}function c(n){e.error("All settled rejected! Something went wrong"),h.reject({finish:angular.noop,errors:n})}var u=this,l=[],h=t.defer(),d=r.action;return n.prototype.synchronize.call(u,r),angular.forEach(u.synchronizations,function(n){angular.forEach(n.beginHooks[d],function(n){h.notify({step:"begin",data:n.call(u,r)})})}),angular.forEach(u.synchronizations,function(n){angular.forEach(n.beforeHooks[d],function(n){h.notify({step:"before",data:n.call(u,r)})})}),angular.forEach(u.synchronizations,function(n){angular.forEach(n.synchronizationHooks[d],function(n){l.push(n.call(u,r))})}),t.allSettled(l,o,a).then(i,c),h.promise}return r.prototype=Object.create(n.prototype),r.prototype.constructor=r,r.prototype.synchronize=o,r}angular.module("angular-jsonapi").factory("AngularJsonAPISynchronizerSimple",n),n.$inject=["AngularJsonAPISynchronizerPrototype","$q","$log"]}(),function(){"use strict";function n(n){function t(n){var t=this;t.synchronizations=n}function e(t){var e=this;n.debug("Synchro Collection",e.factory.Model.prototype.schema.type,t),void 0===t.action&&n.error("Can't synchronize undefined action",t)}return t.prototype.synchronize=e,t}angular.module("angular-jsonapi").factory("AngularJsonAPISynchronizerPrototype",n),n.$inject=["$log"]}(),function(){"use strict";function n(n,t,e,r,o){function a(a){function i(n){return o({method:"GET",headers:g,url:a,params:n.params||{}}).then(p,f)}function s(n){return o({method:"GET",headers:g,url:a+"/"+n.object.data.id,params:n.params||{}}).then(p,f)}function c(n){return o({method:"DELETE",headers:g,url:a+"/"+n.object.data.id}).then(p,f)}function u(n){var t=r.defer();return n.object.removed===!0||void 0===n.target?t.reject():o({method:"DELETE",headers:g,url:a+"/"+n.object.data.id+"/relationships/"+e(n.key)+"/"+n.target.data.id}).then(p,f).then(t.resolve,t.reject),t.promise}function l(n){var i=r.defer();return n.object.removed===!0||void 0===n.target?i.reject():o({method:"POST",headers:g,url:a+"/"+n.object.data.id+"/relationships/"+e(n.key),data:{data:[t.toLinkData(n.target)]}}).then(p,f).then(i.resolve,i.reject),i.promise}function h(n){return o({method:"PUT",headers:g,url:a+"/"+n.object.data.id,data:n.object.form.toJson()}).then(p,f)}function d(n){return o({method:"POST",headers:g,url:a+"/",data:n.object.form.toJson()}).then(p,f)}function p(n){return n.data}function f(n){return n.data}var y=this,g={Accept:"application/vnd.api+json","Content-Type":"application/vnd.api+json"};n.call(y),y.synchronization("remove",c),y.synchronization("unlink",u),y.synchronization("link",l),y.synchronization("update",h),y.synchronization("add",d),y.synchronization("all",i),y.synchronization("get",s),y.synchronization("refresh",s)}return a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a}angular.module("angular-jsonapi-rest",["angular-jsonapi"]).factory("AngularJsonAPISynchronizationRest",n),n.$inject=["AngularJsonAPISynchronizationPrototype","AngularJsonAPIModelLinkerService","toKebabCase","$q","$http"]}(),function(){"use strict";function n(){function n(){var n=this,t=["add","init","get","all","clear","remove","unlink","unlinkReflection","link","linkReflection","update","refresh"];n.state={},n.beginHooks={},n.beforeHooks={},n.synchronizationHooks={},n.afterHooks={},n.finishHooks={},n.options={},angular.forEach(t,function(t){n.beginHooks[t]=[],n.beforeHooks[t]=[],n.synchronizationHooks[t]=[],n.afterHooks[t]=[],n.finishHooks[t]=[],n.state[t]={loading:!1,success:!0}})}function t(n,t){var e=this;e.beginHooks[n].push(t)}function e(n,t){var e=this;e.finishHooks[n].push(t)}function r(n,t){var e=this;e.beforeHooks[n].push(t)}function o(n,t){var e=this;e.afterHooks[n].push(t)}function a(n,t){var e=this;e.synchronizationHooks[n].push(t)}return n.prototype.before=r,n.prototype.after=o,n.prototype.begin=t,n.prototype.finish=e,n.prototype.synchronization=a,n}angular.module("angular-jsonapi").factory("AngularJsonAPISynchronizationPrototype",n)}(),function(){"use strict";function n(n,t){function e(e){function r(){var n=i.synchronizer.factory.schema.type;return t.localStorage.getItem(e+"."+n)}function o(){var n=i.synchronizer.factory.schema.type;t.localStorage.removeItem(e+"."+n)}function a(){var n=i.synchronizer.factory.schema.type,r=i.synchronizer.factory.cache;t.localStorage.setItem(e+"."+n,r.toJson())}var i=this;e=e||"AngularJsonAPI",i.__updateStorage=a,n.call(i),i.begin("init",r),i.begin("clear",o),i.begin("remove",a),i.begin("unlink",a),i.begin("unlinkReflection",a),i.begin("link",a),i.begin("linkReflection",a),i.begin("update",a),i.begin("add",a),i.finish("get",a),i.finish("all",a),i.finish("init",a),i.finish("clear",a),i.finish("remove",a),i.finish("unlink",a),i.finish("unlinkReflection",a),i.finish("link",a),i.finish("linkReflection",a),i.finish("update",a),i.finish("add",a),i.finish("get",a),i.finish("all",a)}return e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e}angular.module("angular-jsonapi-local",["angular-jsonapi"]).factory("AngularJsonAPISynchronizationLocal",n),n.$inject=["AngularJsonAPISynchronizationPrototype","$window"]}(),function(){"use strict";function n(n,t,e){function r(n){var t=this,r=n.include||{};n.include=r,r.get=n.include.get||[],r.all=n.include.all||[],t.params={get:{},all:{}},angular.forEach(n.relationships,function(t,a){var i=new o(t,a,n.type);n.relationships[a]=i,i.included===!0&&(r.get.push(e(a)),"hasOne"===i.type&&r.all.push(e(a)))}),angular.extend(t,n),r.get.length>0&&(t.params.get.include=r.get.join(",")),r.all.length>0&&(t.params.all.include=r.all.join(","))}function o(e,r,o){var a=this;angular.isString(e)?(a.model=t.plural(r),a.type=e,a.polymorphic=!1,a.reflection=o):(void 0===e.type&&n.error("Schema of link without a type: ",e,r),a.model=e.model||t.plural(r),a.type=e.type,a.polymorphic=e.polymorphic||!1,a.reflection=e.reflection||o,a.included=e.included||!1)}return r}angular.module("angular-jsonapi").factory("AngularJsonAPISchema",n),n.$inject=["$log","pluralize","toKebabCase"]}(),function(){"use strict";function n(n,t,e){function r(t,r){var o=function(t,r,o){var a=this;t.type!==a.schema.type&&e.error("Data type other then declared in schema: ",t.type," instead of ",a.schema.type),n.call(a,t,r,o),a.form.parent=a};return o.prototype=Object.create(n.prototype),o.prototype.constructor=o,o.prototype.schema=t,o.prototype.parentFactory=r,o.prototype.synchronize=r.synchronizer.synchronize.bind(r.synchronizer),angular.forEach(t.functions,function(n,t){o.prototype[t]=function(){return n.apply(this,arguments)}}),o}return{model:r}}angular.module("angular-jsonapi").factory("AngularJsonAPIModel",n),n.$inject=["AngularJsonAPIAbstractModel","AngularJsonAPISchema","$log"]}(),function(){"use strict";function n(n,t,e,r,o,a,i){function s(r,o){function a(n){return s.cache.fromJson(n.data),n.finish(),n.data}function i(n){return n.finish(),n.errors}var s=this,c={action:"init"};s.schema=new t(r),s.cache=new e(s),s.synchronizer=o,s.synchronizer.factory=s,s.Model=n.model(s.schema,s),o.factory=s,s.synchronizer.synchronize(c).then(a,i)}function c(n){var t=this,e=t.cache.get(n);return e.refresh(),e}function u(n){var t=this;n=n||{};var e=new r(t,angular.extend(n,t.schema.params.all));return e.fetch(),e}function l(n){function t(t){return o.unlinkAll(),r.cache.clearRemoved(n),t.finish(),t.data}function e(t){return void 0!==o&&(o.removed=!1,r.cache.revertRemove(n)),t.finish(),t.errors}var r=this,o=r.cache.remove(n),s={action:"remove",object:o};if(void 0!==o){if(o.removed=!0,o.isNew)return i.when(void 0)}else a.error("Object with this id does not exist");return r.synchronizer.synchronize(s).then(t,e)}function h(){var n=this,t=new n.Model({type:n.schema.type,id:o.generate(),attributes:{},relationships:{}},!0);return t}function d(){function n(n){return n.finish(),n.data}function t(n){return n.finish(),n.errors}var e=this;e.cache.clear();var r={action:"clear"};return e.synchronizer.synchronize(r).then(n,t)}return s.prototype.get=c,s.prototype.all=u,s.prototype.remove=l,s.prototype.initialize=h,s.prototype.clear=d,s}angular.module("angular-jsonapi").factory("AngularJsonAPIFactory",n),n.$inject=["AngularJsonAPIModel","AngularJsonAPISchema","AngularJsonAPICache","AngularJsonAPICollection","uuid4","$log","$q"]}(),function(){"use strict";function n(n,t){function e(n,t){var e=this;e.factory=n,e.params=t,e.errors={synchronization:[]},e.data=[],e.step="initialized"}function r(n){var t=this;return t.factory.get(n)}function o(){function e(t){return n.$emit("angularJsonAPI:collection:fetch","resolved",t),a.errors.synchronization=[],a.data=i.proccesResults(t.data),t.finish(),a}function r(t){return n.$emit("angularJsonAPI:collection:fetch","rejected",t),a.errors.synchronization=t.errors,t.finish(),a}function o(t){return n.$emit("angularJsonAPI:collection:fetch","notify",t),a}var a=this,i=t.get("$jsonapi"),s={action:"all",params:a.params};return a.factory.synchronizer.synchronize(s).then(e,r,o)}return e.prototype.fetch=o,e.prototype.refresh=o,e.prototype.get=r,e}angular.module("angular-jsonapi").factory("AngularJsonAPICollection",n),n.$inject=["$rootScope","$injector"]}(),function(){"use strict";function n(){function n(n,e){function r(n,r){var o=new e(n,r);t[n.type]=o}function o(n){return t[n]}function a(e){return void 0===t[e]&&n.error("Can	 add not existing object type: "+e+". Use initialize(Model, datas)."),t[e].isNew.form}function i(e,r){return void 0===t[e]&&n.error("Can	 get not existing object type: "+e+". Use initialize(Model, datas)."),t[e].get(r)}function s(e,r){return void 0===t[e]&&n.error("Can	 remove not existing object type: "+e+". Use initialize(Model, datas)."),t[e].remove(r)}function c(e){return void 0===t[e]&&n.error("Can	 get all of not existing object type: "+e+". Use initialize(Model, datas)."),t[e].all()}function u(){angular.forEach(t,function(n){n.clear()})}function l(t){void 0===t&&n.error("Can't proccess results:",t),console.log(t);var e=[];return angular.forEach(t.data,function(n){e.push(o(n.type).cache.addOrUpdate(n))}),angular.forEach(t.included,function(n){o(n.type).cache.addOrUpdate(n)}),e}return{form:a,get:i,remove:s,all:c,addFactory:r,getFactory:o,clearAll:u,proccesResults:l}}var t={};this.$get=n,n.$inject=["$log","AngularJsonAPIFactory"]}angular.module("angular-jsonapi").provider("$jsonapi",n)}();
//# sourceMappingURL=angular-jsonapi.min.js.map