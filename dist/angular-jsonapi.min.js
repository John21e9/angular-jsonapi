!function(){"use strict";angular.module("angular-jsonapi",["uuid4"]).constant("pluralize",pluralize)}(),function(){"use strict";angular.module("angular-jsonapi").constant("lazyProperty",function(t,n,o){var e,a;Object.defineProperty(t,n,{get:function(){return a||(a=!0,e=o.call(t)),e},enumerable:!0,configurable:!0})})}(),function(){"use strict";angular.module("angular-jsonapi").config(["$provide",function(t){t.decorator("$q",["$delegate",function(t){var n=t;return n.allSettled=n.allSettled||function(t){function o(t){return n.when(t).then(function(t){return{success:!0,value:t}},function(t){return{success:!1,reason:t}})}var e=angular.isArray(t)?[]:{};return angular.forEach(t,function(t,n){e.hasOwnProperty(n)||(e[n]=o(t))}),n.all(e)},n}])}])}(),function(){"use strict";function t(t){function n(){var t=this,n=["add","init","get","all","clear","remove","removeLink","removeLinkReflection","addLink","addLinkReflection","update","refresh"];t.state={},t.beginHooks={},t.beforeHooks={},t.synchronizationHooks={},t.afterHooks={},t.finishHooks={},t.options={},angular.forEach(n,function(n){t.beginHooks[n]=[],t.beforeHooks[n]=[],t.synchronizationHooks[n]=[],t.afterHooks[n]=[],t.finishHooks[n]=[],t.state[n]={loading:!1,success:!0}})}function o(t){function n(n){angular.forEach(t[n],function(t,e){o[n][e]=o[n][e].concat(t)})}var o=this;n("beginHooks"),n("beforeHooks"),n("synchronizationHooks"),n("afterHooks"),n("finishHooks"),angular.extend(o.options,t.options)}function e(t,n){var o=this;o.beginHooks[t].push(n)}function a(t,n){var o=this;o.finishHooks[t].push(n)}function r(t,n){var o=this;o.beforeHooks[t].push(n)}function i(t,n){var o=this;o.afterHooks[t].push(n)}function s(t,n){var o=this;o.synchronizationHooks[t].push(n)}function l(n,o,e,a,r,i){var s=this,l=[];s.state[n].loading=!0,void 0!==e&&(e.loadingCount+=1),void 0!==o&&(o.loadingCount+=1),angular.forEach(s.beginHooks[n],function(t){t.call(s,o,e,a,r,i)}),angular.forEach(s.beforeHooks[n],function(t){t.call(s,o,e,a,r,i)}),angular.forEach(s.synchronizationHooks[n],function(t){l.push(t.call(s,o,e,a,r,i))}),t.allSettled(l).then(function(t){s.state[n].success=!0,angular.forEach(t,function(t){t.success===!1&&(s.state[n].success=!1)}),angular.forEach(s.afterHooks[n],function(n){n.call(s,o,e,a,r,i,t)}),angular.forEach(s.finishHooks[n],function(t){t.call(s,o,e,a,r,i)}),s.state[n].loading=!1,void 0!==e&&(e.loadingCount-=1),void 0!==o&&(o.loadingCount-=1)})}return n.prototype.before=r,n.prototype.after=i,n.prototype.begin=e,n.prototype.finish=a,n.prototype.synchronization=s,n.prototype.synchronize=l,n.prototype.extend=o,n}angular.module("angular-jsonapi").factory("AngularJsonAPISynchronization",t),t.$inject=["$q"]}(),function(){"use strict";function t(t,n,o){function e(e){function a(t,n,o,e){return{data:t,status:n,headers:o,config:e}}function r(t,n,o,e,a,r){var i=r[0].value.data.data,s=r[0].value.data.included;if(r[0].success===!0&&void 0!==i){var l={};angular.forEach(i,function(n){l[n.id]=n,t.addOrUpdate(n)}),angular.forEach(t.data,function(n){void 0===l[n.id]&&t.__remove(n.id)}),angular.forEach(s,function(n){t.allCollections[n.type].addOrUpdate(n)})}}function i(t,n,o,e,a,r){var i,s;r[0].success===!0?(i=r[0].value.data.data,s=r[0].value.data.included,t.addOrUpdate(i),angular.forEach(s,function(n){t.allCollections[n.type].addOrUpdate(n)})):(n.error=!0,n.__remove(),t.__remove(n.data.id))}function s(t,r,i){var s=n.defer(),l={method:"GET",url:e,params:i||{}};return o(l).success(function(t,n,o,e){s.resolve(a(t,n,o,e))}).error(function(t,n,o,e){s.reject(a(t,n,o,e))}),s.promise}function l(t,r,i,s,l){var u,d,c=n.defer();return angular.isArray(r)?(d=[],angular.forEach(r,function(t){d.push(t.data.id)})):d=r.data.id,u={method:"GET",url:e+"/"+d.toString(),params:l||{}},o(u).success(function(t,n,o,e){c.resolve(a(t,n,o,e))}).error(function(t,n,o,e){c.reject(a(t,n,o,e))}),c.promise}function u(t,r){var i=n.defer(),s={method:"DELETE",url:e+"/"+r.data.id};return o(s).success(function(t,n,o,e){i.resolve(a(t,n,o,e))}).error(function(t,n,o,e){i.reject(a(t,n,o,e))}),i.promise}function d(t,r,i,s){var l,u=n.defer();return r.removed===!0||void 0===s?u.resolve():(l={method:"DELETE",url:e+"/"+r.data.id+"/relationships/"+i,data:{data:s.toLink()}},o(l).success(function(t,n,o,e){u.resolve(a(t,n,o,e))}).error(function(t,n,o,e){u.reject(a(t,n,o,e))})),u.promise}function c(t,r,i,s){var l=n.defer(),u={method:"POST",url:e+"/"+r.data.id+"/relationships/"+i,data:{data:s.toLink()}};return o(u).success(function(t,n,o,e){l.resolve(a(t,n,o,e))}).error(function(t,n,o,e){l.reject(a(t,n,o,e))}),l.promise}function p(t,r){var i=n.defer(),s={method:"PATCH",url:e+"/"+r.data.id,data:{data:r.toPatchData()}};return o(s).success(function(t,n,o,e){i.resolve(a(t,n,o,e))}).error(function(t,n,o,e){i.reject(a(t,n,o,e))}),i.promise}function f(t,r){var i=n.defer();console.log(r);var s={method:"POST",url:e+"/",data:{data:r.toJson()}};return o(s).success(function(t,n,o,e){i.resolve(a(t,n,o,e))}).error(function(t,n,o,e){i.reject(a(t,n,o,e))}),i.promise}var h=this;t.call(h),h.synchronization("remove",u),h.synchronization("removeLink",d),h.synchronization("addLink",c),h.synchronization("update",p),h.synchronization("add",f),h.synchronization("all",s),h.synchronization("get",l),h.synchronization("refresh",l),h.after("all",r),h.after("get",i),h.after("refresh",i)}return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}angular.module("angular-jsonapi-rest",["angular-jsonapi"]).factory("AngularJsonAPISynchronizationRest",t),t.$inject=["AngularJsonAPISynchronization","$q","$http"]}(),function(){"use strict";function t(t,n){function o(o){function e(t){var e=n.localStorage.getItem(o+"."+t.Model.prototype.schema.type);t.fromJson(e)}function a(t){n.localStorage.removeItem(o+"."+t.Model.prototype.schema.type)}function r(t){n.localStorage.setItem(o+"."+t.Model.prototype.schema.type,t.toJson())}var i=this;i.__updateStorage=r,t.call(i),i.begin("init",e),i.begin("clear",a),i.begin("remove",r),i.begin("removeLink",r),i.begin("removeLinkReflection",r),i.begin("addLink",r),i.begin("addLinkReflection",r),i.begin("update",r),i.begin("add",r),i.finish("get",r),i.finish("all",r),i.finish("init",r),i.finish("clear",r),i.finish("remove",r),i.finish("removeLink",r),i.finish("removeLinkReflection",r),i.finish("addLink",r),i.finish("addLinkReflection",r),i.finish("update",r),i.finish("add",r),i.finish("get",r),i.finish("all",r)}return o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o}angular.module("angular-jsonapi-local",["angular-jsonapi"]).factory("AngularJsonAPISynchronizationLocal",t),t.$inject=["AngularJsonAPISynchronization","$window"]}(),function(){"use strict";function t(t,n,o,e){function a(t,n){var a=this,r=new e(t);a.Model=o.model(r,a.allCollections,a),a.synchronization=n,a.loadingCount=0,a.data={},a.removed={},a.schema=r,a.dummy=new a.Model({type:t.type},void 0,!0),a.dummy.form.save=h.bind(a.dummy),a.allCollections[t.type]=a,a.__synchronize("init")}function r(t){var n=this,o=angular.fromJson(t);null!==o&&void 0!==o.data&&(n.updatedAt=o.updatedAt,angular.forEach(o.data,function(t){var o=t.data;n.addOrUpdate(o,t.updatedAt)}))}function i(){var t=this,n={data:{},updatedAt:t.updatedAt};return angular.forEach(t.data,function(t,o){n.data[o]=t.toJson()}),angular.toJson(n)}function s(n,o){var e=this;return void 0===n.id?void t.error("Can't add data without id!",n):(void 0===e.data[n.id]?e.data[n.id]=new this.Model(n,o):(e.data[n.id].__setData(n,o),e.data[n.id].__setLinks(n.relationships)),e.data[n.id].__setUpdated(o),e.data[n.id])}function l(t){var n=this;return void 0===n.data[t]&&(n.data[t]=new n.Model({id:t,type:n.Model.prototype.schema.type},void 0,!0)),n.data[t]}function u(t){var n,o=this;return angular.isArray(t)?(n=[],angular.forEach(t,function(t){n.push(o.__get(t))})):n=o.__get(t),o.__synchronize("get",n,void 0,void 0,o.schema.params.get),n}function d(){var t=this;return t.__synchronize("all",void 0,void 0,void 0,t.schema.params.all),t}function c(){var t=this;t.updatedAt=Date.now(),t.data={},t.__synchronize("clear")}function p(t){var n=this,o=n.data[t];n.removed[t]=o,n.updatedAt=Date.now(),delete n.data[t]}function f(n){var o=this,e=o.data[n];void 0!==e?(o.__remove(n),e.__remove(n)):t.error("Object with this id does not exist"),o.__synchronize("remove",e)}function h(){var o,e=this,a=e.form.validate();if(angular.equals(a,{})){var r=angular.copy(e.form.data);if(void 0===r.id)r.id=n.generate();else if(!n.validate(r.id))return void t.error("Wrong id of dummy data!");r.relationships={},r.type=e.schema.type,o=e.parentCollection.addOrUpdate(r),e.form.reset(),e.parentCollection.__synchronize("add",e)}}function v(n,o,e,a,r){var i=this;t.log("Synchro Collection",this.Model.prototype.schema.type,{action:n,object:o,linkKey:e,linkedObject:a,params:r}),i.synchronization.synchronize(n,i,o,e,a,r)}return a.prototype.allCollections={},a.prototype.__synchronize=v,a.prototype.__get=l,a.prototype.__remove=p,a.prototype.get=u,a.prototype.all=d,a.prototype.remove=f,a.prototype.clear=c,a.prototype.fromJson=r,a.prototype.toJson=i,a.prototype.addOrUpdate=s,a}angular.module("angular-jsonapi").factory("AngularJsonAPICollection",t),t.$inject=["$log","uuid4","JsonAPIModelFactory","AngularJsonAPISchema"]}(),function(){"use strict";function t(t,n){function o(t){var n=this,o=[];n.params={get:{},all:{}},angular.forEach(t.relationships,function(n,a){var r=new e(n,a,t.type);t.relationships[a]=r,r.included===!0&&o.push(a)}),angular.extend(n,t),o.length>0&&(n.params.get.include=o.join(","))}function e(o,e,a){var r=this;angular.isString(o)?(r.model=n.plural(e),r.type=o,r.polymorphic=!1,r.reflection=a):(void 0===o.type&&t.error("Schema of link without a type: ",o,e),r.model=o.model||n.plural(e),r.type=o.type,r.polymorphic=o.polymorphic||!1,r.reflection=o.reflection||a,r.included=o.included||!1)}return o}angular.module("angular-jsonapi").factory("AngularJsonAPISchema",t),t.$inject=["$log","pluralize"]}(),function(){"use strict";function t(t,n,o){function e(n,e,a){var r=function(n,e,a){var r=this;n.type!==r.schema.type&&o.error("Data type other then declared in schema: ",n.type," instead of ",r.schema.type),t.call(r,n,e,a),r.form.parent=r};return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype.schema=n,r.prototype.linkedCollections=e,r.prototype.parentCollection=a,angular.forEach(n.functions,function(t,n){r.prototype[n]=function(){return t.call(this)}}),r}return{model:e}}angular.module("angular-jsonapi").factory("JsonAPIModelFactory",t),t.$inject=["AngularJsonAPIAbstractData","AngularJsonAPISchema","$log"]}(),function(){"use strict";function t(t,n,o,e){function a(t,n,o){var a=this;t.relationships=t.relationships||{},a.removed=!1,a.loadingCount=0,a.data={relationships:{},attributes:{}},a.relationships={},a.errors={validation:{}},a.dummy=o||!1,a.error=!1,a.__setUpdated(n),a.__setData(t,n),a.form=new e(a)}function r(){var t=this;t.parentCollection.__synchronize("refresh",t)}function i(){var t=this;return{data:t.data,updatedAt:t.updatedAt}}function s(t){var n=this;n.updatedAt=t||Date.now(),n.parentCollection.updatedAt=n.updatedAt}function l(){var t=this;t.__setUpdated(),t.removed=!0,t.removeAllLinks()}function u(){var t=this;t.__remove(),t.parentCollection.remove(t.data.id)}function d(){return{type:this.data.type,id:this.data.id}}function c(){var t=this,n={data:{}};return angular.forEach(t.data,function(t,o){"relationships"!==o&&(n.data[o]=t)}),n}function p(o,e,a){var r=this,i=r.linkedCollections[e].__get(a);return void 0===r.schema.relationships[o]?void t.error("Cannot add link not specified in schema: "+o):void 0===r.linkedCollections[e]?void t.error("Cannot add link of not existing type: "+e):n.validate(a)?void 0===i?void t.error("Cant find",e,"with",a):void r.addLink(o,i):void t.error("Wrong link id, not uuid4: "+a)}function f(n,o,e){var a,r,i,s=this,l=s.schema.relationships[n];if(void 0===o)return void t.error("Can't add non existing object");if(void 0===l)return void t.error("Can't add link not present in schema: ",n,s,e);if(l.polymorphic===!1&&l.model!==o.schema.type)return void t.error("This relation is not polymorphic, expected: "+l.model+" instead of "+o.schema.type);if(a=l.type,r=l.reflection,i=s.data.relationships[n].data,"hasOne"===a){if(null!==i&&i.id===o.data.id)return;void 0!==i&&null!==i&&(t.warn("Swaping hasOne",n,"of",s.toString()),s.removeLink(n)),i=o.toLink(),i=o.toLink()}else{var u=!1;if(angular.forEach(i,function(t){t.id===o.data.id&&(u=!0)}),u===!0)return;i.push(o.toLink())}e===!0?s.parentCollection.__synchronize("addLinkReflection",s,n,o):(o.addLink(r,s,!0),s.parentCollection.__synchronize("addLink",s,n,o)),s.__setUpdated(),s.__setLinkInternal(i,n,l)}function h(){var t=this;angular.forEach(t.relationships,function(n,o){t.removeLink(o)})}function v(n,o,e){var a,r,i,s=this,l=s.schema.relationships[n],u=!1;return void 0===s.schema.relationships[n]?void t.error("Can't remove link not present in schema"):(a=l.type,i=l.reflection,r=s.data.relationships[n].data,"hasOne"===a?null===o.data||void 0!==o&&o.data.id!==r.id||(s.data.relationships[n].data=null,r=null,u=!0,e!==!0&&void 0!==s.relationships[n]&&s.relationships[n].removeLink(i,s,!0)):void 0===o?(s.data.relationships[n].data=[],r=[],u=!0,e!==!0&&angular.forEach(s.relationships[n],function(t){t.removeLink(i,s,!0)})):angular.forEach(r,function(t,n){t.id===o.data.id&&(e!==!0&&o.removeLink(i,s,!0),r.splice(n,1),u=!0)}),void(u===!0&&(s.__setUpdated(),e!==!0?s.parentCollection.__synchronize("removeLink",s,n,o):s.parentCollection.__synchronize("removeLinkReflection",s,n,o),s.__setLinkInternal(r,n,l))))}function g(t){var n=this;n.__setUpdated(),n.__setAttributes(t),n.parentCollection.__synchronize("update",n)}function y(n,e,a){var r=this,i=a.type,s=a.reflection;if(null===n)delete r.relationships[e],r.relationships[e]=void 0;else if("hasMany"===i&&angular.isArray(n)){var l=function(){var o=[];return angular.forEach(n,function(e){var a=r.linkedCollections[e.type];if(void 0===a)return void t.error("No angular-jsonapi schema for",n.type);var i=a.__get(e.id);i.addLink(s,r,!0),o.push(i)}),o};o(r.relationships,e,l)}else if("hasOne"===i&&n.id){var u=function(){var o=r.linkedCollections[n.type];if(void 0===o)return void t.error("No angular-jsonapi schema for",n.type);var e=o.__get(n.id);return e.addLink(s,r,!0),e};o(r.relationships,e,u)}}function m(t,n,o){var e=this,a=o.type,r=o.reflection;if("hasMany"===a&&angular.isArray(t)){var i={};angular.forEach(t,function(t){i[t.id]=t}),angular.forEach(e.relationships[n],function(t){void 0===i[t.data.id]&&t.removeLink(r,e,!0)})}else"hasOne"===a&&null!==t&&t.id&&void 0!==e.relationships[n]&&e.relationships[n].data.id!==t.id&&e.relationships[n].removeLink(r,e,!0);e.__setLinkInternal(t,n,o)}function _(t){var n=this;angular.forEach(n.schema.relationships,function(o,e){n.data.relationships[e]="hasOne"===o.type?t[e]||{data:null}:t[e]||{data:[]}}),angular.forEach(n.schema.relationships,function(o,e){void 0!==t[e]&&n.__setLink(t[e].data,e,o)})}function k(t,n){var o=this,e=[];return void 0!==t&&(e=j(o.schema.attributes[n],t,n)),e}function A(n){var o=this,e={};return angular.forEach(o.schema.attributes,function(a,r){var i=o.__validateField(n[r],r);i.length>0&&(e[r]=i,t.warn("Erorrs when validating ",n[r],e))}),e}function b(t){var n=this;angular.forEach(n.schema.attributes,function(o,e){t[e]&&(n.data.attributes[e]=t[e])})}function L(t){var n=this,o=angular.copy(t);n.errors.validation=n.__validateData(o),o.relationships=o.relationships||{},o.attributes=o.attributes||{},n.data.id=o.id,n.data.type=o.type,n.__setAttributes(o.attributes),n.__setLinks(o.relationships)}function j(o,e,a){var r=[];if(angular.isArray(o))angular.forEach(o,function(t){r=r.concat(j(t,e,a))});else if(angular.isFunction(o)){var i=o(e);angular.isArray(i)?r.concat(i):t.error("Wrong validator type it should return array of errors instead of: "+i.toString())}else angular.isString(o)?"text"===o||"string"===o?angular.isString(e)||r.push(a+" is not a string "):"number"===o||"integer"===o?parseInt(e).toString()!==e.toString()&&r.push(a+" is not a number"):"uuid4"===o?n.validate(e)||r.push(a+" is not a uuid4"):"required"===o?0===e.toString().length&&r.push(a+" is empty"):t.error("Wrong validator type: "+o.toString()):angular.isObject(o)?(void 0!==o.maxlength&&e.length>o.maxlength&&r.push(a+" is too long max "+o.maxlength),void 0!==o.minlength&&e.length<o.minlength&&r.push(a+" is too short min "+o.minlength),void 0!==o.maxvalue&&parseInt(e)>o.maxvalue&&r.push(a+" is too big max "+o.maxvalue),void 0!==o.minvalue&&parseInt(e)<o.minvalue&&r.push(a+" is too small min "+o.minvalue)):t.error("Wrong validator type: "+o.toString());return r}return a.prototype.__setData=L,a.prototype.__setLinks=_,a.prototype.__setLink=m,a.prototype.__setAttributes=b,a.prototype.__validateData=A,a.prototype.__validateField=k,a.prototype.__updateAttributes=g,a.prototype.__remove=l,a.prototype.__setUpdated=s,a.prototype.__setLinkInternal=y,a.prototype.refresh=r,a.prototype.remove=u,a.prototype.addLinkById=p,a.prototype.addLink=f,a.prototype.removeLink=v,a.prototype.toLink=d,a.prototype.toPatchData=c,a.prototype.removeAllLinks=h,a.prototype.toJson=i,a}angular.module("angular-jsonapi").factory("AngularJsonAPIAbstractData",t),t.$inject=["$log","uuid4","lazyProperty","AngularJsonAPIAbstractDataForm"]}(),function(){"use strict";function t(t){function n(t){var n=this;n.data={},n.parent=t,n.reset()}function o(){var n=this,o=n.validate();return angular.equals(o,{})===!1?void t.error("Errors in form: ",o):void n.parent.__updateAttributes(n.data)}function e(){var t=this;angular.forEach(t.parent.schema.attributes,function(n,o){t.data[o]=t.parent.data.attributes[o]||""}),t.errors={validation:{}}}function a(){var t,n=this;return t=n.parent.__validateData(n.data),n.errors.validation=t,t}function r(t){var n,o=this;return n=o.parent.__validateField(o.data[t],t),o.errors.validation[t]=n,n}function i(n){t.log("Synchro Collection "+this.Model.prototype.schema.type,n)}return n.prototype.save=o,n.prototype.reset=e,n.prototype.validate=a,n.prototype.validateField=r,n.prototype.__synchronize=i,n}angular.module("angular-jsonapi").factory("AngularJsonAPIAbstractDataForm",t),t.$inject=["$log"]}(),function(){"use strict";function t(){function t(t,o){function e(t,e){var a=new o(t,e);n[t.type]=a}function a(t){return n[t]}function r(o){return void 0===n[o]&&t.error("Can	 add not existing object type: "+o+". Use initialize(Model, datas)."),n[o].dummy.form}function i(o,e){return void 0===n[o]&&t.error("Can	 get not existing object type: "+o+". Use initialize(Model, datas)."),n[o].get(e)}function s(o,e){return void 0===n[o]&&t.error("Can	 remove not existing object type: "+o+". Use initialize(Model, datas)."),n[o].remove(e)}function l(o){return void 0===n[o]&&t.error("Can	 get all of not existing object type: "+o+". Use initialize(Model, datas)."),n[o].all()}return{form:r,get:i,remove:s,all:l,addModel:e,getModel:a}}var n={};this.$get=t,t.$inject=["$log","AngularJsonAPICollection"]}angular.module("angular-jsonapi").provider("$jsonapi",t)}();
//# sourceMappingURL=angular-jsonapi.min.js.map